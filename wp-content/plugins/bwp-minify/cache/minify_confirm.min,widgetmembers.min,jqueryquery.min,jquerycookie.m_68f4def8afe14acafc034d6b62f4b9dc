/*! buddypress - v2.5.2 - 2016-03-31 7:09:08 PM UTC - https://wordpress.org/plugins/buddypress/ */
jQuery(document).ready(function(){jQuery("a.confirm").click(function(){return confirm(BP_Confirm.are_you_sure)?!0:!1})});
;/*! buddypress - v2.5.2 - 2016-03-31 7:09:08 PM UTC - https://wordpress.org/plugins/buddypress/ */
function member_widget_response(a){a=a.substr(0,a.length-1),a=a.split("[[SPLIT]]"),"-1"!==a[0]?jQuery(".widget ul#members-list").fadeOut(200,function(){jQuery(".widget ul#members-list").html(a[1]),jQuery(".widget ul#members-list").fadeIn(200)}):jQuery(".widget ul#members-list").fadeOut(200,function(){var b="<p>"+a[1]+"</p>";jQuery(".widget ul#members-list").html(b),jQuery(".widget ul#members-list").fadeIn(200)})}jQuery(document).ready(function(){jQuery(".widget div#members-list-options a").on("click",function(){var a=this;return jQuery(a).addClass("loading"),jQuery(".widget div#members-list-options a").removeClass("selected"),jQuery(this).addClass("selected"),jQuery.post(ajaxurl,{action:"widget_members",cookie:encodeURIComponent(document.cookie),_wpnonce:jQuery("input#_wpnonce-members").val(),"max-members":jQuery("input#members_widget_max").val(),filter:jQuery(this).attr("id")},function(b){jQuery(a).removeClass("loading"),member_widget_response(b)}),!1})});
;/*! buddypress - v2.5.2 - 2016-03-31 7:09:08 PM UTC - https://wordpress.org/plugins/buddypress/ */
function bp_get_querystring(a){var b=location.search.split(a+"=")[1];return b?decodeURIComponent(b.split("&")[0]):null}
;/*! buddypress - v2.5.2 - 2016-03-31 7:09:08 PM UTC - https://wordpress.org/plugins/buddypress/ */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}});
;/*! buddypress - v2.5.2 - 2016-03-31 7:09:08 PM UTC - https://wordpress.org/plugins/buddypress/ */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(b){return a.isFunction(b)||"object"==typeof b?b:{top:b,left:b}}var c=a.scrollTo=function(b,c,d){return a(window).scrollTo(b,c,d)};return c.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},c.window=function(){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||-1!==a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||"BackCompat"===d.compatMode?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),"max"===d&&(d=9e9),f=a.extend({},c.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=b(f.offset),f.over=b(f.over),this._scrollable().each(function(){function g(a){j.animate(l,e,f.easing,a&&function(){a.call(this,k,f)})}if(null!==d){var h,i=this,j=a(i),k=d,l={},m=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(k)){k=b(k);break}if(k=m?a(k):a(k,this),!k.length)return;case"object":(k.is||k.style)&&(h=(k=a(k)).offset())}var n=a.isFunction(f.offset)&&f.offset(i,k)||f.offset;a.each(f.axis.split(""),function(a,b){var d="x"===b?"Left":"Top",e=d.toLowerCase(),o="scroll"+d,p=i[o],q=c.max(i,b);if(h)l[o]=h[e]+(m?0:p-j.offset()[e]),f.margin&&(l[o]-=parseInt(k.css("margin"+d))||0,l[o]-=parseInt(k.css("border"+d+"Width"))||0),l[o]+=n[e]||0,f.over[e]&&(l[o]+=k["x"===b?"width":"height"]()*f.over[e]);else{var r=k[e];l[o]=r.slice&&"%"===r.slice(-1)?parseFloat(r)/100*q:r}f.limit&&/^\d+$/.test(l[o])&&(l[o]=l[o]<=0?0:Math.min(l[o],q)),!a&&f.queue&&(p!==l[o]&&g(f.onAfterFirst),delete l[o])}),g(f.onAfter)}}).end()},c.max=function(b,c){var d="x"===c?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])},c});
;/*! buddypress - v2.5.2 - 2016-03-31 7:09:08 PM UTC - https://wordpress.org/plugins/buddypress/ */
function bp_init_activity(){jq.cookie("bp-activity-oldestpage",1,{path:"/"}),void 0!==jq.cookie("bp-activity-filter")&&jq("#activity-filter-select").length&&jq('#activity-filter-select select option[value="'+jq.cookie("bp-activity-filter")+'"]').prop("selected",!0),void 0!==jq.cookie("bp-activity-scope")&&jq(".activity-type-tabs").length&&(jq(".activity-type-tabs li").each(function(){jq(this).removeClass("selected")}),jq("#activity-"+jq.cookie("bp-activity-scope")+", .item-list-tabs li.current").addClass("selected"))}function bp_init_objects(a){jq(a).each(function(b){void 0!==jq.cookie("bp-"+a[b]+"-filter")&&jq("#"+a[b]+"-order-select select").length&&jq("#"+a[b]+'-order-select select option[value="'+jq.cookie("bp-"+a[b]+"-filter")+'"]').prop("selected",!0),void 0!==jq.cookie("bp-"+a[b]+"-scope")&&jq("div."+a[b]).length&&(jq(".item-list-tabs li").each(function(){jq(this).removeClass("selected")}),jq("#"+a[b]+"-"+jq.cookie("bp-"+a[b]+"-scope")+", #object-nav li.current").addClass("selected"))})}function bp_filter_request(a,b,c,d,e,f,g,h,i){return"activity"===a?!1:(null===c&&(c="all"),jq.cookie("bp-"+a+"-scope",c,{path:"/"}),jq.cookie("bp-"+a+"-filter",b,{path:"/"}),jq.cookie("bp-"+a+"-extras",g,{path:"/"}),jq(".item-list-tabs li").each(function(){jq(this).removeClass("selected")}),jq("#"+a+"-"+c+", #object-nav li.current").addClass("selected"),jq(".item-list-tabs li.selected").addClass("loading"),jq('.item-list-tabs select option[value="'+b+'"]').prop("selected",!0),("friends"===a||"group_members"===a)&&(a="members"),bp_ajax_request&&bp_ajax_request.abort(),void(bp_ajax_request=jq.post(ajaxurl,{action:a+"_filter",cookie:bp_get_cookies(),object:a,filter:b,search_terms:e,scope:c,page:f,extras:g,template:i},function(a){if("pag-bottom"===h&&jq("#subnav").length){var b=jq("#subnav").parent();jq("html,body").animate({scrollTop:b.offset().top},"slow",function(){jq(d).fadeOut(100,function(){jq(this).html(a),jq(this).fadeIn(100)})})}else jq(d).fadeOut(100,function(){jq(this).html(a),jq(this).fadeIn(100)});jq(".item-list-tabs li.selected").removeClass("loading")})))}function bp_activity_request(a,b){null!==a&&jq.cookie("bp-activity-scope",a,{path:"/"}),null!==b&&jq.cookie("bp-activity-filter",b,{path:"/"}),jq.cookie("bp-activity-oldestpage",1,{path:"/"}),jq(".item-list-tabs li").each(function(){jq(this).removeClass("selected loading")}),jq("#activity-"+a+", .item-list-tabs li.current").addClass("selected"),jq("#object-nav.item-list-tabs li.selected, div.activity-type-tabs li.selected").addClass("loading"),jq('#activity-filter-select select option[value="'+b+'"]').prop("selected",!0),jq(".widget_bp_activity_widget h2 span.ajax-loader").show(),bp_ajax_request&&bp_ajax_request.abort(),bp_ajax_request=jq.post(ajaxurl,{action:"activity_widget_filter",cookie:bp_get_cookies(),_wpnonce_activity_filter:jq("#_wpnonce_activity_filter").val(),scope:a,filter:b},function(a){jq(".widget_bp_activity_widget h2 span.ajax-loader").hide(),jq("div.activity").fadeOut(100,function(){jq(this).html(a.contents),jq(this).fadeIn(100),bp_legacy_theme_hide_comments()}),void 0!==a.feed_url&&jq(".directory #subnav li.feed a, .home-page #subnav li.feed a").attr("href",a.feed_url),jq(".item-list-tabs li.selected").removeClass("loading")},"json")}function bp_legacy_theme_hide_comments(){var a,b,c,d=jq("div.activity-comments");return d.length?void d.each(function(){jq(this).children("ul").children("li").length<5||(comments_div=jq(this),a=comments_div.parents("#activity-stream > li"),b=jq(this).children("ul").children("li"),c=" ",jq("#"+a.attr("id")+" a.acomment-reply span").length&&(c=jq("#"+a.attr("id")+" a.acomment-reply span").html()),b.each(function(d){d<b.length-5&&(jq(this).addClass("hidden"),jq(this).toggle(),d||jq(this).before('<li class="show-all"><a href="#'+a.attr("id")+'/show-all/" title="'+BP_DTheme.show_all_comments+'">'+BP_DTheme.show_x_comments.replace("%d",c)+"</a></li>"))}))}):!1}function checkAll(){var a,b=document.getElementsByTagName("input");for(a=0;a<b.length;a++)"checkbox"===b[a].type&&(""===$("check_all").checked?b[a].checked="":b[a].checked="checked")}function clear(a){if(a=document.getElementById(a)){var b=a.getElementsByTagName("INPUT"),c=a.getElementsByTagName("OPTION"),d=0;if(b)for(d=0;d<b.length;d++)b[d].checked="";if(c)for(d=0;d<c.length;d++)c[d].selected=!1}}function bp_get_cookies(){var a,b,c,d,e,f=document.cookie.split(";"),g={},h="bp-";for(a=0;a<f.length;a++)b=f[a],c=b.indexOf("="),d=jq.trim(unescape(b.slice(0,c))),e=unescape(b.slice(c+1)),0===d.indexOf(h)&&(g[d]=e);return encodeURIComponent(jq.param(g))}var jq=jQuery,bp_ajax_request=null,newest_activities="",activity_last_recorded=0;jq(document).ready(function(){"-1"===window.location.search.indexOf("new")&&jq("div.forums").length?jq("#new-topic-post").hide():jq("#new-topic-post").show(),bp_init_activity();var a=["members","groups","blogs","forums","group_members"],b=jq("#whats-new");if(bp_init_objects(a),b.length&&bp_get_querystring("r")){var c=b.val();jq("#whats-new-options").slideDown(),b.animate({height:"3.8em"}),jq.scrollTo(b,500,{offset:-125,easing:"swing"}),b.val("").focus().val(c)}else jq("#whats-new-options").hide();if(b.focus(function(){jq("#whats-new-options").slideDown(),jq(this).animate({height:"3.8em"}),jq("#aw-whats-new-submit").prop("disabled",!1),jq(this).parent().addClass("active"),jq("#whats-new-content").addClass("active");var a=jq("form#whats-new-form"),b=jq("#activity-all");a.hasClass("submitted")&&a.removeClass("submitted"),b.length&&(b.hasClass("selected")?"-1"!==jq("#activity-filter-select select").val()&&(jq("#activity-filter-select select").val("-1"),jq("#activity-filter-select select").trigger("change")):(jq("#activity-filter-select select").val("-1"),b.children("a").trigger("click")))}),jq("#whats-new-form").on("focusout",function(a){var c=jq(this);setTimeout(function(){if(!c.find(":hover").length){if(""!==b.val())return;b.animate({height:"2.2em"}),jq("#whats-new-options").slideUp(),jq("#aw-whats-new-submit").prop("disabled",!0),jq("#whats-new-content").removeClass("active"),b.parent().removeClass("active")}},0)}),jq("#aw-whats-new-submit").on("click",function(){var a,b=0,c=jq(this),d=c.closest("form#whats-new-form"),e={};return jq.each(d.serializeArray(),function(a,b){"_"!==b.name.substr(0,1)&&"whats-new"!==b.name.substr(0,9)&&(e[b.name]?jq.isArray(e[b.name])?e[b.name].push(b.value):e[b.name]=new Array(e[b.name],b.value):e[b.name]=b.value)}),d.find("*").each(function(){(jq.nodeName(this,"textarea")||jq.nodeName(this,"input"))&&jq(this).prop("disabled",!0)}),jq("div.error").remove(),c.addClass("loading"),c.prop("disabled",!0),d.addClass("submitted"),object="",item_id=jq("#whats-new-post-in").val(),content=jq("#whats-new").val(),firstrow=jq("#buddypress ul.activity-list li").first(),activity_row=firstrow,timestamp=null,firstrow.length&&(activity_row.hasClass("load-newest")&&(activity_row=firstrow.next()),timestamp=activity_row.prop("class").match(/date-recorded-([0-9]+)/)),timestamp&&(b=timestamp[1]),item_id>0&&(object=jq("#whats-new-post-object").val()),a=jq.extend({action:"post_update",cookie:bp_get_cookies(),_wpnonce_post_update:jq("#_wpnonce_post_update").val(),content:content,object:object,item_id:item_id,since:b,_bp_as_nonce:jq("#_bp_as_nonce").val()||""},e),jq.post(ajaxurl,a,function(a){if(d.find("*").each(function(){(jq.nodeName(this,"textarea")||jq.nodeName(this,"input"))&&jq(this).prop("disabled",!1)}),a[0]+a[1]==="-1")d.prepend(a.substr(2,a.length)),jq("#"+d.attr("id")+" div.error").hide().fadeIn(200);else{if(0===jq("ul.activity-list").length&&(jq("div.error").slideUp(100).remove(),jq("#message").slideUp(100).remove(),jq("div.activity").append('<ul id="activity-stream" class="activity-list item-list">')),firstrow.hasClass("load-newest")&&firstrow.remove(),jq("#activity-stream").prepend(a),b||jq("#activity-stream li:first").addClass("new-update just-posted"),0!==jq("#latest-update").length){var c=jq("#activity-stream li.new-update .activity-content .activity-inner p").html(),e=jq("#activity-stream li.new-update .activity-content .activity-header p a.view").attr("href"),f=jq("#activity-stream li.new-update .activity-content .activity-inner p").text(),g="";""!==f&&(g=c+" "),g+='<a href="'+e+'" rel="nofollow">'+BP_DTheme.view+"</a>",jq("#latest-update").slideUp(300,function(){jq("#latest-update").html(g),jq("#latest-update").slideDown(300)})}jq("li.new-update").hide().slideDown(300),jq("li.new-update").removeClass("new-update"),jq("#whats-new").val(""),d.get(0).reset(),newest_activities="",activity_last_recorded=0}jq("#whats-new-options").slideUp(),jq("#whats-new-form textarea").animate({height:"2.2em"}),jq("#aw-whats-new-submit").prop("disabled",!0).removeClass("loading"),jq("#whats-new-content").removeClass("active")}),!1}),jq("div.activity-type-tabs").on("click",function(a){var b,c,d=jq(a.target).parent();if("STRONG"===a.target.nodeName||"SPAN"===a.target.nodeName)d=d.parent();else if("A"!==a.target.nodeName)return!1;return jq.cookie("bp-activity-oldestpage",1,{path:"/"}),b=d.attr("id").substr(9,d.attr("id").length),c=jq("#activity-filter-select select").val(),"mentions"===b&&jq("#"+d.attr("id")+" a strong").remove(),bp_activity_request(b,c),!1}),jq("#activity-filter-select select").change(function(){var a,b=jq("div.activity-type-tabs li.selected"),c=jq(this).val();return a=b.length?b.attr("id").substr(9,b.attr("id").length):null,bp_activity_request(a,c),!1}),jq("div.activity").on("click",function(a){var b,c,d,e,f,g,h,i,j,k,l=jq(a.target);return l.hasClass("fav")||l.hasClass("unfav")?(b=l.hasClass("fav")?"fav":"unfav",c=l.closest(".activity-item"),d=c.attr("id").substr(9,c.attr("id").length),l.addClass("loading"),jq.post(ajaxurl,{action:"activity_mark_"+b,cookie:bp_get_cookies(),id:d},function(a){l.removeClass("loading"),l.fadeOut(200,function(){jq(this).html(a),jq(this).attr("title","fav"===b?BP_DTheme.remove_fav:BP_DTheme.mark_as_fav),jq(this).fadeIn(200)}),"fav"===b?(jq(".item-list-tabs #activity-favs-personal-li").length||(jq(".item-list-tabs #activity-favorites").length||jq(".item-list-tabs ul #activity-mentions").before('<li id="activity-favorites"><a href="#">'+BP_DTheme.my_favs+" <span>0</span></a></li>"),jq(".item-list-tabs ul #activity-favorites span").html(Number(jq(".item-list-tabs ul #activity-favorites span").html())+1)),l.removeClass("fav"),l.addClass("unfav")):(l.removeClass("unfav"),l.addClass("fav"),jq(".item-list-tabs ul #activity-favorites span").html(Number(jq(".item-list-tabs ul #activity-favorites span").html())-1),Number(jq(".item-list-tabs ul #activity-favorites span").html())||(jq(".item-list-tabs ul #activity-favorites").hasClass("selected")&&bp_activity_request(null,null),jq(".item-list-tabs ul #activity-favorites").remove())),"activity-favorites"===jq(".item-list-tabs li.selected").attr("id")&&l.closest(".activity-item").slideUp(100)}),!1):l.hasClass("delete-activity")?(e=l.parents("div.activity ul li"),f=e.attr("id").substr(9,e.attr("id").length),g=l.attr("href"),h=g.split("_wpnonce="),i=e.prop("class").match(/date-recorded-([0-9]+)/),h=h[1],l.addClass("loading"),jq.post(ajaxurl,{action:"delete_activity",cookie:bp_get_cookies(),id:f,_wpnonce:h},function(a){a[0]+a[1]==="-1"?(e.prepend(a.substr(2,a.length)),e.children("#message").hide().fadeIn(300)):(e.slideUp(300),i&&activity_last_recorded===i[1]&&(newest_activities="",activity_last_recorded=0))}),!1):l.hasClass("spam-activity")?(e=l.parents("div.activity ul li"),i=e.prop("class").match(/date-recorded-([0-9]+)/),l.addClass("loading"),jq.post(ajaxurl,{action:"bp_spam_activity",cookie:encodeURIComponent(document.cookie),id:e.attr("id").substr(9,e.attr("id").length),_wpnonce:l.attr("href").split("_wpnonce=")[1]},function(a){a[0]+a[1]==="-1"?(e.prepend(a.substr(2,a.length)),e.children("#message").hide().fadeIn(300)):(e.slideUp(300),i&&activity_last_recorded===i[1]&&(newest_activities="",activity_last_recorded=0))}),!1):l.parent().hasClass("load-more")?(bp_ajax_request&&bp_ajax_request.abort(),jq("#buddypress li.load-more").addClass("loading"),null===jq.cookie("bp-activity-oldestpage")&&jq.cookie("bp-activity-oldestpage",1,{path:"/"}),j=1*jq.cookie("bp-activity-oldestpage")+1,k=[],jq(".activity-list li.just-posted").each(function(){k.push(jq(this).attr("id").replace("activity-",""))}),load_more_args={action:"activity_get_older_updates",cookie:bp_get_cookies(),page:j,exclude_just_posted:k.join(",")},load_more_search=bp_get_querystring("s"),load_more_search&&(load_more_args.search_terms=load_more_search),bp_ajax_request=jq.post(ajaxurl,load_more_args,function(a){jq("#buddypress li.load-more").removeClass("loading"),jq.cookie("bp-activity-oldestpage",j,{path:"/"}),jq("#buddypress ul.activity-list").append(a.contents),l.parent().hide()},"json"),!1):void(l.parent().hasClass("load-newest")&&(a.preventDefault(),l.parent().hide(),activity_html=jq.parseHTML(newest_activities),jq.each(activity_html,function(a,b){"LI"===b.nodeName&&jq(b).hasClass("just-posted")&&jq("#"+jq(b).attr("id")).length&&jq("#"+jq(b).attr("id")).remove()}),jq("#buddypress ul.activity-list").prepend(newest_activities),newest_activities=""))}),jq("div.activity").on("click",".activity-read-more a",function(a){var b,c,d=jq(a.target),e=d.parent().attr("id").split("-"),f=e[3],g=e[0];return b="acomment"===g?"acomment-content":"activity-inner",c=jq("#"+g+"-"+f+" ."+b+":first"),jq(d).addClass("loading"),jq.post(ajaxurl,{action:"get_single_activity_content",activity_id:f},function(a){jq(c).slideUp(300).html(a).slideDown(300)}),!1}),jq("form.ac-form").hide(),jq(".activity-comments").length&&bp_legacy_theme_hide_comments(),jq("div.activity").on("click",function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=jq(a.target);return r.hasClass("acomment-reply")||r.parent().hasClass("acomment-reply")?(r.parent().hasClass("acomment-reply")&&(r=r.parent()),b=r.attr("id"),c=b.split("-"),d=c[2],e=r.attr("href").substr(10,r.attr("href").length),f=jq("#ac-form-"+d),f.css("display","none"),f.removeClass("root"),jq(".ac-form").hide(),f.children("div").each(function(){jq(this).hasClass("error")&&jq(this).hide()}),"comment"!==c[1]?jq("#acomment-"+e).append(f):jq("#activity-"+d+" .activity-comments").append(f),f.parent().hasClass("activity-comments")&&f.addClass("root"),f.slideDown(200),jq.scrollTo(f,500,{offset:-100,easing:"swing"}),jq("#ac-form-"+c[2]+" textarea").focus(),!1):"ac_form_submit"===r.attr("name")?(f=r.parents("form"),g=f.parent(),h=f.attr("id").split("-"),g.hasClass("activity-comments")?j=h[2]:(i=g.attr("id").split("-"),j=i[1]),content=jq("#"+f.attr("id")+" textarea"),jq("#"+f.attr("id")+" div.error").hide(),r.addClass("loading").prop("disabled",!0),content.addClass("loading").prop("disabled",!0),k={action:"new_activity_comment",cookie:bp_get_cookies(),_wpnonce_new_activity_comment:jq("#_wpnonce_new_activity_comment").val(),comment_id:j,form_id:h[2],content:content.val()},l=jq("#_bp_as_nonce_"+j).val(),l&&(k["_bp_as_nonce_"+j]=l),jq.post(ajaxurl,k,function(a){if(r.removeClass("loading"),content.removeClass("loading"),a[0]+a[1]==="-1")f.append(jq(a.substr(2,a.length)).hide().fadeIn(200));else{var b=f.parent();f.fadeOut(200,function(){0===b.children("ul").length&&(b.hasClass("activity-comments")?b.prepend("<ul></ul>"):b.append("<ul></ul>"));var c=jq.trim(a);b.children("ul").append(jq(c).hide().fadeIn(200)),f.children("textarea").val(""),b.parent().addClass("has-comments")}),jq("#"+f.attr("id")+" textarea").val(""),jq("#activity-"+h[2]+" a.acomment-reply span").html(Number(jq("#activity-"+h[2]+" a.acomment-reply span").html())+1),m=b.find(".show-all").find("a"),m&&(n=jq("li#activity-"+h[2]+" a.acomment-reply span").html(),m.html(BP_DTheme.show_x_comments.replace("%d",n)))}jq(r).prop("disabled",!1),jq(content).prop("disabled",!1)}),!1):r.hasClass("acomment-delete")?(o=r.attr("href"),p=r.parent().parent(),f=p.parents("div.activity-comments").children("form"),q=o.split("_wpnonce="),q=q[1],j=o.split("cid="),j=j[1].split("&"),j=j[0],r.addClass("loading"),jq(".activity-comments ul .error").remove(),p.parents(".activity-comments").append(f),jq.post(ajaxurl,{action:"delete_activity_comment",cookie:bp_get_cookies(),_wpnonce:q,id:j},function(a){if(a[0]+a[1]==="-1")p.prepend(jq(a.substr(2,a.length)).hide().fadeIn(200));else{var b,c,d,e=jq("#"+p.attr("id")+" ul").children("li"),f=0;jq(e).each(function(){jq(this).is(":hidden")||f++}),p.fadeOut(200,function(){p.remove()}),b=jq("#"+p.parents("#activity-stream > li").attr("id")+" a.acomment-reply span"),c=b.html()-(1+f),b.html(c),d=p.siblings(".show-all").find("a"),d&&d.html(BP_DTheme.show_x_comments.replace("%d",c)),0===c&&jq(p.parents("#activity-stream > li")).removeClass("has-comments")}}),!1):r.hasClass("spam-activity-comment")?(o=r.attr("href"),p=r.parent().parent(),r.addClass("loading"),jq(".activity-comments ul div.error").remove(),p.parents(".activity-comments").append(p.parents(".activity-comments").children("form")),jq.post(ajaxurl,{action:"bp_spam_activity_comment",cookie:encodeURIComponent(document.cookie),_wpnonce:o.split("_wpnonce=")[1],id:o.split("cid=")[1].split("&")[0]},function(a){if(a[0]+a[1]==="-1")p.prepend(jq(a.substr(2,a.length)).hide().fadeIn(200));else{var b,c=jq("#"+p.attr("id")+" ul").children("li"),d=0;jq(c).each(function(){jq(this).is(":hidden")||d++}),p.fadeOut(200),b=p.parents("#activity-stream > li"),jq("#"+b.attr("id")+" a.acomment-reply span").html(jq("#"+b.attr("id")+" a.acomment-reply span").html()-(1+d))}}),!1):r.parent().hasClass("show-all")?(r.parent().addClass("loading"),setTimeout(function(){r.parent().parent().children("li").fadeIn(200,function(){r.parent().remove()})},600),!1):r.hasClass("ac-reply-cancel")?(jq(r).closest(".ac-form").slideUp(200),!1):void 0}),jq(document).keydown(function(a){if(a=a||window.event,a.target?element=a.target:a.srcElement&&(element=a.srcElement),3===element.nodeType&&(element=element.parentNode),a.ctrlKey!==!0&&a.altKey!==!0&&a.metaKey!==!0){var b=a.keyCode?a.keyCode:a.which;27===b&&"TEXTAREA"===element.tagName&&jq(element).hasClass("ac-input")&&jq(element).parent().parent().parent().slideUp(200)}}),jq(".dir-search, .groups-members-search").on("click",function(a){if(!jq(this).hasClass("no-ajax")){var b,c,d,e=jq(a.target);return"submit"===e.attr("type")?(b=jq(".item-list-tabs li.selected").attr("id").split("-"),c=b[0],d=null,"groups-members-search"===a.currentTarget.className&&(c="group_members",d="groups/single/members"),bp_filter_request(c,jq.cookie("bp-"+c+"-filter"),jq.cookie("bp-"+c+"-scope"),"div."+c,e.parent().children("label").children("input").val(),1,jq.cookie("bp-"+c+"-extras"),null,d),!1):void 0}}),jq("div.item-list-tabs").on("click",function(a){if(!jq(this).hasClass("no-ajax")&&!jq(a.target).hasClass("no-ajax")){var b,c,d,e,f,g="SPAN"===a.target.nodeName?a.target.parentNode:a.target,h=jq(g).parent();return"LI"!==h[0].nodeName||h.hasClass("last")?void 0:(b=h.attr("id").split("-"),c=b[0],"activity"===c?!1:(d=b[1],e=jq("#"+c+"-order-select select").val(),f=jq("#"+c+"_search").val(),bp_filter_request(c,e,d,"div."+c,f,1,jq.cookie("bp-"+c+"-extras")),!1))}}),jq("li.filter select").change(function(){var a,b,c,d,e,f,g,h;return a=jq(jq(".item-list-tabs li.selected").length?".item-list-tabs li.selected":this),b=a.attr("id").split("-"),c=b[0],d=b[1],e=jq(this).val(),f=!1,g=null,jq(".dir-search input").length&&(f=jq(".dir-search input").val()),h=jq(".groups-members-search input"),h.length&&(f=h.val(),c="members",d="groups"),"members"===c&&"groups"===d&&(c="group_members",g="groups/single/members"),"friends"===c&&(c="members"),bp_filter_request(c,e,d,"div."+c,f,1,jq.cookie("bp-"+c+"-extras"),null,g),!1}),jq("#buddypress").on("click",function(a){var b,c,d,e,f,g,h,i,j,k=jq(a.target);return k.hasClass("button")?!0:k.parent().parent().hasClass("pagination")&&!k.parent().parent().hasClass("no-ajax")?k.hasClass("dots")||k.hasClass("current")?!1:(b=jq(jq(".item-list-tabs li.selected").length?".item-list-tabs li.selected":"li.filter select"),c=b.attr("id").split("-"),d=c[0],e=!1,f=jq(k).closest(".pagination-links").attr("id"),g=null,jq("div.dir-search input").length&&(e=jq(".dir-search input"),e=!e.val()&&bp_get_querystring(e.attr("name"))?jq(".dir-search input").prop("placeholder"):e.val()),h=jq(k).hasClass("next")||jq(k).hasClass("prev")?jq(".pagination span.current").html():jq(k).html(),h=Number(h.replace(/\D/g,"")),jq(k).hasClass("next")?h++:jq(k).hasClass("prev")&&h--,i=jq(".groups-members-search input"),i.length&&(e=i.val(),d="members"),"members"===d&&"groups"===c[1]&&(d="group_members",g="groups/single/members"),"admin"===d&&jq("body").hasClass("membership-requests")&&(d="requests"),j=-1!==f.indexOf("pag-bottom")?"pag-bottom":null,bp_filter_request(d,jq.cookie("bp-"+d+"-filter"),jq.cookie("bp-"+d+"-scope"),"div."+d,e,h,jq.cookie("bp-"+d+"-extras"),j,g),!1):void 0}),jq("a.show-hide-new").on("click",function(){return jq("#new-topic-post").length?(jq("#new-topic-post").is(":visible")?jq("#new-topic-post").slideUp(200):jq("#new-topic-post").slideDown(200,function(){jq("#topic_title").focus()}),!1):!1}),jq("#submit_topic_cancel").on("click",function(){return jq("#new-topic-post").length?(jq("#new-topic-post").slideUp(200),!1):!1}),jq("#forum-directory-tags a").on("click",function(){return bp_filter_request("forums","tags",jq.cookie("bp-forums-scope"),"div.forums",jq(this).html().replace(/&nbsp;/g,"-"),1,jq.cookie("bp-forums-extras")),!1}),jq("#send-invite-form").on("click","#invite-list input",function(){var a,b,c=jq("#send-invite-form > .invite").length;jq(".ajax-loader").toggle(),c&&jq(this).parents("ul").find("input").prop("disabled",!0),a=jq(this).val(),b=jq(this).prop("checked")===!0?"invite":"uninvite",c||jq(".item-list-tabs li.selected").addClass("loading"),jq.post(ajaxurl,{action:"groups_invite_user",friend_action:b,cookie:bp_get_cookies(),_wpnonce:jq("#_wpnonce_invite_uninvite_user").val(),friend_id:a,group_id:jq("#group_id").val()},function(d){jq("#message")&&jq("#message").hide(),c?bp_filter_request("invite","bp-invite-filter","bp-invite-scope","div.invite",!1,1,"","",""):(jq(".ajax-loader").toggle(),"invite"===b?jq("#friend-list").append(d):"uninvite"===b&&jq("#friend-list li#uid-"+a).remove(),jq(".item-list-tabs li.selected").removeClass("loading"))})}),jq("#send-invite-form").on("click","a.remove",function(){var a=jq("#send-invite-form > .invite").length,b=jq(this).attr("id");return jq(".ajax-loader").toggle(),b=b.split("-"),b=b[1],jq.post(ajaxurl,{action:"groups_invite_user",friend_action:"uninvite",cookie:bp_get_cookies(),_wpnonce:jq("#_wpnonce_invite_uninvite_user").val(),friend_id:b,group_id:jq("#group_id").val()},function(c){a?bp_filter_request("invite","bp-invite-filter","bp-invite-scope","div.invite",!1,1,"","",""):(jq(".ajax-loader").toggle(),jq("#friend-list #uid-"+b).remove(),jq("#invite-list #f-"+b).prop("checked",!1))}),!1}),jq(".visibility-toggle-link").on("click",function(a){a.preventDefault(),jq(this).parent().hide().addClass("field-visibility-settings-hide").siblings(".field-visibility-settings").show().addClass("field-visibility-settings-open")}),jq(".field-visibility-settings-close").on("click",function(a){a.preventDefault();var b=jq(this).parent(),c=b.find("input:checked").parent().text();b.hide().removeClass("field-visibility-settings-open").siblings(".field-visibility-settings-toggle").children(".current-visibility-level").text(c).end().show().removeClass("field-visibility-settings-hide")}),jq("#profile-edit-form input:not(:submit), #profile-edit-form textarea, #profile-edit-form select, #signup_form input:not(:submit), #signup_form textarea, #signup_form select").change(function(){var a=!0;jq("#profile-edit-form input:submit, #signup_form input:submit").on("click",function(){a=!1}),window.onbeforeunload=function(b){return a?BP_DTheme.unsaved_changes:void 0}}),jq("#friend-list a.accept, #friend-list a.reject").on("click",function(){var a,b=jq(this),c=jq(this).parents("#friend-list li"),d=jq(this).parents("li div.action"),e=c.attr("id").substr(11,c.attr("id").length),f=b.attr("href"),g=f.split("_wpnonce=")[1];return jq(this).hasClass("accepted")||jq(this).hasClass("rejected")?!1:(jq(this).hasClass("accept")?(a="accept_friendship",d.children("a.reject").css("visibility","hidden")):(a="reject_friendship",d.children("a.accept").css("visibility","hidden")),b.addClass("loading"),jq.post(ajaxurl,{action:a,cookie:bp_get_cookies(),id:e,_wpnonce:g},function(a){b.removeClass("loading"),a[0]+a[1]==="-1"?(c.prepend(a.substr(2,a.length)),c.children("#message").hide().fadeIn(200)):b.fadeOut(100,function(){jq(this).hasClass("accept")?(d.children("a.reject").hide(),jq(this).html(BP_DTheme.accepted).contents().unwrap()):(d.children("a.accept").hide(),jq(this).html(BP_DTheme.rejected).contents().unwrap())})}),!1)}),jq("#members-dir-list, #members-group-list, #item-header").on("click",".friendship-button a",function(){jq(this).parent().addClass("loading");var a=jq(this).attr("id"),b=jq(this).attr("href"),c=jq(this);return a=a.split("-"),a=a[1],b=b.split("?_wpnonce="),b=b[1].split("&"),b=b[0],jq.post(ajaxurl,{action:"addremove_friend",cookie:bp_get_cookies(),fid:a,_wpnonce:b},function(a){var b=c.attr("rel");parentdiv=c.parent(),"add"===b?jq(parentdiv).fadeOut(200,function(){parentdiv.removeClass("add_friend"),parentdiv.removeClass("loading"),parentdiv.addClass("pending_friend"),parentdiv.fadeIn(200).html(a)}):"remove"===b&&jq(parentdiv).fadeOut(200,function(){parentdiv.removeClass("remove_friend"),parentdiv.removeClass("loading"),parentdiv.addClass("add"),parentdiv.fadeIn(200).html(a)})}),!1}),jq("#buddypress").on("click",".group-button .leave-group",function(){return!1===confirm(BP_DTheme.leave_group_confirm)?!1:void 0}),jq("#groups-dir-list").on("click",".group-button a",function(){var a=jq(this).parent().attr("id"),b=jq(this).attr("href"),c=jq(this);return a=a.split("-"),a=a[1],b=b.split("?_wpnonce="),b=b[1].split("&"),b=b[0],c.hasClass("leave-group")&&!1===confirm(BP_DTheme.leave_group_confirm)?!1:(jq.post(ajaxurl,{action:"joinleave_group",cookie:bp_get_cookies(),gid:a,_wpnonce:b},function(a){var b=c.parent();jq("body.directory").length?jq(b).fadeOut(200,function(){b.fadeIn(200).html(a);var d=jq("#groups-personal span"),e=1;c.hasClass("leave-group")?(b.hasClass("hidden")&&b.closest("li").slideUp(200),e=0):c.hasClass("request-membership")&&(e=!1),d.length&&e!==!1&&(e?d.text((d.text()>>0)+1):d.text((d.text()>>0)-1))}):window.location.reload()}),!1)}),jq("#buddypress").on("click",".pending",function(){return!1}),jq("body").hasClass("register")){var d=jq("#signup_with_blog");d.prop("checked")||jq("#blog-details").toggle(),d.change(function(){jq("#blog-details").toggle()})}jq(".message-search").on("click",function(a){if(!jq(this).hasClass("no-ajax")){var b,c=jq(a.target);return"submit"===c.attr("type")||"button"===c.attr("type")?(b="messages",bp_filter_request(b,jq.cookie("bp-"+b+"-filter"),jq.cookie("bp-"+b+"-scope"),"div."+b,jq("#messages_search").val(),1,jq.cookie("bp-"+b+"-extras")),!1):void 0}}),jq("#send_reply_button").click(function(){var a=jq("#messages_order").val()||"ASC",b=jq("#message-recipients").offset(),c=jq("#send_reply_button");return jq(c).addClass("loading"),jq.post(ajaxurl,{action:"messages_send_reply",cookie:bp_get_cookies(),_wpnonce:jq("#send_message_nonce").val(),content:jq("#message_content").val(),send_to:jq("#send_to").val(),subject:jq("#subject").val(),thread_id:jq("#thread_id").val()},function(d){d[0]+d[1]==="-1"?jq("#send-reply").prepend(d.substr(2,d.length)):(jq("#send-reply #message").remove(),jq("#message_content").val(""),"ASC"===a?jq("#send-reply").before(d):(jq("#message-recipients").after(d),jq(window).scrollTop(b.top)),jq(".new-message").hide().slideDown(200,function(){jq(".new-message").removeClass("new-message")})),jq(c).removeClass("loading")}),!1}),jq("#mark_as_read, #mark_as_unread").click(function(){var a,b,c,d,e,f,g,h,i="",j=jq('#message-threads tr td input[type="checkbox"]');return"mark_as_unread"===jq(this).attr("id")?(a="read",b="unread",c=1,d=0,e="inline",f="messages_markunread"):(a="unread",b="read",c=0,d=1,e="none",f="messages_markread"),j.each(function(d){jq(this).is(":checked")&&jq("#m-"+jq(this).attr("value")).hasClass(a)&&(i+=jq(this).attr("value"),jq("#m-"+jq(this).attr("value")).removeClass(a),jq("#m-"+jq(this).attr("value")).addClass(b),h=jq("#m-"+jq(this).attr("value")+" td span.unread-count").html(),jq("#m-"+jq(this).attr("value")+" td span.unread-count").html(c),jq("#m-"+jq(this).attr("value")+" td span.unread-count").css("display",e),g=jq("tr.unread").length,jq("#user-messages span").html(g),d!==j.length-1&&(i+=","))}),jq.post(ajaxurl,{action:f,thread_ids:i}),!1}),jq("body.messages #item-body div.messages").on("change","#message-type-select",function(){var a=this.value,b=jq('td input[type="checkbox"]'),c="checked";switch(b.each(function(a){b[a].checked=""}),a){case"unread":b=jq('tr.unread td input[type="checkbox"]');break;case"read":b=jq('tr.read td input[type="checkbox"]');break;case"":c=""}b.each(function(a){b[a].checked=c})}),jq("body.messages #item-body div.messages").on("click",".messages-options-nav a",function(){return-1!==jq.inArray(this.id,Array("delete_sentbox_messages","delete_inbox_messages"))?(checkboxes_tosend="",checkboxes=jq('#message-threads tr td input[type="checkbox"]'),jq("#message").remove(),jq(this).addClass("loading"),jq(checkboxes).each(function(a){jq(this).is(":checked")&&(checkboxes_tosend+=jq(this).attr("value")+",")}),""===checkboxes_tosend?(jq(this).removeClass("loading"),!1):(jq.post(ajaxurl,{action:"messages_delete",thread_ids:checkboxes_tosend},function(a){a[0]+a[1]==="-1"?jq("#message-threads").prepend(a.substr(2,a.length)):(jq("#message-threads").before('<div id="message" class="updated"><p>'+a+"</p></div>"),jq(checkboxes).each(function(a){jq(this).is(":checked")&&(jq(this).attr("checked",!1),jq(this).parent().parent().fadeOut(150))})),jq("#message").hide().slideDown(150),jq("#delete_inbox_messages, #delete_sentbox_messages").removeClass("loading")}),!1)):void 0}),jq("#select-all-messages").click(function(a){this.checked?jq(".message-check").each(function(){this.checked=!0}):jq(".message-check").each(function(){this.checked=!1})}),jq("#messages-bulk-manage").attr("disabled","disabled"),jq("#messages-select").on("change",function(){jq("#messages-bulk-manage").attr("disabled",jq(this).val().length<=0)}),starAction=function(){var a=jq(this);return jq.post(ajaxurl,{action:"messages_star",message_id:a.data("message-id"),star_status:a.data("star-status"),nonce:a.data("star-nonce"),bulk:a.data("star-bulk")},function(b){1===parseInt(b,10)&&("unstar"===a.data("star-status")?(a.data("star-status","star"),a.removeClass("message-action-unstar").addClass("message-action-star"),a.find(".bp-screen-reader-text").text(BP_PM_Star.strings.text_star),1===BP_PM_Star.is_single_thread?a.prop("title",BP_PM_Star.strings.title_star):a.prop("title",BP_PM_Star.strings.title_star_thread)):(a.data("star-status","unstar"),a.removeClass("message-action-star").addClass("message-action-unstar"),a.find(".bp-screen-reader-text").text(BP_PM_Star.strings.text_unstar),1===BP_PM_Star.is_single_thread?a.prop("title",BP_PM_Star.strings.title_unstar):a.prop("title",BP_PM_Star.strings.title_unstar_thread)))}),!1},jq("#message-threads").on("click","td.thread-star a",starAction),jq("#message-thread").on("click",".message-star-actions a",starAction),jq("#message-threads td.bulk-select-check :checkbox").on("change",function(){var a=jq(this),b=a.closest("tr").find(".thread-star a");a.prop("checked")?"unstar"===b.data("star-status")?BP_PM_Star.star_counter++:BP_PM_Star.unstar_counter++:"unstar"===b.data("star-status")?BP_PM_Star.star_counter--:BP_PM_Star.unstar_counter--,BP_PM_Star.star_counter>0&&0===parseInt(BP_PM_Star.unstar_counter,10)?jq('option[value="star"]').hide():jq('option[value="star"]').show(),BP_PM_Star.unstar_counter>0&&0===parseInt(BP_PM_Star.star_counter,10)?jq('option[value="unstar"]').hide():jq('option[value="unstar"]').show()}),jq("#select-all-notifications").click(function(a){this.checked?jq(".notification-check").each(function(){
this.checked=!0}):jq(".notification-check").each(function(){this.checked=!1})}),jq("#notification-bulk-manage").attr("disabled","disabled"),jq("#notification-select").on("change",function(){jq("#notification-bulk-manage").attr("disabled",jq(this).val().length<=0)}),jq("#close-notice").on("click",function(){return jq(this).addClass("loading"),jq("#sidebar div.error").remove(),jq.post(ajaxurl,{action:"messages_close_notice",notice_id:jq(".notice").attr("rel").substr(2,jq(".notice").attr("rel").length)},function(a){jq("#close-notice").removeClass("loading"),a[0]+a[1]==="-1"?(jq(".notice").prepend(a.substr(2,a.length)),jq("#sidebar div.error").hide().fadeIn(200)):jq(".notice").slideUp(100)}),!1}),jq("#wp-admin-bar ul.main-nav li, #nav li").mouseover(function(){jq(this).addClass("sfhover")}),jq("#wp-admin-bar ul.main-nav li, #nav li").mouseout(function(){jq(this).removeClass("sfhover")}),jq("#wp-admin-bar-logout, a.logout").on("click",function(){jq.removeCookie("bp-activity-scope",{path:"/"}),jq.removeCookie("bp-activity-filter",{path:"/"}),jq.removeCookie("bp-activity-oldestpage",{path:"/"});var a=["members","groups","blogs","forums"];jq(a).each(function(b){jq.removeCookie("bp-"+a[b]+"-scope",{path:"/"}),jq.removeCookie("bp-"+a[b]+"-filter",{path:"/"}),jq.removeCookie("bp-"+a[b]+"-extras",{path:"/"})})}),jq("body").hasClass("no-js")&&jq("body").attr("class",jq("body").attr("class").replace(/no-js/,"js")),"undefined"!=typeof wp&&"undefined"!=typeof wp.heartbeat&&"undefined"!=typeof BP_DTheme.pulse&&(wp.heartbeat.interval(Number(BP_DTheme.pulse)),jq.fn.extend({"heartbeat-send":function(){return this.bind("heartbeat-send.buddypress")}}));var e=0;jq(document).on("heartbeat-send.buddypress",function(a,b){e=0,jq("#buddypress ul.activity-list li").first().prop("id")&&(timestamp=jq("#buddypress ul.activity-list li").first().prop("class").match(/date-recorded-([0-9]+)/),timestamp&&(e=timestamp[1])),(0===activity_last_recorded||Number(e)>activity_last_recorded)&&(activity_last_recorded=Number(e)),b.bp_activity_last_recorded=activity_last_recorded,last_recorded_search=bp_get_querystring("s"),last_recorded_search&&(b.bp_activity_last_recorded_search_terms=last_recorded_search)}),jq(document).on("heartbeat-tick",function(a,b){b.bp_activity_newest_activities&&(newest_activities=b.bp_activity_newest_activities.activities+newest_activities,activity_last_recorded=Number(b.bp_activity_newest_activities.last_recorded),jq("#buddypress ul.activity-list li").first().hasClass("load-newest")||jq("#buddypress ul.activity-list").prepend('<li class="load-newest"><a href="#newest">'+BP_DTheme.newest+"</a></li>"))})});
;/**
  * Klass.js - copyright @dedfat
  * version 1.0
  * https://github.com/ded/klass
  * Follow our software http://twitter.com/dedfat :)
  * MIT License
  */
!function(a,b){function j(a,b){function c(){}c[e]=this[e];var d=this,g=new c,h=f(a),j=h?a:this,k=h?{}:a,l=function(){this.initialize?this.initialize.apply(this,arguments):(b||h&&d.apply(this,arguments),j.apply(this,arguments))};l.methods=function(a){i(g,a,d),l[e]=g;return this},l.methods.call(l,k).prototype.constructor=l,l.extend=arguments.callee,l[e].implement=l.statics=function(a,b){a=typeof a=="string"?function(){var c={};c[a]=b;return c}():a,i(this,a,d);return this};return l}function i(a,b,d){for(var g in b)b.hasOwnProperty(g)&&(a[g]=f(b[g])&&f(d[e][g])&&c.test(b[g])?h(g,b[g],d):b[g])}function h(a,b,c){return function(){var d=this.supr;this.supr=c[e][a];var f=b.apply(this,arguments);this.supr=d;return f}}function g(a){return j.call(f(a)?a:d,a,1)}var c=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,d=function(){},e="prototype",f=function(a){return typeof a===b};if(typeof module!="undefined"&&module.exports)module.exports=g;else{var k=a.klass;g.noConflict=function(){a.klass=k;return this},a.klass=g}}(this,"function")

;// PhotoSwipe - http://www.photoswipe.com/
// Copyright (c) 2012 by Code Computerlove (http://www.codecomputerlove.com)
// Licensed under the MIT license
// version: 3.0.5
(function(e){if(!Function.prototype.bind)Function.prototype.bind=function(d){var a=[].slice,b=a.call(arguments,1),c=this,g=function(){},f=function(){return c.apply(this instanceof g?this:d||{},b.concat(a.call(arguments)))};g.prototype=c.prototype;f.prototype=new g;return f};if(typeof e.Code==="undefined")e.Code={};e.Code.Util={registerNamespace:function(){var d=arguments,a=null,b,c,g,f,i;b=0;for(f=d.length;b<f;b++){g=d[b];g=g.split(".");a=g[0];typeof e[a]==="undefined"&&(e[a]={});a=e[a];c=1;for(i=
g.length;c<i;++c)a[g[c]]=a[g[c]]||{},a=a[g[c]]}},coalesce:function(){var d,a;d=0;for(a=arguments.length;d<a;d++)if(!this.isNothing(arguments[d]))return arguments[d];return null},extend:function(d,a,b){var c;this.isNothing(b)&&(b=!0);if(d&&a&&this.isObject(a))for(c in a)this.objectHasProperty(a,c)&&(b?d[c]=a[c]:typeof d[c]==="undefined"&&(d[c]=a[c]))},clone:function(d){var a={};this.extend(a,d);return a},isObject:function(d){return d instanceof Object},isFunction:function(d){return{}.toString.call(d)===
"[object Function]"},isArray:function(d){return d instanceof Array},isLikeArray:function(d){return typeof d.length==="number"},isNumber:function(d){return typeof d==="number"},isString:function(d){return typeof d==="string"},isNothing:function(d){if(typeof d==="undefined"||d===null)return!0;return!1},swapArrayElements:function(d,a,b){var c=d[a];d[a]=d[b];d[b]=c},trim:function(d){return d.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},toCamelCase:function(d){return d.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-",
"")})},toDashedCase:function(d){return d.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},arrayIndexOf:function(d,a,b){var c,g,f,e;f=-1;c=0;for(g=a.length;c<g;c++)if(e=a[c],this.isNothing(b)){if(e===d){f=c;break}}else if(this.objectHasProperty(e,b)&&e[b]===d){f=c;break}return f},objectHasProperty:function(d,a){return d.hasOwnProperty?d.hasOwnProperty(a):"undefined"!==typeof d[a]}}})(window);
(function(e,d){d.Browser={ua:null,version:null,safari:null,webkit:null,opera:null,msie:null,chrome:null,mozilla:null,android:null,blackberry:null,iPad:null,iPhone:null,iPod:null,iOS:null,is3dSupported:null,isCSSTransformSupported:null,isTouchSupported:null,isGestureSupported:null,_detect:function(){this.ua=e.navigator.userAgent;this.version=this.ua.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[];this.safari=/Safari/gi.test(e.navigator.appVersion);this.webkit=/webkit/i.test(this.ua);this.opera=/opera/i.test(this.ua);
this.msie=/msie/i.test(this.ua)&&!this.opera;this.chrome=/Chrome/i.test(this.ua);this.firefox=/Firefox/i.test(this.ua);this.fennec=/Fennec/i.test(this.ua);this.mozilla=/mozilla/i.test(this.ua)&&!/(compatible|webkit)/.test(this.ua);this.android=/android/i.test(this.ua);this.blackberry=/blackberry/i.test(this.ua);this.iOS=/iphone|ipod|ipad/gi.test(e.navigator.platform);this.iPad=/ipad/gi.test(e.navigator.platform);this.iPhone=/iphone/gi.test(e.navigator.platform);this.iPod=/ipod/gi.test(e.navigator.platform);
var a=document.createElement("div");this.is3dSupported=!d.isNothing(a.style.WebkitPerspective);this.isCSSTransformSupported=!d.isNothing(a.style.WebkitTransform)||!d.isNothing(a.style.MozTransform)||!d.isNothing(a.style.transformProperty);this.isTouchSupported=this.isEventSupported("touchstart");this.isGestureSupported=this.isEventSupported("gesturestart")},_eventTagNames:{select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"},isEventSupported:function(a){var b=
document.createElement(this._eventTagNames[a]||"div"),c,a="on"+a;c=d.objectHasProperty(b,a);c||(b.setAttribute(a,"return;"),c=typeof b[a]==="function");return c},isLandscape:function(){return d.DOM.windowWidth()>d.DOM.windowHeight()}};d.Browser._detect()})(window,window.Code.Util);
(function(e,d,a){a.extend(a,{Events:{add:function(a,c,g){d(a).bind(c,g)},remove:function(a,c,g){d(a).unbind(c,g)},fire:function(a,c){var g,f=Array.prototype.slice.call(arguments).splice(2);g=typeof c==="string"?{type:c}:c;d(a).trigger(d.Event(g.type,g),f)},getMousePosition:function(a){return{x:a.pageX,y:a.pageY}},getTouchEvent:function(a){return a.originalEvent},getWheelDelta:function(b){var c=0;a.isNothing(b.wheelDelta)?a.isNothing(b.detail)||(c=-b.detail/3):c=b.wheelDelta/120;return c},domReady:function(a){d(document).ready(a)}}})})(window,
window.jQuery,window.Code.Util);
(function(e,d,a){a.extend(a,{DOM:{setData:function(b,c,g){if(a.isLikeArray(b)){var f,d;f=0;for(d=b.length;f<d;f++)a.DOM._setData(b[f],c,g)}else a.DOM._setData(b,c,g)},_setData:function(b,c,g){a.DOM.setAttribute(b,"data-"+c,g)},getData:function(b,c,g){return a.DOM.getAttribute(b,"data-"+c,g)},removeData:function(b,c){if(a.isLikeArray(b)){var g,f;g=0;for(f=b.length;g<f;g++)a.DOM._removeData(b[g],c)}else a.DOM._removeData(b,c)},_removeData:function(b,c){a.DOM.removeAttribute(b,"data-"+c)},isChildOf:function(a,
c){if(c===a)return!1;for(;a&&a!==c;)a=a.parentNode;return a===c},find:function(b,c){if(a.isNothing(c))c=e.document;var g=d(b,c),f=[],i,j;i=0;for(j=g.length;i<j;i++)f.push(g[i]);return f},createElement:function(a,c,g){a=d("<"+a+"></"+a+">");a.attr(c);a.append(g);return a[0]},appendChild:function(a,c){d(c).append(a)},insertBefore:function(a,c){d(a).insertBefore(c)},appendText:function(a,c){d(c).text(a)},appendToBody:function(a){d("body").append(a)},removeChild:function(a){d(a).empty().remove()},removeChildren:function(a){d(a).empty()},
hasAttribute:function(b,c){return!a.isNothing(d(b).attr(c))},getAttribute:function(b,c,g){b=d(b).attr(c);a.isNothing(b)&&!a.isNothing(g)&&(b=g);return b},setAttribute:function(b,c,g){if(a.isLikeArray(b)){var f,d;f=0;for(d=b.length;f<d;f++)a.DOM._setAttribute(b[f],c,g)}else a.DOM._setAttribute(b,c,g)},_setAttribute:function(a,c,g){d(a).attr(c,g)},removeAttribute:function(b,c){if(a.isLikeArray(b)){var g,f;g=0;for(f=b.length;g<f;g++)a.DOM._removeAttribute(b[g],c)}else a.DOM._removeAttribute(b,c)},_removeAttribute:function(a,
c){d(a).removeAttr(c)},addClass:function(b,c){if(a.isLikeArray(b)){var g,f;g=0;for(f=b.length;g<f;g++)a.DOM._addClass(b[g],c)}else a.DOM._addClass(b,c)},_addClass:function(a,c){d(a).addClass(c)},removeClass:function(b,c){if(a.isLikeArray(b)){var g,f;g=0;for(f=b.length;g<f;g++)a.DOM._removeClass(b[g],c)}else a.DOM._removeClass(b,c)},_removeClass:function(a,c){d(a).removeClass(c)},hasClass:function(a,c){d(a).hasClass(c)},setStyle:function(b,c,g){if(a.isLikeArray(b)){var f,d;f=0;for(d=b.length;f<d;f++)a.DOM._setStyle(b[f],
c,g)}else a.DOM._setStyle(b,c,g)},_setStyle:function(b,c,g){var f;if(a.isObject(c))for(f in c)a.objectHasProperty(c,f)&&(f==="width"?a.DOM.width(b,c[f]):f==="height"?a.DOM.height(b,c[f]):d(b).css(f,c[f]));else d(b).css(c,g)},getStyle:function(a,c){return d(a).css(c)},hide:function(b){if(a.isLikeArray(b)){var c,g;c=0;for(g=b.length;c<g;c++)a.DOM._hide(b[c])}else a.DOM._hide(b)},_hide:function(a){d(a).hide()},show:function(b){if(a.isLikeArray(b)){var c,g;c=0;for(g=b.length;c<g;c++)a.DOM._show(b[c])}else a.DOM._show(b)},
_show:function(a){d(a).show()},width:function(b,c){a.isNothing(c)||d(b).width(c);return d(b).width()},outerWidth:function(a){return d(a).outerWidth()},height:function(b,c){a.isNothing(c)||d(b).height(c);return d(b).height()},outerHeight:function(a){return d(a).outerHeight()},documentWidth:function(){return d(document.documentElement).width()},documentHeight:function(){return d(document.documentElement).height()},documentOuterWidth:function(){return a.DOM.width(document.documentElement)},documentOuterHeight:function(){return a.DOM.outerHeight(document.documentElement)},
bodyWidth:function(){return d(document.body).width()},bodyHeight:function(){return d(document.body).height()},bodyOuterWidth:function(){return a.DOM.outerWidth(document.body)},bodyOuterHeight:function(){return a.DOM.outerHeight(document.body)},windowWidth:function(){if(!e.innerWidth)return d(e).width();return e.innerWidth},windowHeight:function(){if(!e.innerHeight)return d(e).height();return e.innerHeight},windowScrollLeft:function(){if(!e.pageXOffset)return d(e).scrollLeft();return e.pageXOffset},
windowScrollTop:function(){if(!e.pageYOffset)return d(e).scrollTop();return e.pageYOffset}}})})(window,window.jQuery,window.Code.Util);
(function(e,d){d.extend(d,{Animation:{_applyTransitionDelay:50,_transitionEndLabel:e.document.documentElement.style.webkitTransition!==void 0?"webkitTransitionEnd":"transitionend",_transitionEndHandler:null,_transitionPrefix:e.document.documentElement.style.webkitTransition!==void 0?"webkitTransition":e.document.documentElement.style.MozTransition!==void 0?"MozTransition":"transition",_transformLabel:e.document.documentElement.style.webkitTransform!==void 0?"webkitTransform":e.document.documentElement.style.MozTransition!==
void 0?"MozTransform":"transform",_getTransitionEndHandler:function(){if(d.isNothing(this._transitionEndHandler))this._transitionEndHandler=this._onTransitionEnd.bind(this);return this._transitionEndHandler},stop:function(a){if(d.Browser.isCSSTransformSupported){var b={};d.Events.remove(a,this._transitionEndLabel,this._getTransitionEndHandler());d.isNothing(a.callbackLabel)&&delete a.callbackLabel;b[this._transitionPrefix+"Property"]="";b[this._transitionPrefix+"Duration"]="";b[this._transitionPrefix+
"TimingFunction"]="";b[this._transitionPrefix+"Delay"]="";b[this._transformLabel]="";d.DOM.setStyle(a,b)}else d.isNothing(e.jQuery)||e.jQuery(a).stop(!0,!0)},fadeIn:function(a,b,c,g,f){f=d.coalesce(f,1);f<=0&&(f=1);if(b<=0&&(d.DOM.setStyle(a,"opacity",f),!d.isNothing(c))){c(a);return}d.DOM.getStyle(a,"opacity")>=1&&d.DOM.setStyle(a,"opacity",0);d.Browser.isCSSTransformSupported?this._applyTransition(a,"opacity",f,b,c,g):d.isNothing(e.jQuery)||e.jQuery(a).fadeTo(b,f,c)},fadeTo:function(a,b,c,g,f){this.fadeIn(a,
c,g,f,b)},fadeOut:function(a,b,c,g){if(b<=0&&(d.DOM.setStyle(a,"opacity",0),!d.isNothing(c))){c(a);return}d.Browser.isCSSTransformSupported?this._applyTransition(a,"opacity",0,b,c,g):e.jQuery(a).fadeTo(b,0,c)},slideBy:function(a,b,c,g,f,i){var j={},b=d.coalesce(b,0),c=d.coalesce(c,0),i=d.coalesce(i,"ease-out");j[this._transitionPrefix+"Property"]="all";j[this._transitionPrefix+"Delay"]="0";g===0?(j[this._transitionPrefix+"Duration"]="",j[this._transitionPrefix+"TimingFunction"]=""):(j[this._transitionPrefix+
"Duration"]=g+"ms",j[this._transitionPrefix+"TimingFunction"]=d.coalesce(i,"ease-out"),d.Events.add(a,this._transitionEndLabel,this._getTransitionEndHandler()));j[this._transformLabel]=d.Browser.is3dSupported?"translate3d("+b+"px, "+c+"px, 0px)":"translate("+b+"px, "+c+"px)";if(!d.isNothing(f))a.cclallcallback=f;d.DOM.setStyle(a,j);g===0&&e.setTimeout(function(){this._leaveTransforms(a)}.bind(this),this._applyTransitionDelay)},resetTranslate:function(a){var b={};b[this._transformLabel]=b[this._transformLabel]=
d.Browser.is3dSupported?"translate3d(0px, 0px, 0px)":"translate(0px, 0px)";d.DOM.setStyle(a,b)},_applyTransition:function(a,b,c,g,f,i){var j={},i=d.coalesce(i,"ease-in");j[this._transitionPrefix+"Property"]=b;j[this._transitionPrefix+"Duration"]=g+"ms";j[this._transitionPrefix+"TimingFunction"]=i;j[this._transitionPrefix+"Delay"]="0";d.Events.add(a,this._transitionEndLabel,this._getTransitionEndHandler());d.DOM.setStyle(a,j);d.isNothing(f)||(a["ccl"+b+"callback"]=f);e.setTimeout(function(){d.DOM.setStyle(a,
b,c)},this._applyTransitionDelay)},_onTransitionEnd:function(a){d.Events.remove(a.currentTarget,this._transitionEndLabel,this._getTransitionEndHandler());this._leaveTransforms(a.currentTarget)},_leaveTransforms:function(a){var b=a.style[this._transitionPrefix+"Property"],c=b!==""?"ccl"+b+"callback":"cclallcallback",g,b=d.coalesce(a.style.webkitTransform,a.style.MozTransform,a.style.transform),f,i=e.parseInt(d.DOM.getStyle(a,"left"),0),j=e.parseInt(d.DOM.getStyle(a,"top"),0),h,l,k={};b!==""&&(b=d.Browser.is3dSupported?
b.match(/translate3d\((.*?)\)/):b.match(/translate\((.*?)\)/),d.isNothing(b)||(f=b[1].split(", "),h=e.parseInt(f[0],0),l=e.parseInt(f[1],0)));k[this._transitionPrefix+"Property"]="";k[this._transitionPrefix+"Duration"]="";k[this._transitionPrefix+"TimingFunction"]="";k[this._transitionPrefix+"Delay"]="";d.DOM.setStyle(a,k);e.setTimeout(function(){if(!d.isNothing(f))k={},k[this._transformLabel]="",k.left=i+h+"px",k.top=j+l+"px",d.DOM.setStyle(a,k);d.isNothing(a[c])||(g=a[c],delete a[c],g(a))}.bind(this),
this._applyTransitionDelay)}}})})(window,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.Util.TouchElement");a.TouchElement.EventTypes={onTouch:"CodeUtilTouchElementOnTouch"};a.TouchElement.ActionTypes={touchStart:"touchStart",touchMove:"touchMove",touchEnd:"touchEnd",touchMoveEnd:"touchMoveEnd",tap:"tap",doubleTap:"doubleTap",swipeLeft:"swipeLeft",swipeRight:"swipeRight",swipeUp:"swipeUp",swipeDown:"swipeDown",gestureStart:"gestureStart",gestureChange:"gestureChange",gestureEnd:"gestureEnd"}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.Util.TouchElement");a.TouchElement.TouchElementClass=d({el:null,captureSettings:null,touchStartPoint:null,touchEndPoint:null,touchStartTime:null,doubleTapTimeout:null,touchStartHandler:null,touchMoveHandler:null,touchEndHandler:null,mouseDownHandler:null,mouseMoveHandler:null,mouseUpHandler:null,mouseOutHandler:null,gestureStartHandler:null,gestureChangeHandler:null,gestureEndHandler:null,swipeThreshold:null,swipeTimeThreshold:null,doubleTapSpeed:null,dispose:function(){var b;
this.removeEventHandlers();for(b in this)a.objectHasProperty(this,b)&&(this[b]=null)},initialize:function(b,c){this.el=b;this.captureSettings={swipe:!1,move:!1,gesture:!1,doubleTap:!1,preventDefaultTouchEvents:!0};a.extend(this.captureSettings,c);this.swipeThreshold=50;this.doubleTapSpeed=this.swipeTimeThreshold=250;this.touchStartPoint={x:0,y:0};this.touchEndPoint={x:0,y:0}},addEventHandlers:function(){if(a.isNothing(this.touchStartHandler))this.touchStartHandler=this.onTouchStart.bind(this),this.touchMoveHandler=
this.onTouchMove.bind(this),this.touchEndHandler=this.onTouchEnd.bind(this),this.mouseDownHandler=this.onMouseDown.bind(this),this.mouseMoveHandler=this.onMouseMove.bind(this),this.mouseUpHandler=this.onMouseUp.bind(this),this.mouseOutHandler=this.onMouseOut.bind(this),this.gestureStartHandler=this.onGestureStart.bind(this),this.gestureChangeHandler=this.onGestureChange.bind(this),this.gestureEndHandler=this.onGestureEnd.bind(this);a.Events.add(this.el,"touchstart",this.touchStartHandler);this.captureSettings.move&&
a.Events.add(this.el,"touchmove",this.touchMoveHandler);a.Events.add(this.el,"touchend",this.touchEndHandler);a.Events.add(this.el,"mousedown",this.mouseDownHandler);a.Browser.isGestureSupported&&this.captureSettings.gesture&&(a.Events.add(this.el,"gesturestart",this.gestureStartHandler),a.Events.add(this.el,"gesturechange",this.gestureChangeHandler),a.Events.add(this.el,"gestureend",this.gestureEndHandler))},removeEventHandlers:function(){a.Events.remove(this.el,"touchstart",this.touchStartHandler);
this.captureSettings.move&&a.Events.remove(this.el,"touchmove",this.touchMoveHandler);a.Events.remove(this.el,"touchend",this.touchEndHandler);a.Events.remove(this.el,"mousedown",this.mouseDownHandler);a.Browser.isGestureSupported&&this.captureSettings.gesture&&(a.Events.remove(this.el,"gesturestart",this.gestureStartHandler),a.Events.remove(this.el,"gesturechange",this.gestureChangeHandler),a.Events.remove(this.el,"gestureend",this.gestureEndHandler))},getTouchPoint:function(a){return{x:a[0].pageX,
y:a[0].pageY}},fireTouchEvent:function(b){var c=0,g=0,f=0,d,c=this.touchEndPoint.x-this.touchStartPoint.x,g=this.touchEndPoint.y-this.touchStartPoint.y,f=Math.sqrt(c*c+g*g);if(this.captureSettings.swipe&&(d=new Date,d-=this.touchStartTime,d<=this.swipeTimeThreshold)){if(e.Math.abs(c)>=this.swipeThreshold){a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:c<0?a.TouchElement.ActionTypes.swipeLeft:a.TouchElement.ActionTypes.swipeRight,targetEl:b.target,
currentTargetEl:b.currentTarget});return}if(e.Math.abs(g)>=this.swipeThreshold){a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:g<0?a.TouchElement.ActionTypes.swipeUp:a.TouchElement.ActionTypes.swipeDown,targetEl:b.target,currentTargetEl:b.currentTarget});return}}f>1?a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.touchMoveEnd,point:this.touchEndPoint,targetEl:b.target,currentTargetEl:b.currentTarget}):
this.captureSettings.doubleTap?a.isNothing(this.doubleTapTimeout)?this.doubleTapTimeout=e.setTimeout(function(){this.doubleTapTimeout=null;a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:a.TouchElement.ActionTypes.tap,targetEl:b.target,currentTargetEl:b.currentTarget})}.bind(this),this.doubleTapSpeed):(e.clearTimeout(this.doubleTapTimeout),this.doubleTapTimeout=null,a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,
action:a.TouchElement.ActionTypes.doubleTap,targetEl:b.target,currentTargetEl:b.currentTarget})):a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,point:this.touchEndPoint,action:a.TouchElement.ActionTypes.tap,targetEl:b.target,currentTargetEl:b.currentTarget})},onTouchStart:function(b){this.captureSettings.preventDefaultTouchEvents&&b.preventDefault();a.Events.remove(this.el,"mousedown",this.mouseDownHandler);var c=a.Events.getTouchEvent(b).touches;c.length>1&&this.captureSettings.gesture?
this.isGesture=!0:(this.touchStartTime=new Date,this.isGesture=!1,this.touchStartPoint=this.getTouchPoint(c),a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.touchStart,point:this.touchStartPoint,targetEl:b.target,currentTargetEl:b.currentTarget}))},onTouchMove:function(b){this.captureSettings.preventDefaultTouchEvents&&b.preventDefault();if(!this.isGesture||!this.captureSettings.gesture){var c=a.Events.getTouchEvent(b).touches;a.Events.fire(this,
{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.touchMove,point:this.getTouchPoint(c),targetEl:b.target,currentTargetEl:b.currentTarget})}},onTouchEnd:function(b){if(!this.isGesture||!this.captureSettings.gesture){this.captureSettings.preventDefaultTouchEvents&&b.preventDefault();var c=a.Events.getTouchEvent(b);this.touchEndPoint=this.getTouchPoint(!a.isNothing(c.changedTouches)?c.changedTouches:c.touches);a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,
target:this,action:a.TouchElement.ActionTypes.touchEnd,point:this.touchEndPoint,targetEl:b.target,currentTargetEl:b.currentTarget});this.fireTouchEvent(b)}},onMouseDown:function(b){b.preventDefault();a.Events.remove(this.el,"touchstart",this.mouseDownHandler);a.Events.remove(this.el,"touchmove",this.touchMoveHandler);a.Events.remove(this.el,"touchend",this.touchEndHandler);this.captureSettings.move&&a.Events.add(this.el,"mousemove",this.mouseMoveHandler);a.Events.add(this.el,"mouseup",this.mouseUpHandler);
a.Events.add(this.el,"mouseout",this.mouseOutHandler);this.touchStartTime=new Date;this.isGesture=!1;this.touchStartPoint=a.Events.getMousePosition(b);a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.touchStart,point:this.touchStartPoint,targetEl:b.target,currentTargetEl:b.currentTarget})},onMouseMove:function(b){b.preventDefault();a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.touchMove,
point:a.Events.getMousePosition(b),targetEl:b.target,currentTargetEl:b.currentTarget})},onMouseUp:function(b){b.preventDefault();this.captureSettings.move&&a.Events.remove(this.el,"mousemove",this.mouseMoveHandler);a.Events.remove(this.el,"mouseup",this.mouseUpHandler);a.Events.remove(this.el,"mouseout",this.mouseOutHandler);this.touchEndPoint=a.Events.getMousePosition(b);a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.touchEnd,point:this.touchEndPoint,
targetEl:b.target,currentTargetEl:b.currentTarget});this.fireTouchEvent(b)},onMouseOut:function(b){var c=b.relatedTarget;if(!(this.el===c||a.DOM.isChildOf(c,this.el)))b.preventDefault(),this.captureSettings.move&&a.Events.remove(this.el,"mousemove",this.mouseMoveHandler),a.Events.remove(this.el,"mouseup",this.mouseUpHandler),a.Events.remove(this.el,"mouseout",this.mouseOutHandler),this.touchEndPoint=a.Events.getMousePosition(b),a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,
action:a.TouchElement.ActionTypes.touchEnd,point:this.touchEndPoint,targetEl:b.target,currentTargetEl:b.currentTarget}),this.fireTouchEvent(b)},onGestureStart:function(b){b.preventDefault();var c=a.Events.getTouchEvent(b);a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.gestureStart,scale:c.scale,rotation:c.rotation,targetEl:b.target,currentTargetEl:b.currentTarget})},onGestureChange:function(b){b.preventDefault();var c=a.Events.getTouchEvent(b);
a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.gestureChange,scale:c.scale,rotation:c.rotation,targetEl:b.target,currentTargetEl:b.currentTarget})},onGestureEnd:function(b){b.preventDefault();var c=a.Events.getTouchEvent(b);a.Events.fire(this,{type:a.TouchElement.EventTypes.onTouch,target:this,action:a.TouchElement.ActionTypes.gestureEnd,scale:c.scale,rotation:c.rotation,targetEl:b.target,currentTargetEl:b.currentTarget})}})})(window,window.klass,
window.Code.Util);(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Image");e.Code.PhotoSwipe.Image.EventTypes={onLoad:"onLoad",onError:"onError"}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Image");var b=e.Code.PhotoSwipe;b.Image.ImageClass=d({refObj:null,imageEl:null,src:null,caption:null,metaData:null,imageLoadHandler:null,imageErrorHandler:null,dispose:function(){var c;this.shrinkImage();for(c in this)a.objectHasProperty(this,c)&&(this[c]=null)},initialize:function(a,b,f,d){this.refObj=a;this.src=this.originalSrc=b;this.caption=f;this.metaData=d;this.imageEl=new e.Image;this.imageLoadHandler=this.onImageLoad.bind(this);this.imageErrorHandler=
this.onImageError.bind(this)},load:function(){this.imageEl.originalSrc=a.coalesce(this.imageEl.originalSrc,"");this.imageEl.originalSrc===this.src?this.imageEl.isError?a.Events.fire(this,{type:b.Image.EventTypes.onError,target:this}):a.Events.fire(this,{type:b.Image.EventTypes.onLoad,target:this}):(this.imageEl.isError=!1,this.imageEl.isLoading=!0,this.imageEl.naturalWidth=null,this.imageEl.naturalHeight=null,this.imageEl.isLandscape=!1,this.imageEl.onload=this.imageLoadHandler,this.imageEl.onerror=
this.imageErrorHandler,this.imageEl.onabort=this.imageErrorHandler,this.imageEl.originalSrc=this.src,this.imageEl.src=this.src)},shrinkImage:function(){if(!a.isNothing(this.imageEl)&&this.imageEl.src.indexOf(this.src)>-1)this.imageEl.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",a.isNothing(this.imageEl.parentNode)||a.DOM.removeChild(this.imageEl,this.imageEl.parentNode)},onImageLoad:function(){this.imageEl.onload=null;this.imageEl.naturalWidth=a.coalesce(this.imageEl.naturalWidth,
this.imageEl.width);this.imageEl.naturalHeight=a.coalesce(this.imageEl.naturalHeight,this.imageEl.height);this.imageEl.isLandscape=this.imageEl.naturalWidth>this.imageEl.naturalHeight;this.imageEl.isLoading=!1;a.Events.fire(this,{type:b.Image.EventTypes.onLoad,target:this})},onImageError:function(){this.imageEl.onload=null;this.imageEl.onerror=null;this.imageEl.onabort=null;this.imageEl.isLoading=!1;this.imageEl.isError=!0;a.Events.fire(this,{type:b.Image.EventTypes.onError,target:this})}})})(window,
window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Cache");e=e.Code.PhotoSwipe;e.Cache.Mode={normal:"normal",aggressive:"aggressive"};e.Cache.Functions={getImageSource:function(a){return a.href},getImageCaption:function(b){if(b.nodeName==="IMG")return a.DOM.getAttribute(b,"alt");var c,g,f;c=0;for(g=b.childNodes.length;c<g;c++)if(f=b.childNodes[c],b.childNodes[c].nodeName==="IMG")return a.DOM.getAttribute(f,"alt")},getImageMetaData:function(){return{}}}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Cache");var b=e.Code.PhotoSwipe;b.Cache.CacheClass=d({images:null,settings:null,dispose:function(){var c,b,f;if(!a.isNothing(this.images)){b=0;for(f=this.images.length;b<f;b++)this.images[b].dispose();this.images.length=0}for(c in this)a.objectHasProperty(this,c)&&(this[c]=null)},initialize:function(a,g){var f,d,e,h,l,k;this.settings=g;this.images=[];f=0;for(d=a.length;f<d;f++)e=a[f],h=this.settings.getImageSource(e),l=this.settings.getImageCaption(e),
k=this.settings.getImageMetaData(e),this.images.push(new b.Image.ImageClass(e,h,l,k))},getImages:function(c){var g,f,d=[],e;g=0;for(f=c.length;g<f;g++){e=this.images[c[g]];if(this.settings.cacheMode===b.Cache.Mode.aggressive)e.cacheDoNotShrink=!0;d.push(e)}if(this.settings.cacheMode===b.Cache.Mode.aggressive){g=0;for(f=this.images.length;g<f;g++)e=this.images[g],a.objectHasProperty(e,"cacheDoNotShrink")?delete e.cacheDoNotShrink:e.shrinkImage()}return d}})})(window,window.klass,window.Code.Util,window.Code.PhotoSwipe.Image);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.DocumentOverlay");e.Code.PhotoSwipe.DocumentOverlay.CssClasses={documentOverlay:"ps-document-overlay"}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.DocumentOverlay");var b=e.Code.PhotoSwipe;b.DocumentOverlay.DocumentOverlayClass=d({el:null,settings:null,initialBodyHeight:null,dispose:function(){var c;a.Animation.stop(this.el);a.DOM.removeChild(this.el,this.el.parentNode);for(c in this)a.objectHasProperty(this,c)&&(this[c]=null)},initialize:function(c){this.settings=c;this.el=a.DOM.createElement("div",{"class":b.DocumentOverlay.CssClasses.documentOverlay},"");a.DOM.setStyle(this.el,{display:"block",
position:"absolute",left:0,top:0,zIndex:this.settings.zIndex});a.DOM.hide(this.el);this.settings.target===e?a.DOM.appendToBody(this.el):a.DOM.appendChild(this.el,this.settings.target);a.Animation.resetTranslate(this.el);this.initialBodyHeight=a.DOM.bodyOuterHeight()},resetPosition:function(){var c,b,f;if(this.settings.target===e){c=a.DOM.windowWidth();b=a.DOM.bodyOuterHeight()*2;f=this.settings.jQueryMobile?a.DOM.windowScrollTop()+"px":"0px";if(b<1)b=this.initialBodyHeight;a.DOM.windowHeight()>b&&
(b=a.DOM.windowHeight())}else c=a.DOM.width(this.settings.target),b=a.DOM.height(this.settings.target),f="0px";a.DOM.setStyle(this.el,{width:c,height:b,top:f})},fadeIn:function(c,b){this.resetPosition();a.DOM.setStyle(this.el,"opacity",0);a.DOM.show(this.el);a.Animation.fadeIn(this.el,c,b)}})})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Carousel");e=e.Code.PhotoSwipe;e.Carousel.EventTypes={onSlideByEnd:"PhotoSwipeCarouselOnSlideByEnd",onSlideshowStart:"PhotoSwipeCarouselOnSlideshowStart",onSlideshowStop:"PhotoSwipeCarouselOnSlideshowStop"};e.Carousel.CssClasses={carousel:"ps-carousel",content:"ps-carousel-content",item:"ps-carousel-item",itemLoading:"ps-carousel-item-loading",itemError:"ps-carousel-item-error"};e.Carousel.SlideByAction={previous:"previous",current:"current",next:"next"}})(window,
window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Carousel");var b=e.Code.PhotoSwipe;b.Carousel.CarouselClass=d({el:null,contentEl:null,settings:null,cache:null,slideByEndHandler:null,currentCacheIndex:null,isSliding:null,isSlideshowActive:null,lastSlideByAction:null,touchStartPoint:null,touchStartPosition:null,imageLoadHandler:null,imageErrorHandler:null,slideshowTimeout:null,dispose:function(){var c,g,f;g=0;for(f=this.cache.images.length;g<f;g++)a.Events.remove(this.cache.images[g],b.Image.EventTypes.onLoad,
this.imageLoadHandler),a.Events.remove(this.cache.images[g],b.Image.EventTypes.onError,this.imageErrorHandler);this.stopSlideshow();a.Animation.stop(this.el);a.DOM.removeChild(this.el,this.el.parentNode);for(c in this)a.objectHasProperty(this,c)&&(this[c]=null)},initialize:function(c,g){var f,d,j;this.cache=c;this.settings=g;this.slideByEndHandler=this.onSlideByEnd.bind(this);this.imageLoadHandler=this.onImageLoad.bind(this);this.imageErrorHandler=this.onImageError.bind(this);this.currentCacheIndex=
0;this.isSlideshowActive=this.isSliding=!1;if(this.cache.images.length<3)this.settings.loop=!1;this.el=a.DOM.createElement("div",{"class":b.Carousel.CssClasses.carousel},"");a.DOM.setStyle(this.el,{display:"block",position:"absolute",left:0,top:0,overflow:"hidden",zIndex:this.settings.zIndex});a.DOM.hide(this.el);this.contentEl=a.DOM.createElement("div",{"class":b.Carousel.CssClasses.content},"");a.DOM.setStyle(this.contentEl,{display:"block",position:"absolute",left:0,top:0});a.DOM.appendChild(this.contentEl,
this.el);d=c.images.length<3?c.images.length:3;for(f=0;f<d;f++)j=a.DOM.createElement("div",{"class":b.Carousel.CssClasses.item+" "+b.Carousel.CssClasses.item+"-"+f},""),a.DOM.setAttribute(j,"style","float: left;"),a.DOM.setStyle(j,{display:"block",position:"relative",left:0,top:0,overflow:"hidden"}),this.settings.margin>0&&a.DOM.setStyle(j,{marginRight:this.settings.margin+"px"}),a.DOM.appendChild(j,this.contentEl);this.settings.target===e?a.DOM.appendToBody(this.el):a.DOM.appendChild(this.el,this.settings.target)},
resetPosition:function(){var c,g,f,d,j,h;this.settings.target===e?(c=a.DOM.windowWidth(),g=a.DOM.windowHeight(),f=a.DOM.windowScrollTop()+"px"):(c=a.DOM.width(this.settings.target),g=a.DOM.height(this.settings.target),f="0px");d=this.settings.margin>0?c+this.settings.margin:c;j=a.DOM.find("."+b.Carousel.CssClasses.item,this.contentEl);d*=j.length;a.DOM.setStyle(this.el,{top:f,width:c,height:g});a.DOM.setStyle(this.contentEl,{width:d,height:g});f=0;for(d=j.length;f<d;f++)h=j[f],a.DOM.setStyle(h,{width:c,
height:g}),h=a.DOM.find("img",h)[0],a.isNothing(h)||this.resetImagePosition(h);this.setContentLeftPosition()},resetImagePosition:function(c){if(!a.isNothing(c)){a.DOM.getAttribute(c,"src");var b,f,d,e=a.DOM.width(this.el),h=a.DOM.height(this.el);this.settings.imageScaleMethod==="fitNoUpscale"?(f=c.naturalWidth,d=c.naturalHeight,f>e&&(b=e/f,f=Math.round(f*b),d=Math.round(d*b)),d>h&&(b=h/d,d=Math.round(d*b),f=Math.round(f*b))):(b=c.isLandscape?e/c.naturalWidth:h/c.naturalHeight,f=Math.round(c.naturalWidth*
b),d=Math.round(c.naturalHeight*b),this.settings.imageScaleMethod==="zoom"?(b=1,d<h?b=h/d:f<e&&(b=e/f),b!==1&&(f=Math.round(f*b),d=Math.round(d*b))):this.settings.imageScaleMethod==="fit"&&(b=1,f>e?b=e/f:d>h&&(b=h/d),b!==1&&(f=Math.round(f*b),d=Math.round(d*b))));a.DOM.setStyle(c,{position:"absolute",width:f,height:d,top:Math.round((h-d)/2)+"px",left:Math.round((e-f)/2)+"px",display:"block"})}},setContentLeftPosition:function(){var c,b,d;c=this.settings.target===e?a.DOM.windowWidth():a.DOM.width(this.settings.target);
b=this.getItemEls();d=0;this.settings.loop?d=(c+this.settings.margin)*-1:this.currentCacheIndex===this.cache.images.length-1?d=(b.length-1)*(c+this.settings.margin)*-1:this.currentCacheIndex>0&&(d=(c+this.settings.margin)*-1);a.DOM.setStyle(this.contentEl,{left:d+"px"})},show:function(c){this.currentCacheIndex=c;this.resetPosition();this.setImages(!1);a.DOM.show(this.el);a.Animation.resetTranslate(this.contentEl);var c=this.getItemEls(),d,f;d=0;for(f=c.length;d<f;d++)a.Animation.resetTranslate(c[d]);
a.Events.fire(this,{type:b.Carousel.EventTypes.onSlideByEnd,target:this,action:b.Carousel.SlideByAction.current,cacheIndex:this.currentCacheIndex})},setImages:function(a){var b,d=this.getItemEls();b=this.currentCacheIndex+1;var e=this.currentCacheIndex-1;this.settings.loop?(b>this.cache.images.length-1&&(b=0),e<0&&(e=this.cache.images.length-1),b=this.cache.getImages([e,this.currentCacheIndex,b]),a||this.addCacheImageToItemEl(b[1],d[1]),this.addCacheImageToItemEl(b[2],d[2]),this.addCacheImageToItemEl(b[0],
d[0])):d.length===1?a||(b=this.cache.getImages([this.currentCacheIndex]),this.addCacheImageToItemEl(b[0],d[0])):d.length===2?this.currentCacheIndex===0?(b=this.cache.getImages([this.currentCacheIndex,this.currentCacheIndex+1]),a||this.addCacheImageToItemEl(b[0],d[0]),this.addCacheImageToItemEl(b[1],d[1])):(b=this.cache.getImages([this.currentCacheIndex-1,this.currentCacheIndex]),a||this.addCacheImageToItemEl(b[1],d[1]),this.addCacheImageToItemEl(b[0],d[0])):this.currentCacheIndex===0?(b=this.cache.getImages([this.currentCacheIndex,
this.currentCacheIndex+1,this.currentCacheIndex+2]),a||this.addCacheImageToItemEl(b[0],d[0]),this.addCacheImageToItemEl(b[1],d[1]),this.addCacheImageToItemEl(b[2],d[2])):(this.currentCacheIndex===this.cache.images.length-1?(b=this.cache.getImages([this.currentCacheIndex-2,this.currentCacheIndex-1,this.currentCacheIndex]),a||this.addCacheImageToItemEl(b[2],d[2]),this.addCacheImageToItemEl(b[1],d[1])):(b=this.cache.getImages([this.currentCacheIndex-1,this.currentCacheIndex,this.currentCacheIndex+1]),
a||this.addCacheImageToItemEl(b[1],d[1]),this.addCacheImageToItemEl(b[2],d[2])),this.addCacheImageToItemEl(b[0],d[0]))},addCacheImageToItemEl:function(c,d){a.DOM.removeClass(d,b.Carousel.CssClasses.itemError);a.DOM.addClass(d,b.Carousel.CssClasses.itemLoading);a.DOM.removeChildren(d);a.DOM.setStyle(c.imageEl,{display:"none"});a.DOM.appendChild(c.imageEl,d);a.Animation.resetTranslate(c.imageEl);a.Events.add(c,b.Image.EventTypes.onLoad,this.imageLoadHandler);a.Events.add(c,b.Image.EventTypes.onError,
this.imageErrorHandler);c.load()},slideCarousel:function(c,d,f){if(!this.isSliding){var i,j;i=this.settings.target===e?a.DOM.windowWidth()+this.settings.margin:a.DOM.width(this.settings.target)+this.settings.margin;f=a.coalesce(f,this.settings.slideSpeed);if(!(e.Math.abs(j)<1)){switch(d){case a.TouchElement.ActionTypes.swipeLeft:c=i*-1;break;case a.TouchElement.ActionTypes.swipeRight:c=i;break;default:j=c.x-this.touchStartPoint.x,c=e.Math.abs(j)>i/2?j>0?i:i*-1:0}this.lastSlideByAction=c<0?b.Carousel.SlideByAction.next:
c>0?b.Carousel.SlideByAction.previous:b.Carousel.SlideByAction.current;if(!this.settings.loop&&(this.lastSlideByAction===b.Carousel.SlideByAction.previous&&this.currentCacheIndex===0||this.lastSlideByAction===b.Carousel.SlideByAction.next&&this.currentCacheIndex===this.cache.images.length-1))c=0,this.lastSlideByAction=b.Carousel.SlideByAction.current;this.isSliding=!0;this.doSlideCarousel(c,f)}}},moveCarousel:function(a){this.isSliding||this.settings.enableDrag&&this.doMoveCarousel(a.x-this.touchStartPoint.x)},
getItemEls:function(){return a.DOM.find("."+b.Carousel.CssClasses.item,this.contentEl)},previous:function(){this.stopSlideshow();this.slideCarousel({x:0,y:0},a.TouchElement.ActionTypes.swipeRight,this.settings.nextPreviousSlideSpeed)},next:function(){this.stopSlideshow();this.slideCarousel({x:0,y:0},a.TouchElement.ActionTypes.swipeLeft,this.settings.nextPreviousSlideSpeed)},slideshowNext:function(){this.slideCarousel({x:0,y:0},a.TouchElement.ActionTypes.swipeLeft)},startSlideshow:function(){this.stopSlideshow();
this.isSlideshowActive=!0;this.slideshowTimeout=e.setTimeout(this.slideshowNext.bind(this),this.settings.slideshowDelay);a.Events.fire(this,{type:b.Carousel.EventTypes.onSlideshowStart,target:this})},stopSlideshow:function(){if(!a.isNothing(this.slideshowTimeout))e.clearTimeout(this.slideshowTimeout),this.slideshowTimeout=null,this.isSlideshowActive=!1,a.Events.fire(this,{type:b.Carousel.EventTypes.onSlideshowStop,target:this})},onSlideByEnd:function(){if(!a.isNothing(this.isSliding)){var c=this.getItemEls();
this.isSliding=!1;this.lastSlideByAction===b.Carousel.SlideByAction.next?this.currentCacheIndex+=1:this.lastSlideByAction===b.Carousel.SlideByAction.previous&&(this.currentCacheIndex-=1);if(this.settings.loop)if(this.lastSlideByAction===b.Carousel.SlideByAction.next?a.DOM.appendChild(c[0],this.contentEl):this.lastSlideByAction===b.Carousel.SlideByAction.previous&&a.DOM.insertBefore(c[c.length-1],c[0],this.contentEl),this.currentCacheIndex<0)this.currentCacheIndex=this.cache.images.length-1;else{if(this.currentCacheIndex===
this.cache.images.length)this.currentCacheIndex=0}else this.cache.images.length>3&&(this.currentCacheIndex>1&&this.currentCacheIndex<this.cache.images.length-2?this.lastSlideByAction===b.Carousel.SlideByAction.next?a.DOM.appendChild(c[0],this.contentEl):this.lastSlideByAction===b.Carousel.SlideByAction.previous&&a.DOM.insertBefore(c[c.length-1],c[0],this.contentEl):this.currentCacheIndex===1?this.lastSlideByAction===b.Carousel.SlideByAction.previous&&a.DOM.insertBefore(c[c.length-1],c[0],this.contentEl):
this.currentCacheIndex===this.cache.images.length-2&&this.lastSlideByAction===b.Carousel.SlideByAction.next&&a.DOM.appendChild(c[0],this.contentEl));this.lastSlideByAction!==b.Carousel.SlideByAction.current&&(this.setContentLeftPosition(),this.setImages(!0));a.Events.fire(this,{type:b.Carousel.EventTypes.onSlideByEnd,target:this,action:this.lastSlideByAction,cacheIndex:this.currentCacheIndex});this.isSlideshowActive&&(this.lastSlideByAction!==b.Carousel.SlideByAction.current?this.startSlideshow():
this.stopSlideshow())}},onTouch:function(b,d){this.stopSlideshow();switch(b){case a.TouchElement.ActionTypes.touchStart:this.touchStartPoint=d;this.touchStartPosition={x:e.parseInt(a.DOM.getStyle(this.contentEl,"left"),0),y:e.parseInt(a.DOM.getStyle(this.contentEl,"top"),0)};break;case a.TouchElement.ActionTypes.touchMove:this.moveCarousel(d);break;case a.TouchElement.ActionTypes.touchMoveEnd:case a.TouchElement.ActionTypes.swipeLeft:case a.TouchElement.ActionTypes.swipeRight:this.slideCarousel(d,
b)}},onImageLoad:function(c){c=c.target;a.isNothing(c.imageEl.parentNode)||(a.DOM.removeClass(c.imageEl.parentNode,b.Carousel.CssClasses.itemLoading),this.resetImagePosition(c.imageEl));a.Events.remove(c,b.Image.EventTypes.onLoad,this.imageLoadHandler);a.Events.remove(c,b.Image.EventTypes.onError,this.imageErrorHandler)},onImageError:function(c){c=c.target;a.isNothing(c.imageEl.parentNode)||(a.DOM.removeClass(c.imageEl.parentNode,b.Carousel.CssClasses.itemLoading),a.DOM.addClass(c.imageEl.parentNode,
b.Carousel.CssClasses.itemError));a.Events.remove(c,b.Image.EventTypes.onLoad,this.imageLoadHandler);a.Events.remove(c,b.Image.EventTypes.onError,this.imageErrorHandler)}})})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Carousel");d=e.Code.PhotoSwipe;d.Carousel.CarouselClass=d.Carousel.CarouselClass.extend({getStartingPos:function(){var b=this.touchStartPosition;a.isNothing(b)&&(b={x:e.parseInt(a.DOM.getStyle(this.contentEl,"left"),0),y:e.parseInt(a.DOM.getStyle(this.contentEl,"top"),0)});return b},doMoveCarousel:function(b){var c;a.Browser.isCSSTransformSupported?(c={},c[a.Animation._transitionPrefix+"Property"]="all",c[a.Animation._transitionPrefix+"Duration"]=
"",c[a.Animation._transitionPrefix+"TimingFunction"]="",c[a.Animation._transitionPrefix+"Delay"]="0",c[a.Animation._transformLabel]=a.Browser.is3dSupported?"translate3d("+b+"px, 0px, 0px)":"translate("+b+"px, 0px)",a.DOM.setStyle(this.contentEl,c)):a.isNothing(e.jQuery)||e.jQuery(this.contentEl).stop().css("left",this.getStartingPos().x+b+"px")},doSlideCarousel:function(b,c){var d;if(c<=0)this.slideByEndHandler();else if(a.Browser.isCSSTransformSupported)d=a.coalesce(this.contentEl.style.webkitTransform,
this.contentEl.style.MozTransform,this.contentEl.style.transform,""),d.indexOf("translate3d("+b)===0?this.slideByEndHandler():d.indexOf("translate("+b)===0?this.slideByEndHandler():a.Animation.slideBy(this.contentEl,b,0,c,this.slideByEndHandler,this.settings.slideTimingFunction);else if(!a.isNothing(e.jQuery)){d={left:this.getStartingPos().x+b+"px"};if(this.settings.animationTimingFunction==="ease-out")this.settings.animationTimingFunction="easeOutQuad";if(a.isNothing(e.jQuery.easing[this.settings.animationTimingFunction]))this.settings.animationTimingFunction=
"linear";e.jQuery(this.contentEl).animate(d,this.settings.slideSpeed,this.settings.animationTimingFunction,this.slideByEndHandler)}}})})(window,window.klass,window.Code.Util,window.Code.PhotoSwipe.TouchElement);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Toolbar");var b=e.Code.PhotoSwipe;b.Toolbar.CssClasses={toolbar:"ps-toolbar",toolbarContent:"ps-toolbar-content",toolbarTop:"ps-toolbar-top",caption:"ps-caption",captionBottom:"ps-caption-bottom",captionContent:"ps-caption-content",close:"ps-toolbar-close",play:"ps-toolbar-play",previous:"ps-toolbar-previous",previousDisabled:"ps-toolbar-previous-disabled",next:"ps-toolbar-next",nextDisabled:"ps-toolbar-next-disabled"};b.Toolbar.ToolbarAction=
{close:"close",play:"play",next:"next",previous:"previous",none:"none"};b.Toolbar.EventTypes={onTap:"PhotoSwipeToolbarOnClick",onBeforeShow:"PhotoSwipeToolbarOnBeforeShow",onShow:"PhotoSwipeToolbarOnShow",onBeforeHide:"PhotoSwipeToolbarOnBeforeHide",onHide:"PhotoSwipeToolbarOnHide"};b.Toolbar.getToolbar=function(){return'<div class="'+b.Toolbar.CssClasses.close+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div><div class="'+b.Toolbar.CssClasses.play+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+
'"></div></div><div class="'+b.Toolbar.CssClasses.previous+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div><div class="'+b.Toolbar.CssClasses.next+'"><div class="'+b.Toolbar.CssClasses.toolbarContent+'"></div></div>'}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.Toolbar");var b=e.Code.PhotoSwipe;b.Toolbar.ToolbarClass=d({toolbarEl:null,closeEl:null,playEl:null,previousEl:null,nextEl:null,captionEl:null,captionContentEl:null,currentCaption:null,settings:null,cache:null,timeout:null,isVisible:null,fadeOutHandler:null,touchStartHandler:null,touchMoveHandler:null,clickHandler:null,dispose:function(){var b;this.clearTimeout();this.removeEventHandlers();a.Animation.stop(this.toolbarEl);a.Animation.stop(this.captionEl);
a.DOM.removeChild(this.toolbarEl,this.toolbarEl.parentNode);a.DOM.removeChild(this.captionEl,this.captionEl.parentNode);for(b in this)a.objectHasProperty(this,b)&&(this[b]=null)},initialize:function(c,d){var f;this.settings=d;this.cache=c;this.isVisible=!1;this.fadeOutHandler=this.onFadeOut.bind(this);this.touchStartHandler=this.onTouchStart.bind(this);this.touchMoveHandler=this.onTouchMove.bind(this);this.clickHandler=this.onClick.bind(this);f=b.Toolbar.CssClasses.toolbar;this.settings.captionAndToolbarFlipPosition&&
(f=f+" "+b.Toolbar.CssClasses.toolbarTop);this.toolbarEl=a.DOM.createElement("div",{"class":f},this.settings.getToolbar());a.DOM.setStyle(this.toolbarEl,{left:0,position:"absolute",overflow:"hidden",zIndex:this.settings.zIndex});this.settings.target===e?a.DOM.appendToBody(this.toolbarEl):a.DOM.appendChild(this.toolbarEl,this.settings.target);a.DOM.hide(this.toolbarEl);this.closeEl=a.DOM.find("."+b.Toolbar.CssClasses.close,this.toolbarEl)[0];this.settings.preventHide&&!a.isNothing(this.closeEl)&&a.DOM.hide(this.closeEl);
this.playEl=a.DOM.find("."+b.Toolbar.CssClasses.play,this.toolbarEl)[0];this.settings.preventSlideshow&&!a.isNothing(this.playEl)&&a.DOM.hide(this.playEl);this.nextEl=a.DOM.find("."+b.Toolbar.CssClasses.next,this.toolbarEl)[0];this.previousEl=a.DOM.find("."+b.Toolbar.CssClasses.previous,this.toolbarEl)[0];f=b.Toolbar.CssClasses.caption;this.settings.captionAndToolbarFlipPosition&&(f=f+" "+b.Toolbar.CssClasses.captionBottom);this.captionEl=a.DOM.createElement("div",{"class":f},"");a.DOM.setStyle(this.captionEl,
{left:0,position:"absolute",overflow:"hidden",zIndex:this.settings.zIndex});this.settings.target===e?a.DOM.appendToBody(this.captionEl):a.DOM.appendChild(this.captionEl,this.settings.target);a.DOM.hide(this.captionEl);this.captionContentEl=a.DOM.createElement("div",{"class":b.Toolbar.CssClasses.captionContent},"");a.DOM.appendChild(this.captionContentEl,this.captionEl);this.addEventHandlers()},resetPosition:function(){var b,d,f;this.settings.target===e?(this.settings.captionAndToolbarFlipPosition?
(d=a.DOM.windowScrollTop(),f=a.DOM.windowScrollTop()+a.DOM.windowHeight()-a.DOM.height(this.captionEl)):(d=a.DOM.windowScrollTop()+a.DOM.windowHeight()-a.DOM.height(this.toolbarEl),f=a.DOM.windowScrollTop()),b=a.DOM.windowWidth()):(this.settings.captionAndToolbarFlipPosition?(d="0",f=a.DOM.height(this.settings.target)-a.DOM.height(this.captionEl)):(d=a.DOM.height(this.settings.target)-a.DOM.height(this.toolbarEl),f=0),b=a.DOM.width(this.settings.target));a.DOM.setStyle(this.toolbarEl,{top:d+"px",
width:b});a.DOM.setStyle(this.captionEl,{top:f+"px",width:b})},toggleVisibility:function(a){this.isVisible?this.fadeOut():this.show(a)},show:function(c){a.Animation.stop(this.toolbarEl);a.Animation.stop(this.captionEl);this.resetPosition();this.setToolbarStatus(c);a.Events.fire(this,{type:b.Toolbar.EventTypes.onBeforeShow,target:this});this.showToolbar();this.setCaption(c);this.showCaption();this.isVisible=!0;this.setTimeout();a.Events.fire(this,{type:b.Toolbar.EventTypes.onShow,target:this})},setTimeout:function(){if(this.settings.captionAndToolbarAutoHideDelay>
0)this.clearTimeout(),this.timeout=e.setTimeout(this.fadeOut.bind(this),this.settings.captionAndToolbarAutoHideDelay)},clearTimeout:function(){if(!a.isNothing(this.timeout))e.clearTimeout(this.timeout),this.timeout=null},fadeOut:function(){this.clearTimeout();a.Events.fire(this,{type:b.Toolbar.EventTypes.onBeforeHide,target:this});a.Animation.fadeOut(this.toolbarEl,this.settings.fadeOutSpeed);a.Animation.fadeOut(this.captionEl,this.settings.fadeOutSpeed,this.fadeOutHandler);this.isVisible=!1},addEventHandlers:function(){a.Browser.isTouchSupported&&
(a.Browser.blackberry||a.Events.add(this.toolbarEl,"touchstart",this.touchStartHandler),a.Events.add(this.toolbarEl,"touchmove",this.touchMoveHandler),a.Events.add(this.captionEl,"touchmove",this.touchMoveHandler));a.Events.add(this.toolbarEl,"click",this.clickHandler)},removeEventHandlers:function(){a.Browser.isTouchSupported&&(a.Browser.blackberry||a.Events.remove(this.toolbarEl,"touchstart",this.touchStartHandler),a.Events.remove(this.toolbarEl,"touchmove",this.touchMoveHandler),a.Events.remove(this.captionEl,
"touchmove",this.touchMoveHandler));a.Events.remove(this.toolbarEl,"click",this.clickHandler)},handleTap:function(c){this.clearTimeout();var d;if(c.target===this.nextEl||a.DOM.isChildOf(c.target,this.nextEl))d=b.Toolbar.ToolbarAction.next;else if(c.target===this.previousEl||a.DOM.isChildOf(c.target,this.previousEl))d=b.Toolbar.ToolbarAction.previous;else if(c.target===this.closeEl||a.DOM.isChildOf(c.target,this.closeEl))d=b.Toolbar.ToolbarAction.close;else if(c.target===this.playEl||a.DOM.isChildOf(c.target,
this.playEl))d=b.Toolbar.ToolbarAction.play;this.setTimeout();if(a.isNothing(d))d=b.Toolbar.ToolbarAction.none;a.Events.fire(this,{type:b.Toolbar.EventTypes.onTap,target:this,action:d,tapTarget:c.target})},setCaption:function(b){a.DOM.removeChildren(this.captionContentEl);this.currentCaption=a.coalesce(this.cache.images[b].caption,"\u00a0");if(a.isObject(this.currentCaption))a.DOM.appendChild(this.currentCaption,this.captionContentEl);else{if(this.currentCaption==="")this.currentCaption="\u00a0";
a.DOM.appendText(this.currentCaption,this.captionContentEl)}this.currentCaption=this.currentCaption==="\u00a0"?"":this.currentCaption;this.resetPosition()},showToolbar:function(){a.DOM.setStyle(this.toolbarEl,{opacity:this.settings.captionAndToolbarOpacity});a.DOM.show(this.toolbarEl)},showCaption:function(){(this.currentCaption===""||this.captionContentEl.childNodes.length<1)&&!this.settings.captionAndToolbarShowEmptyCaptions?a.DOM.hide(this.captionEl):(a.DOM.setStyle(this.captionEl,{opacity:this.settings.captionAndToolbarOpacity}),
a.DOM.show(this.captionEl))},setToolbarStatus:function(c){this.settings.loop||(a.DOM.removeClass(this.previousEl,b.Toolbar.CssClasses.previousDisabled),a.DOM.removeClass(this.nextEl,b.Toolbar.CssClasses.nextDisabled),c>0&&c<this.cache.images.length-1||(c===0&&(a.isNothing(this.previousEl)||a.DOM.addClass(this.previousEl,b.Toolbar.CssClasses.previousDisabled)),c===this.cache.images.length-1&&(a.isNothing(this.nextEl)||a.DOM.addClass(this.nextEl,b.Toolbar.CssClasses.nextDisabled))))},onFadeOut:function(){a.DOM.hide(this.toolbarEl);
a.DOM.hide(this.captionEl);a.Events.fire(this,{type:b.Toolbar.EventTypes.onHide,target:this})},onTouchStart:function(b){b.preventDefault();a.Events.remove(this.toolbarEl,"click",this.clickHandler);this.handleTap(b)},onTouchMove:function(a){a.preventDefault()},onClick:function(a){a.preventDefault();this.handleTap(a)}})})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.UILayer");e.Code.PhotoSwipe.UILayer.CssClasses={uiLayer:"ps-uilayer"}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.UILayer");var b=e.Code.PhotoSwipe;b.UILayer.UILayerClass=a.TouchElement.TouchElementClass.extend({el:null,settings:null,dispose:function(){var b;this.removeEventHandlers();a.DOM.removeChild(this.el,this.el.parentNode);for(b in this)a.objectHasProperty(this,b)&&(this[b]=null)},initialize:function(c){this.settings=c;this.el=a.DOM.createElement("div",{"class":b.UILayer.CssClasses.uiLayer},"");a.DOM.setStyle(this.el,{display:"block",position:"absolute",
left:0,top:0,overflow:"hidden",zIndex:this.settings.zIndex,opacity:0});a.DOM.hide(this.el);this.settings.target===e?a.DOM.appendToBody(this.el):a.DOM.appendChild(this.el,this.settings.target);this.supr(this.el,{swipe:!0,move:!0,gesture:a.Browser.iOS,doubleTap:!0,preventDefaultTouchEvents:this.settings.preventDefaultTouchEvents})},resetPosition:function(){this.settings.target===e?a.DOM.setStyle(this.el,{top:a.DOM.windowScrollTop()+"px",width:a.DOM.windowWidth(),height:a.DOM.windowHeight()}):a.DOM.setStyle(this.el,
{top:"0px",width:a.DOM.width(this.settings.target),height:a.DOM.height(this.settings.target)})},show:function(){this.resetPosition();a.DOM.show(this.el);this.addEventHandlers()},addEventHandlers:function(){this.supr()},removeEventHandlers:function(){this.supr()}})})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.ZoomPanRotate");e=e.Code.PhotoSwipe;e.ZoomPanRotate.CssClasses={zoomPanRotate:"ps-zoom-pan-rotate"};e.ZoomPanRotate.EventTypes={onTransform:"PhotoSwipeZoomPanRotateOnTransform"}})(window,window.klass,window.Code.Util);
(function(e,d,a){a.registerNamespace("Code.PhotoSwipe.ZoomPanRotate");var b=e.Code.PhotoSwipe;b.ZoomPanRotate.ZoomPanRotateClass=d({el:null,settings:null,containerEl:null,imageEl:null,transformSettings:null,panStartingPoint:null,transformEl:null,dispose:function(){var b;a.DOM.removeChild(this.el,this.el.parentNode);for(b in this)a.objectHasProperty(this,b)&&(this[b]=null)},initialize:function(c,d,f){var i,j,h;this.settings=c;this.settings.target===e?(c=document.body,i=a.DOM.windowWidth(),j=a.DOM.windowHeight(),
h=a.DOM.windowScrollTop()+"px"):(c=this.settings.target,i=a.DOM.width(c),j=a.DOM.height(c),h="0px");this.imageEl=d.imageEl.cloneNode(!1);a.DOM.setStyle(this.imageEl,{zIndex:1});this.transformSettings={startingScale:1,scale:1,startingRotation:0,rotation:0,startingTranslateX:0,startingTranslateY:0,translateX:0,translateY:0};this.el=a.DOM.createElement("div",{"class":b.ZoomPanRotate.CssClasses.zoomPanRotate},"");a.DOM.setStyle(this.el,{left:0,top:h,position:"absolute",width:i,height:j,zIndex:this.settings.zIndex,
display:"block"});a.DOM.insertBefore(this.el,f.el,c);a.Browser.iOS?(this.containerEl=a.DOM.createElement("div","",""),a.DOM.setStyle(this.containerEl,{left:0,top:0,width:i,height:j,position:"absolute",zIndex:1}),a.DOM.appendChild(this.imageEl,this.containerEl),a.DOM.appendChild(this.containerEl,this.el),a.Animation.resetTranslate(this.containerEl),a.Animation.resetTranslate(this.imageEl),this.transformEl=this.containerEl):(a.DOM.appendChild(this.imageEl,this.el),this.transformEl=this.imageEl)},setStartingTranslateFromCurrentTransform:function(){var b=
a.coalesce(this.transformEl.style.webkitTransform,this.transformEl.style.MozTransform,this.transformEl.style.transform);if(!a.isNothing(b)&&(b=b.match(/translate\((.*?)\)/),!a.isNothing(b)))b=b[1].split(", "),this.transformSettings.startingTranslateX=e.parseInt(b[0],10),this.transformSettings.startingTranslateY=e.parseInt(b[1],10)},getScale:function(a){a*=this.transformSettings.startingScale;if(this.settings.minUserZoom!==0&&a<this.settings.minUserZoom)a=this.settings.minUserZoom;else if(this.settings.maxUserZoom!==
0&&a>this.settings.maxUserZoom)a=this.settings.maxUserZoom;return a},setStartingScaleAndRotation:function(a,b){this.transformSettings.startingScale=this.getScale(a);this.transformSettings.startingRotation=(this.transformSettings.startingRotation+b)%360},zoomRotate:function(a,b){this.transformSettings.scale=this.getScale(a);this.transformSettings.rotation=this.transformSettings.startingRotation+b;this.applyTransform()},panStart:function(a){this.setStartingTranslateFromCurrentTransform();this.panStartingPoint=
{x:a.x,y:a.y}},pan:function(a){var b=(a.y-this.panStartingPoint.y)/this.transformSettings.scale;this.transformSettings.translateX=this.transformSettings.startingTranslateX+(a.x-this.panStartingPoint.x)/this.transformSettings.scale;this.transformSettings.translateY=this.transformSettings.startingTranslateY+b;this.applyTransform()},zoomAndPanToPoint:function(b,d){if(this.settings.target===e){this.panStart({x:a.DOM.windowWidth()/2,y:a.DOM.windowHeight()/2});var f=(d.y-this.panStartingPoint.y)/this.transformSettings.scale;
this.transformSettings.translateX=(this.transformSettings.startingTranslateX+(d.x-this.panStartingPoint.x)/this.transformSettings.scale)*-1;this.transformSettings.translateY=(this.transformSettings.startingTranslateY+f)*-1}this.setStartingScaleAndRotation(b,0);this.transformSettings.scale=this.transformSettings.startingScale;this.transformSettings.rotation=0;this.applyTransform()},applyTransform:function(){var c=this.transformSettings.rotation%360,d=e.parseInt(this.transformSettings.translateX,10),
f=e.parseInt(this.transformSettings.translateY,10),i="scale("+this.transformSettings.scale+") rotate("+c+"deg) translate("+d+"px, "+f+"px)";a.DOM.setStyle(this.transformEl,{webkitTransform:i,MozTransform:i,msTransform:i,transform:i});a.Events.fire(this,{target:this,type:b.ZoomPanRotate.EventTypes.onTransform,scale:this.transformSettings.scale,rotation:this.transformSettings.rotation,rotationDegs:c,translateX:d,translateY:f})}})})(window,window.klass,window.Code.Util);
(function(e,d){d.registerNamespace("Code.PhotoSwipe");var a=e.Code.PhotoSwipe;a.CssClasses={buildingBody:"ps-building",activeBody:"ps-active"};a.EventTypes={onBeforeShow:"PhotoSwipeOnBeforeShow",onShow:"PhotoSwipeOnShow",onBeforeHide:"PhotoSwipeOnBeforeHide",onHide:"PhotoSwipeOnHide",onDisplayImage:"PhotoSwipeOnDisplayImage",onResetPosition:"PhotoSwipeOnResetPosition",onSlideshowStart:"PhotoSwipeOnSlideshowStart",onSlideshowStop:"PhotoSwipeOnSlideshowStop",onTouch:"PhotoSwipeOnTouch",onBeforeCaptionAndToolbarShow:"PhotoSwipeOnBeforeCaptionAndToolbarShow",
onCaptionAndToolbarShow:"PhotoSwipeOnCaptionAndToolbarShow",onBeforeCaptionAndToolbarHide:"PhotoSwipeOnBeforeCaptionAndToolbarHide",onCaptionAndToolbarHide:"PhotoSwipeOnCaptionAndToolbarHide",onToolbarTap:"PhotoSwipeOnToolbarTap",onBeforeZoomPanRotateShow:"PhotoSwipeOnBeforeZoomPanRotateShow",onZoomPanRotateShow:"PhotoSwipeOnZoomPanRotateShow",onBeforeZoomPanRotateHide:"PhotoSwipeOnBeforeZoomPanRotateHide",onZoomPanRotateHide:"PhotoSwipeOnZoomPanRotateHide",onZoomPanRotateTransform:"PhotoSwipeOnZoomPanRotateTransform"};
a.instances=[];a.activeInstances=[];a.setActivateInstance=function(b){if(d.arrayIndexOf(b.settings.target,a.activeInstances,"target")>-1)throw"Code.PhotoSwipe.activateInstance: Unable to active instance as another instance is already active for this target";a.activeInstances.push({target:b.settings.target,instance:b})};a.unsetActivateInstance=function(b){b=d.arrayIndexOf(b,a.activeInstances,"instance");a.activeInstances.splice(b,1)};a.attach=function(b,c,e){var f,i;f=a.createInstance(b,c,e);c=0;for(e=
b.length;c<e;c++)if(i=b[c],!d.isNothing(i.nodeType)&&i.nodeType===1)i.__photoSwipeClickHandler=a.onTriggerElementClick.bind(f),d.Events.remove(i,"click",i.__photoSwipeClickHandler),d.Events.add(i,"click",i.__photoSwipeClickHandler);return f};if(e.jQuery)e.jQuery.fn.photoSwipe=function(b,c){return a.attach(this,b,c)};a.detatch=function(b){var c,e,f;c=0;for(e=b.originalImages.length;c<e;c++)f=b.originalImages[c],!d.isNothing(f.nodeType)&&f.nodeType===1&&(d.Events.remove(f,"click",f.__photoSwipeClickHandler),
delete f.__photoSwipeClickHandler);a.disposeInstance(b)};a.createInstance=function(b,c,e){var f;if(d.isNothing(b))throw"Code.PhotoSwipe.attach: No images passed.";if(!d.isLikeArray(b))throw"Code.PhotoSwipe.createInstance: Images must be an array of elements or image urls.";if(b.length<1)throw"Code.PhotoSwipe.createInstance: No images to passed.";c=d.coalesce(c,{});f=a.getInstance(e);if(d.isNothing(f))f=new a.PhotoSwipeClass(b,c,e),a.instances.push(f);else throw'Code.PhotoSwipe.createInstance: Instance with id "'+
e+' already exists."';return f};a.disposeInstance=function(b){var c=a.getInstanceIndex(b);if(c<0)throw"Code.PhotoSwipe.disposeInstance: Unable to find instance to dispose.";b.dispose();a.instances.splice(c,1)};a.onTriggerElementClick=function(a){a.preventDefault();this.show(a.currentTarget)};a.getInstance=function(b){var c,d,e;c=0;for(d=a.instances.length;c<d;c++)if(e=a.instances[c],e.id===b)return e;return null};a.getInstanceIndex=function(b){var c,d,e=-1;c=0;for(d=a.instances.length;c<d;c++)if(a.instances[c]===
b){e=c;break}return e}})(window,window.Code.Util);
(function(e,d,a,b,c,g,f,i,j){a.registerNamespace("Code.PhotoSwipe");var h=e.Code.PhotoSwipe;h.PhotoSwipeClass=d({id:null,settings:null,isBackEventSupported:null,backButtonClicked:null,currentIndex:null,originalImages:null,mouseWheelStartTime:null,windowDimensions:null,cache:null,documentOverlay:null,carousel:null,uiLayer:null,toolbar:null,zoomPanRotate:null,windowOrientationChangeHandler:null,windowScrollHandler:null,windowHashChangeHandler:null,keyDownHandler:null,windowOrientationEventName:null,
uiLayerTouchHandler:null,carouselSlideByEndHandler:null,carouselSlideshowStartHandler:null,carouselSlideshowStopHandler:null,toolbarTapHandler:null,toolbarBeforeShowHandler:null,toolbarShowHandler:null,toolbarBeforeHideHandler:null,toolbarHideHandler:null,mouseWheelHandler:null,zoomPanRotateTransformHandler:null,_isResettingPosition:null,_uiWebViewResetPositionTimeout:null,dispose:function(){var b;a.Events.remove(this,h.EventTypes.onBeforeShow);a.Events.remove(this,h.EventTypes.onShow);a.Events.remove(this,
h.EventTypes.onBeforeHide);a.Events.remove(this,h.EventTypes.onHide);a.Events.remove(this,h.EventTypes.onDisplayImage);a.Events.remove(this,h.EventTypes.onResetPosition);a.Events.remove(this,h.EventTypes.onSlideshowStart);a.Events.remove(this,h.EventTypes.onSlideshowStop);a.Events.remove(this,h.EventTypes.onTouch);a.Events.remove(this,h.EventTypes.onBeforeCaptionAndToolbarShow);a.Events.remove(this,h.EventTypes.onCaptionAndToolbarShow);a.Events.remove(this,h.EventTypes.onBeforeCaptionAndToolbarHide);
a.Events.remove(this,h.EventTypes.onCaptionAndToolbarHide);a.Events.remove(this,h.EventTypes.onZoomPanRotateTransform);this.removeEventHandlers();a.isNothing(this.documentOverlay)||this.documentOverlay.dispose();a.isNothing(this.carousel)||this.carousel.dispose();a.isNothing(this.uiLayer)||this.uiLayer.dispose();a.isNothing(this.toolbar)||this.toolbar.dispose();this.destroyZoomPanRotate();a.isNothing(this.cache)||this.cache.dispose();for(b in this)a.objectHasProperty(this,b)&&(this[b]=null)},initialize:function(c,
d,f){this.id=a.isNothing(f)?"PhotoSwipe"+(new Date).getTime().toString():f;this.originalImages=c;if(a.Browser.android&&!a.Browser.firefox&&e.navigator.userAgent.match(/Android (\d+.\d+)/).toString().replace(/^.*\,/,"")>=2.1)this.isBackEventSupported=!0;if(!this.isBackEventSupported)this.isBackEventSupported=a.objectHasProperty(e,"onhashchange");this.settings={fadeInSpeed:250,fadeOutSpeed:250,preventHide:!1,preventSlideshow:!1,zIndex:1E3,backButtonHideEnabled:!0,enableKeyboard:!0,enableMouseWheel:!0,
mouseWheelSpeed:350,autoStartSlideshow:!1,jQueryMobile:!a.isNothing(e.jQuery)&&!a.isNothing(e.jQuery.mobile),jQueryMobileDialogHash:"&ui-state=dialog",enableUIWebViewRepositionTimeout:!1,uiWebViewResetPositionDelay:500,target:e,preventDefaultTouchEvents:!0,loop:!0,slideSpeed:250,nextPreviousSlideSpeed:0,enableDrag:!0,swipeThreshold:50,swipeTimeThreshold:250,slideTimingFunction:"ease-out",slideshowDelay:3E3,doubleTapSpeed:250,margin:20,imageScaleMethod:"fit",captionAndToolbarHide:!1,captionAndToolbarFlipPosition:!1,
captionAndToolbarAutoHideDelay:5E3,captionAndToolbarOpacity:0.8,captionAndToolbarShowEmptyCaptions:!0,getToolbar:h.Toolbar.getToolbar,allowUserZoom:!0,allowRotationOnUserZoom:!1,maxUserZoom:5,minUserZoom:0.5,doubleTapZoomLevel:2.5,getImageSource:h.Cache.Functions.getImageSource,getImageCaption:h.Cache.Functions.getImageCaption,getImageMetaData:h.Cache.Functions.getImageMetaData,cacheMode:h.Cache.Mode.normal};a.extend(this.settings,d);this.settings.target!==e&&(d=a.DOM.getStyle(this.settings.target,
"position"),(d!=="relative"||d!=="absolute")&&a.DOM.setStyle(this.settings.target,"position","relative"));if(this.settings.target!==e)this.isBackEventSupported=!1,this.settings.backButtonHideEnabled=!1;else if(this.settings.preventHide)this.settings.backButtonHideEnabled=!1;this.cache=new b.CacheClass(c,this.settings)},show:function(b){var c,d;this.backButtonClicked=this._isResettingPosition=!1;if(a.isNumber(b))this.currentIndex=b;else{this.currentIndex=-1;c=0;for(d=this.originalImages.length;c<d;c++)if(this.originalImages[c]===
b){this.currentIndex=c;break}}if(this.currentIndex<0||this.currentIndex>this.originalImages.length-1)throw"Code.PhotoSwipe.PhotoSwipeClass.show: Starting index out of range";this.isAlreadyGettingPage=this.getWindowDimensions();h.setActivateInstance(this);this.windowDimensions=this.getWindowDimensions();this.settings.target===e?a.DOM.addClass(e.document.body,h.CssClasses.buildingBody):a.DOM.addClass(this.settings.target,h.CssClasses.buildingBody);this.createComponents();a.Events.fire(this,{type:h.EventTypes.onBeforeShow,
target:this});this.documentOverlay.fadeIn(this.settings.fadeInSpeed,this.onDocumentOverlayFadeIn.bind(this))},getWindowDimensions:function(){return{width:a.DOM.windowWidth(),height:a.DOM.windowHeight()}},createComponents:function(){this.documentOverlay=new c.DocumentOverlayClass(this.settings);this.carousel=new g.CarouselClass(this.cache,this.settings);this.uiLayer=new i.UILayerClass(this.settings);if(!this.settings.captionAndToolbarHide)this.toolbar=new f.ToolbarClass(this.cache,this.settings)},
resetPosition:function(){if(!this._isResettingPosition){var b=this.getWindowDimensions();if(a.isNothing(this.windowDimensions)||!(b.width===this.windowDimensions.width&&b.height===this.windowDimensions.height))this._isResettingPosition=!0,this.windowDimensions=b,this.destroyZoomPanRotate(),this.documentOverlay.resetPosition(),this.carousel.resetPosition(),a.isNothing(this.toolbar)||this.toolbar.resetPosition(),this.uiLayer.resetPosition(),this._isResettingPosition=!1,a.Events.fire(this,{type:h.EventTypes.onResetPosition,
target:this})}},addEventHandler:function(b,c){a.Events.add(this,b,c)},addEventHandlers:function(){if(a.isNothing(this.windowOrientationChangeHandler))this.windowOrientationChangeHandler=this.onWindowOrientationChange.bind(this),this.windowScrollHandler=this.onWindowScroll.bind(this),this.keyDownHandler=this.onKeyDown.bind(this),this.windowHashChangeHandler=this.onWindowHashChange.bind(this),this.uiLayerTouchHandler=this.onUILayerTouch.bind(this),this.carouselSlideByEndHandler=this.onCarouselSlideByEnd.bind(this),
this.carouselSlideshowStartHandler=this.onCarouselSlideshowStart.bind(this),this.carouselSlideshowStopHandler=this.onCarouselSlideshowStop.bind(this),this.toolbarTapHandler=this.onToolbarTap.bind(this),this.toolbarBeforeShowHandler=this.onToolbarBeforeShow.bind(this),this.toolbarShowHandler=this.onToolbarShow.bind(this),this.toolbarBeforeHideHandler=this.onToolbarBeforeHide.bind(this),this.toolbarHideHandler=this.onToolbarHide.bind(this),this.mouseWheelHandler=this.onMouseWheel.bind(this),this.zoomPanRotateTransformHandler=
this.onZoomPanRotateTransform.bind(this);a.Browser.android?this.orientationEventName="resize":a.Browser.iOS&&!a.Browser.safari?a.Events.add(e.document.body,"orientationchange",this.windowOrientationChangeHandler):this.orientationEventName=!a.isNothing(e.onorientationchange)?"orientationchange":"resize";a.isNothing(this.orientationEventName)||a.Events.add(e,this.orientationEventName,this.windowOrientationChangeHandler);this.settings.target===e&&a.Events.add(e,"scroll",this.windowScrollHandler);this.settings.enableKeyboard&&
a.Events.add(e.document,"keydown",this.keyDownHandler);if(this.isBackEventSupported&&this.settings.backButtonHideEnabled)this.windowHashChangeHandler=this.onWindowHashChange.bind(this),this.settings.jQueryMobile?e.location.hash=this.settings.jQueryMobileDialogHash:(this.currentHistoryHashValue="PhotoSwipe"+(new Date).getTime().toString(),e.location.hash=this.currentHistoryHashValue),a.Events.add(e,"hashchange",this.windowHashChangeHandler);this.settings.enableMouseWheel&&a.Events.add(e,"mousewheel",
this.mouseWheelHandler);a.Events.add(this.uiLayer,a.TouchElement.EventTypes.onTouch,this.uiLayerTouchHandler);a.Events.add(this.carousel,g.EventTypes.onSlideByEnd,this.carouselSlideByEndHandler);a.Events.add(this.carousel,g.EventTypes.onSlideshowStart,this.carouselSlideshowStartHandler);a.Events.add(this.carousel,g.EventTypes.onSlideshowStop,this.carouselSlideshowStopHandler);a.isNothing(this.toolbar)||(a.Events.add(this.toolbar,f.EventTypes.onTap,this.toolbarTapHandler),a.Events.add(this.toolbar,
f.EventTypes.onBeforeShow,this.toolbarBeforeShowHandler),a.Events.add(this.toolbar,f.EventTypes.onShow,this.toolbarShowHandler),a.Events.add(this.toolbar,f.EventTypes.onBeforeHide,this.toolbarBeforeHideHandler),a.Events.add(this.toolbar,f.EventTypes.onHide,this.toolbarHideHandler))},removeEventHandlers:function(){a.Browser.iOS&&!a.Browser.safari&&a.Events.remove(e.document.body,"orientationchange",this.windowOrientationChangeHandler);a.isNothing(this.orientationEventName)||a.Events.remove(e,this.orientationEventName,
this.windowOrientationChangeHandler);a.Events.remove(e,"scroll",this.windowScrollHandler);this.settings.enableKeyboard&&a.Events.remove(e.document,"keydown",this.keyDownHandler);this.isBackEventSupported&&this.settings.backButtonHideEnabled&&a.Events.remove(e,"hashchange",this.windowHashChangeHandler);this.settings.enableMouseWheel&&a.Events.remove(e,"mousewheel",this.mouseWheelHandler);a.isNothing(this.uiLayer)||a.Events.remove(this.uiLayer,a.TouchElement.EventTypes.onTouch,this.uiLayerTouchHandler);
a.isNothing(this.toolbar)||(a.Events.remove(this.carousel,g.EventTypes.onSlideByEnd,this.carouselSlideByEndHandler),a.Events.remove(this.carousel,g.EventTypes.onSlideshowStart,this.carouselSlideshowStartHandler),a.Events.remove(this.carousel,g.EventTypes.onSlideshowStop,this.carouselSlideshowStopHandler));a.isNothing(this.toolbar)||(a.Events.remove(this.toolbar,f.EventTypes.onTap,this.toolbarTapHandler),a.Events.remove(this.toolbar,f.EventTypes.onBeforeShow,this.toolbarBeforeShowHandler),a.Events.remove(this.toolbar,
f.EventTypes.onShow,this.toolbarShowHandler),a.Events.remove(this.toolbar,f.EventTypes.onBeforeHide,this.toolbarBeforeHideHandler),a.Events.remove(this.toolbar,f.EventTypes.onHide,this.toolbarHideHandler))},hide:function(){if(!this.settings.preventHide){if(a.isNothing(this.documentOverlay))throw"Code.PhotoSwipe.PhotoSwipeClass.hide: PhotoSwipe instance is already hidden";if(a.isNothing(this.hiding)){this.clearUIWebViewResetPositionTimeout();this.destroyZoomPanRotate();this.removeEventHandlers();a.Events.fire(this,
{type:h.EventTypes.onBeforeHide,target:this});this.uiLayer.dispose();this.uiLayer=null;if(!a.isNothing(this.toolbar))this.toolbar.dispose(),this.toolbar=null;this.carousel.dispose();this.carousel=null;a.DOM.removeClass(e.document.body,h.CssClasses.activeBody);this.documentOverlay.dispose();this.documentOverlay=null;this._isResettingPosition=!1;h.unsetActivateInstance(this);a.Events.fire(this,{type:h.EventTypes.onHide,target:this});this.goBackInHistory()}}},goBackInHistory:function(){this.isBackEventSupported&&
this.settings.backButtonHideEnabled&&(this.backButtonClicked||e.history.back())},play:function(){!this.isZoomActive()&&!this.settings.preventSlideshow&&!a.isNothing(this.carousel)&&(!a.isNothing(this.toolbar)&&this.toolbar.isVisible&&this.toolbar.fadeOut(),this.carousel.startSlideshow())},stop:function(){this.isZoomActive()||a.isNothing(this.carousel)||this.carousel.stopSlideshow()},previous:function(){this.isZoomActive()||a.isNothing(this.carousel)||this.carousel.previous()},next:function(){this.isZoomActive()||
a.isNothing(this.carousel)||this.carousel.next()},toggleToolbar:function(){this.isZoomActive()||a.isNothing(this.toolbar)||this.toolbar.toggleVisibility(this.currentIndex)},fadeOutToolbarIfVisible:function(){!a.isNothing(this.toolbar)&&this.toolbar.isVisible&&this.settings.captionAndToolbarAutoHideDelay>0&&this.toolbar.fadeOut()},createZoomPanRotate:function(){this.stop();if(this.canUserZoom()&&!this.isZoomActive())a.Events.fire(this,h.EventTypes.onBeforeZoomPanRotateShow),this.zoomPanRotate=new j.ZoomPanRotateClass(this.settings,
this.cache.images[this.currentIndex],this.uiLayer),this.uiLayer.captureSettings.preventDefaultTouchEvents=!0,a.Events.add(this.zoomPanRotate,h.ZoomPanRotate.EventTypes.onTransform,this.zoomPanRotateTransformHandler),a.Events.fire(this,h.EventTypes.onZoomPanRotateShow),!a.isNothing(this.toolbar)&&this.toolbar.isVisible&&this.toolbar.fadeOut()},destroyZoomPanRotate:function(){if(!a.isNothing(this.zoomPanRotate))a.Events.fire(this,h.EventTypes.onBeforeZoomPanRotateHide),a.Events.remove(this.zoomPanRotate,
h.ZoomPanRotate.EventTypes.onTransform,this.zoomPanRotateTransformHandler),this.zoomPanRotate.dispose(),this.zoomPanRotate=null,this.uiLayer.captureSettings.preventDefaultTouchEvents=this.settings.preventDefaultTouchEvents,a.Events.fire(this,h.EventTypes.onZoomPanRotateHide)},canUserZoom:function(){var b;if(a.Browser.msie){if(b=document.createElement("div"),a.isNothing(b.style.msTransform))return!1}else if(!a.Browser.isCSSTransformSupported)return!1;if(!this.settings.allowUserZoom)return!1;if(this.carousel.isSliding)return!1;
b=this.cache.images[this.currentIndex];if(a.isNothing(b))return!1;if(b.isLoading)return!1;return!0},isZoomActive:function(){return!a.isNothing(this.zoomPanRotate)},getCurrentImage:function(){return this.cache.images[this.currentIndex]},onDocumentOverlayFadeIn:function(){e.setTimeout(function(){var b=this.settings.target===e?e.document.body:this.settings.target;a.DOM.removeClass(b,h.CssClasses.buildingBody);a.DOM.addClass(b,h.CssClasses.activeBody);this.addEventHandlers();this.carousel.show(this.currentIndex);
this.uiLayer.show();this.settings.autoStartSlideshow?this.play():a.isNothing(this.toolbar)||this.toolbar.show(this.currentIndex);a.Events.fire(this,{type:h.EventTypes.onShow,target:this});this.setUIWebViewResetPositionTimeout()}.bind(this),250)},setUIWebViewResetPositionTimeout:function(){if(this.settings.enableUIWebViewRepositionTimeout&&a.Browser.iOS&&!a.Browser.safari)a.isNothing(this._uiWebViewResetPositionTimeout)||e.clearTimeout(this._uiWebViewResetPositionTimeout),this._uiWebViewResetPositionTimeout=
e.setTimeout(function(){this.resetPosition();this.setUIWebViewResetPositionTimeout()}.bind(this),this.settings.uiWebViewResetPositionDelay)},clearUIWebViewResetPositionTimeout:function(){a.isNothing(this._uiWebViewResetPositionTimeout)||e.clearTimeout(this._uiWebViewResetPositionTimeout)},onWindowScroll:function(){this.resetPosition()},onWindowOrientationChange:function(){this.resetPosition()},onWindowHashChange:function(){if(e.location.hash!=="#"+(this.settings.jQueryMobile?this.settings.jQueryMobileDialogHash:
this.currentHistoryHashValue))this.backButtonClicked=!0,this.hide()},onKeyDown:function(a){a.keyCode===37?(a.preventDefault(),this.previous()):a.keyCode===39?(a.preventDefault(),this.next()):a.keyCode===38||a.keyCode===40?a.preventDefault():a.keyCode===27?(a.preventDefault(),this.hide()):a.keyCode===32?(this.settings.hideToolbar?this.hide():this.toggleToolbar(),a.preventDefault()):a.keyCode===13&&(a.preventDefault(),this.play())},onUILayerTouch:function(b){if(this.isZoomActive())switch(b.action){case a.TouchElement.ActionTypes.gestureChange:this.zoomPanRotate.zoomRotate(b.scale,
this.settings.allowRotationOnUserZoom?b.rotation:0);break;case a.TouchElement.ActionTypes.gestureEnd:this.zoomPanRotate.setStartingScaleAndRotation(b.scale,this.settings.allowRotationOnUserZoom?b.rotation:0);break;case a.TouchElement.ActionTypes.touchStart:this.zoomPanRotate.panStart(b.point);break;case a.TouchElement.ActionTypes.touchMove:this.zoomPanRotate.pan(b.point);break;case a.TouchElement.ActionTypes.doubleTap:this.destroyZoomPanRotate();this.toggleToolbar();break;case a.TouchElement.ActionTypes.swipeLeft:this.destroyZoomPanRotate();
this.next();this.toggleToolbar();break;case a.TouchElement.ActionTypes.swipeRight:this.destroyZoomPanRotate(),this.previous(),this.toggleToolbar()}else switch(b.action){case a.TouchElement.ActionTypes.touchMove:case a.TouchElement.ActionTypes.swipeLeft:case a.TouchElement.ActionTypes.swipeRight:this.fadeOutToolbarIfVisible();this.carousel.onTouch(b.action,b.point);break;case a.TouchElement.ActionTypes.touchStart:case a.TouchElement.ActionTypes.touchMoveEnd:this.carousel.onTouch(b.action,b.point);
break;case a.TouchElement.ActionTypes.tap:this.toggleToolbar();break;case a.TouchElement.ActionTypes.doubleTap:this.settings.target===e&&(b.point.x-=a.DOM.windowScrollLeft(),b.point.y-=a.DOM.windowScrollTop());var c=this.cache.images[this.currentIndex].imageEl,d=e.parseInt(a.DOM.getStyle(c,"top"),10),f=e.parseInt(a.DOM.getStyle(c,"left"),10),g=f+a.DOM.width(c),c=d+a.DOM.height(c);if(b.point.x<f)b.point.x=f;else if(b.point.x>g)b.point.x=g;if(b.point.y<d)b.point.y=d;else if(b.point.y>c)b.point.y=c;
this.createZoomPanRotate();this.isZoomActive()&&this.zoomPanRotate.zoomAndPanToPoint(this.settings.doubleTapZoomLevel,b.point);break;case a.TouchElement.ActionTypes.gestureStart:this.createZoomPanRotate()}a.Events.fire(this,{type:h.EventTypes.onTouch,target:this,point:b.point,action:b.action})},onCarouselSlideByEnd:function(b){this.currentIndex=b.cacheIndex;a.isNothing(this.toolbar)||(this.toolbar.setCaption(this.currentIndex),this.toolbar.setToolbarStatus(this.currentIndex));a.Events.fire(this,{type:h.EventTypes.onDisplayImage,
target:this,action:b.action,index:b.cacheIndex})},onToolbarTap:function(b){switch(b.action){case f.ToolbarAction.next:this.next();break;case f.ToolbarAction.previous:this.previous();break;case f.ToolbarAction.close:this.hide();break;case f.ToolbarAction.play:this.play()}a.Events.fire(this,{type:h.EventTypes.onToolbarTap,target:this,toolbarAction:b.action,tapTarget:b.tapTarget})},onMouseWheel:function(b){var c=a.Events.getWheelDelta(b);if(!(b.timeStamp-(this.mouseWheelStartTime||0)<this.settings.mouseWheelSpeed))this.mouseWheelStartTime=
b.timeStamp,this.settings.invertMouseWheel&&(c*=-1),c<0?this.next():c>0&&this.previous()},onCarouselSlideshowStart:function(){a.Events.fire(this,{type:h.EventTypes.onSlideshowStart,target:this})},onCarouselSlideshowStop:function(){a.Events.fire(this,{type:h.EventTypes.onSlideshowStop,target:this})},onToolbarBeforeShow:function(){a.Events.fire(this,{type:h.EventTypes.onBeforeCaptionAndToolbarShow,target:this})},onToolbarShow:function(){a.Events.fire(this,{type:h.EventTypes.onCaptionAndToolbarShow,
target:this})},onToolbarBeforeHide:function(){a.Events.fire(this,{type:h.EventTypes.onBeforeCaptionAndToolbarHide,target:this})},onToolbarHide:function(){a.Events.fire(this,{type:h.EventTypes.onCaptionAndToolbarHide,target:this})},onZoomPanRotateTransform:function(b){a.Events.fire(this,{target:this,type:h.EventTypes.onZoomPanRotateTransform,scale:b.scale,rotation:b.rotation,rotationDegs:b.rotationDegs,translateX:b.translateX,translateY:b.translateY})}})})(window,window.klass,window.Code.Util,window.Code.PhotoSwipe.Cache,
window.Code.PhotoSwipe.DocumentOverlay,window.Code.PhotoSwipe.Carousel,window.Code.PhotoSwipe.Toolbar,window.Code.PhotoSwipe.UILayer,window.Code.PhotoSwipe.ZoomPanRotate);

;(function(exports,undefined){"use strict";var modules={};function require(ids,callback){var module,defs=[];for(var i=0;i<ids.length;++i){module=modules[ids[i]]||resolve(ids[i]);if(!module){throw'module definition dependecy not found: '+ids[i];}
defs.push(module);}
callback.apply(null,defs);}
function define(id,dependencies,definition){if(typeof id!=='string'){throw'invalid module definition, module id must be defined and be a string';}
if(dependencies===undefined){throw'invalid module definition, dependencies must be specified';}
if(definition===undefined){throw'invalid module definition, definition function must be specified';}
require(dependencies,function(){modules[id]=definition.apply(null,arguments);});}
function defined(id){return!!modules[id];}
function resolve(id){var target=exports;var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]]){return;}
target=target[fragments[fi]];}
return target;}
function expose(ids){for(var i=0;i<ids.length;i++){var target=exports;var id=ids[i];var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi){if(target[fragments[fi]]===undefined){target[fragments[fi]]={};}
target=target[fragments[fi]];}
target[fragments[fragments.length-1]]=modules[id];}}
define('moxie/core/utils/Basic',[],function(){var typeOf=function(o){var undef;if(o===undef){return'undefined';}else if(o===null){return'null';}else if(o.nodeType){return'node';}
return({}).toString.call(o).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();};var extend=function(target){var undef;each(arguments,function(arg,i){if(i>0){each(arg,function(value,key){if(value!==undef){if(typeOf(target[key])===typeOf(value)&&!!~inArray(typeOf(value),['array','object'])){extend(target[key],value);}else{target[key]=value;}}});}});return target;};var each=function(obj,callback){var length,key,i,undef;if(obj){try{length=obj.length;}catch(ex){length=undef;}
if(length===undef){for(key in obj){if(obj.hasOwnProperty(key)){if(callback(obj[key],key)===false){return;}}}}else{for(i=0;i<length;i++){if(callback(obj[i],i)===false){return;}}}}};var isEmptyObj=function(obj){var prop;if(!obj||typeOf(obj)!=='object'){return true;}
for(prop in obj){return false;}
return true;};var inSeries=function(queue,cb){var i=0,length=queue.length;if(typeOf(cb)!=='function'){cb=function(){};}
if(!queue||!queue.length){cb();}
function callNext(i){if(typeOf(queue[i])==='function'){queue[i](function(error){++i<length&&!error?callNext(i):cb(error);});}}
callNext(i);};var inParallel=function(queue,cb){var count=0,num=queue.length,cbArgs=new Array(num);each(queue,function(fn,i){fn(function(error){if(error){return cb(error);}
var args=[].slice.call(arguments);args.shift();cbArgs[i]=args;count++;if(count===num){cbArgs.unshift(null);cb.apply(this,cbArgs);}});});};var inArray=function(needle,array){if(array){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(array,needle);}
for(var i=0,length=array.length;i<length;i++){if(array[i]===needle){return i;}}}
return-1;};var arrayDiff=function(needles,array){var diff=[];if(typeOf(needles)!=='array'){needles=[needles];}
if(typeOf(array)!=='array'){array=[array];}
for(var i in needles){if(inArray(needles[i],array)===-1){diff.push(needles[i]);}}
return diff.length?diff:false;};var arrayIntersect=function(array1,array2){var result=[];each(array1,function(item){if(inArray(item,array2)!==-1){result.push(item);}});return result.length?result:null;};var toArray=function(obj){var i,arr=[];for(i=0;i<obj.length;i++){arr[i]=obj[i];}
return arr;};var guid=(function(){var counter=0;return function(prefix){var guid=new Date().getTime().toString(32),i;for(i=0;i<5;i++){guid+=Math.floor(Math.random()*65535).toString(32);}
return(prefix||'o_')+guid+(counter++).toString(32);};}());var trim=function(str){if(!str){return str;}
return String.prototype.trim?String.prototype.trim.call(str):str.toString().replace(/^\s*/,'').replace(/\s*$/,'');};var parseSizeStr=function(size){if(typeof(size)!=='string'){return size;}
var muls={t:1099511627776,g:1073741824,m:1048576,k:1024},mul;size=/^([0-9]+)([mgk]?)$/.exec(size.toLowerCase().replace(/[^0-9mkg]/g,''));mul=size[2];size=+size[1];if(muls.hasOwnProperty(mul)){size*=muls[mul];}
return size;};return{guid:guid,typeOf:typeOf,extend:extend,each:each,isEmptyObj:isEmptyObj,inSeries:inSeries,inParallel:inParallel,inArray:inArray,arrayDiff:arrayDiff,arrayIntersect:arrayIntersect,toArray:toArray,trim:trim,parseSizeStr:parseSizeStr};});define("moxie/core/I18n",["moxie/core/utils/Basic"],function(Basic){var i18n={};return{addI18n:function(pack){return Basic.extend(i18n,pack);},translate:function(str){return i18n[str]||str;},_:function(str){return this.translate(str);},sprintf:function(str){var args=[].slice.call(arguments,1);return str.replace(/%[a-z]/g,function(){var value=args.shift();return Basic.typeOf(value)!=='undefined'?value:'';});}};});define("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(Basic,I18n){var mimeData=""+"application/msword,doc dot,"+"application/pdf,pdf,"+"application/pgp-signature,pgp,"+"application/postscript,ps ai eps,"+"application/rtf,rtf,"+"application/vnd.ms-excel,xls xlb,"+"application/vnd.ms-powerpoint,ppt pps pot,"+"application/zip,zip,"+"application/x-shockwave-flash,swf swfl,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,"+"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,"+"application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,"+"application/vnd.openxmlformats-officedocument.presentationml.template,potx,"+"application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,"+"application/x-javascript,js,"+"application/json,json,"+"audio/mpeg,mp3 mpga mpega mp2,"+"audio/x-wav,wav,"+"audio/x-m4a,m4a,"+"audio/ogg,oga ogg,"+"audio/aiff,aiff aif,"+"audio/flac,flac,"+"audio/aac,aac,"+"audio/ac3,ac3,"+"audio/x-ms-wma,wma,"+"image/bmp,bmp,"+"image/gif,gif,"+"image/jpeg,jpg jpeg jpe,"+"image/photoshop,psd,"+"image/png,png,"+"image/svg+xml,svg svgz,"+"image/tiff,tiff tif,"+"text/plain,asc txt text diff log,"+"text/html,htm html xhtml,"+"text/css,css,"+"text/csv,csv,"+"text/rtf,rtf,"+"video/mpeg,mpeg mpg mpe m2v,"+"video/quicktime,qt mov,"+"video/mp4,mp4,"+"video/x-m4v,m4v,"+"video/x-flv,flv,"+"video/x-ms-wmv,wmv,"+"video/avi,avi,"+"video/webm,webm,"+"video/3gpp,3gpp 3gp,"+"video/3gpp2,3g2,"+"video/vnd.rn-realvideo,rv,"+"video/ogg,ogv,"+"video/x-matroska,mkv,"+"application/vnd.oasis.opendocument.formula-template,otf,"+"application/octet-stream,exe";var Mime={mimes:{},extensions:{},addMimeType:function(mimeData){var items=mimeData.split(/,/),i,ii,ext;for(i=0;i<items.length;i+=2){ext=items[i+1].split(/ /);for(ii=0;ii<ext.length;ii++){this.mimes[ext[ii]]=items[i];}
this.extensions[items[i]]=ext;}},extList2mimes:function(filters,addMissingExtensions){var self=this,ext,i,ii,type,mimes=[];for(i=0;i<filters.length;i++){ext=filters[i].extensions.split(/\s*,\s*/);for(ii=0;ii<ext.length;ii++){if(ext[ii]==='*'){return[];}
type=self.mimes[ext[ii]];if(!type){if(addMissingExtensions&&/^\w+$/.test(ext[ii])){mimes.push('.'+ext[ii]);}else{return[];}}else if(Basic.inArray(type,mimes)===-1){mimes.push(type);}}}
return mimes;},mimes2exts:function(mimes){var self=this,exts=[];Basic.each(mimes,function(mime){if(mime==='*'){exts=[];return false;}
var m=mime.match(/^(\w+)\/(\*|\w+)$/);if(m){if(m[2]==='*'){Basic.each(self.extensions,function(arr,mime){if((new RegExp('^'+m[1]+'/')).test(mime)){[].push.apply(exts,self.extensions[mime]);}});}else if(self.extensions[mime]){[].push.apply(exts,self.extensions[mime]);}}});return exts;},mimes2extList:function(mimes){var accept=[],exts=[];if(Basic.typeOf(mimes)==='string'){mimes=Basic.trim(mimes).split(/\s*,\s*/);}
exts=this.mimes2exts(mimes);accept.push({title:I18n.translate('Files'),extensions:exts.length?exts.join(','):'*'});accept.mimes=mimes;return accept;},getFileExtension:function(fileName){var matches=fileName&&fileName.match(/\.([^.]+)$/);if(matches){return matches[1].toLowerCase();}
return'';},getFileMime:function(fileName){return this.mimes[this.getFileExtension(fileName)]||'';}};Mime.addMimeType(mimeData);return Mime;});define("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(Basic){var UAParser=(function(undefined){var EMPTY='',UNKNOWN='?',FUNC_TYPE='function',UNDEF_TYPE='undefined',OBJ_TYPE='object',MAJOR='major',MODEL='model',NAME='name',TYPE='type',VENDOR='vendor',VERSION='version',ARCHITECTURE='architecture',CONSOLE='console',MOBILE='mobile',TABLET='tablet';var util={has:function(str1,str2){return str2.toLowerCase().indexOf(str1.toLowerCase())!==-1;},lowerize:function(str){return str.toLowerCase();}};var mapper={rgx:function(){for(var result,i=0,j,k,p,q,matches,match,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(typeof(result)===UNDEF_TYPE){result={};for(p in props){q=props[p];if(typeof(q)===OBJ_TYPE){result[q[0]]=undefined;}else{result[q]=undefined;}}}
for(j=k=0;j<regex.length;j++){matches=regex[j].exec(this.getUA());if(!!matches){for(p=0;p<props.length;p++){match=matches[++k];q=props[p];if(typeof(q)===OBJ_TYPE&&q.length>0){if(q.length==2){if(typeof(q[1])==FUNC_TYPE){result[q[0]]=q[1].call(this,match);}else{result[q[0]]=q[1];}}else if(q.length==3){if(typeof(q[1])===FUNC_TYPE&&!(q[1].exec&&q[1].test)){result[q[0]]=match?q[1].call(this,match,q[2]):undefined;}else{result[q[0]]=match?match.replace(q[1],q[2]):undefined;}}else if(q.length==4){result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined;}}else{result[q]=match?match:undefined;}}
break;}}
if(!!matches)break;}
return result;},str:function(str,map){for(var i in map){if(typeof(map[i])===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(util.has(map[i][j],str)){return(i===UNKNOWN)?undefined:i;}}}else if(util.has(map[i],str)){return(i===UNKNOWN)?undefined:i;}}
return str;}};var maps={browser:{oldsafari:{major:{'1':['/8','/1','/3'],'2':'/4','?':'/'},version:{'1.0':'/8','1.2':'/1','1.3':'/3','2.0':'/412','2.0.2':'/416','2.0.3':'/417','2.0.4':'/419','?':'/'}}},device:{sprint:{model:{'Evo Shift 4G':'7373KT'},vendor:{'HTC':'APA','Sprint':'Sprint'}}},os:{windows:{version:{'ME':'4.90','NT 3.11':'NT3.51','NT 4.0':'NT4.0','2000':'NT 5.0','XP':['NT 5.1','NT 5.2'],'Vista':'NT 6.0','7':'NT 6.1','8':'NT 6.2','8.1':'NT 6.3','RT':'ARM'}}}};var regexes={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[NAME,'Opera'],VERSION,MAJOR],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[NAME,'IE'],VERSION,MAJOR],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[NAME,'Yandex'],VERSION,MAJOR],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[NAME,/_/g,' '],VERSION,MAJOR],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[NAME,'Dolphin'],VERSION,MAJOR],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[NAME,'Chrome'],VERSION,MAJOR],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[NAME,'Android Browser'],VERSION,MAJOR],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,MAJOR,[NAME,'Mobile Safari']],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,MAJOR,NAME],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[NAME,[MAJOR,mapper.str,maps.browser.oldsafari.major],[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[NAME,'Netscape'],VERSION,MAJOR],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,'Windows'],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,'BlackBerry'],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,'Symbian'],VERSION],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,'Firefox OS'],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,'Chromium OS'],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,'Solaris'],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,'iOS'],[VERSION,/_/g,'.']],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[NAME,[VERSION,/_/g,'.']],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]};var UAParser=function(uastring){var ua=uastring||((window&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:EMPTY);this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser);};this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine);};this.getOS=function(){return mapper.rgx.apply(this,regexes.os);};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()};};this.getUA=function(){return ua;};this.setUA=function(uastring){ua=uastring;return this;};this.setUA(ua);};return new UAParser().getResult();})();function version_compare(v1,v2,operator){var i=0,x=0,compare=0,vm={'dev':-6,'alpha':-5,'a':-5,'beta':-4,'b':-4,'RC':-3,'rc':-3,'#':-2,'p':1,'pl':1},prepVersion=function(v){v=(''+v).replace(/[_\-+]/g,'.');v=v.replace(/([^.\d]+)/g,'.$1.').replace(/\.{2,}/g,'.');return(!v.length?[-8]:v.split('.'));},numVersion=function(v){return!v?0:(isNaN(v)?vm[v]||-7:parseInt(v,10));};v1=prepVersion(v1);v2=prepVersion(v2);x=Math.max(v1.length,v2.length);for(i=0;i<x;i++){if(v1[i]==v2[i]){continue;}
v1[i]=numVersion(v1[i]);v2[i]=numVersion(v2[i]);if(v1[i]<v2[i]){compare=-1;break;}else if(v1[i]>v2[i]){compare=1;break;}}
if(!operator){return compare;}
switch(operator){case'>':case'gt':return(compare>0);case'>=':case'ge':return(compare>=0);case'<=':case'le':return(compare<=0);case'==':case'=':case'eq':return(compare===0);case'<>':case'!=':case'ne':return(compare!==0);case'':case'<':case'lt':return(compare<0);default:return null;}}
var can=(function(){var caps={define_property:(function(){return false;}()),create_canvas:(function(){var el=document.createElement('canvas');return!!(el.getContext&&el.getContext('2d'));}()),return_response_type:function(responseType){try{if(Basic.inArray(responseType,['','text','document'])!==-1){return true;}else if(window.XMLHttpRequest){var xhr=new XMLHttpRequest();xhr.open('get','/');if('responseType'in xhr){xhr.responseType=responseType;if(xhr.responseType!==responseType){return false;}
return true;}}}catch(ex){}
return false;},use_data_uri:(function(){var du=new Image();du.onload=function(){caps.use_data_uri=(du.width===1&&du.height===1);};setTimeout(function(){du.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";},1);return false;}()),use_data_uri_over32kb:function(){return caps.use_data_uri&&(Env.browser!=='IE'||Env.version>=9);},use_data_uri_of:function(bytes){return(caps.use_data_uri&&bytes<33000||caps.use_data_uri_over32kb());},use_fileinput:function(){var el=document.createElement('input');el.setAttribute('type','file');return!el.disabled;}};return function(cap){var args=[].slice.call(arguments);args.shift();return Basic.typeOf(caps[cap])==='function'?caps[cap].apply(this,args):!!caps[cap];};}());var Env={can:can,browser:UAParser.browser.name,version:parseFloat(UAParser.browser.major),os:UAParser.os.name,osVersion:UAParser.os.version,verComp:version_compare,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};Env.OS=Env.os;return Env;});define('moxie/core/utils/Dom',['moxie/core/utils/Env'],function(Env){var get=function(id){if(typeof id!=='string'){return id;}
return document.getElementById(id);};var hasClass=function(obj,name){if(!obj.className){return false;}
var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");return regExp.test(obj.className);};var addClass=function(obj,name){if(!hasClass(obj,name)){obj.className=!obj.className?name:obj.className.replace(/\s+$/,'')+' '+name;}};var removeClass=function(obj,name){if(obj.className){var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");obj.className=obj.className.replace(regExp,function($0,$1,$2){return $1===' '&&$2===' '?' ':'';});}};var getStyle=function(obj,name){if(obj.currentStyle){return obj.currentStyle[name];}else if(window.getComputedStyle){return window.getComputedStyle(obj,null)[name];}};var getPos=function(node,root){var x=0,y=0,parent,doc=document,nodeRect,rootRect;node=node;root=root||doc.body;function getIEPos(node){var bodyElm,rect,x=0,y=0;if(node){rect=node.getBoundingClientRect();bodyElm=doc.compatMode==="CSS1Compat"?doc.documentElement:doc.body;x=rect.left+bodyElm.scrollLeft;y=rect.top+bodyElm.scrollTop;}
return{x:x,y:y};}
if(node&&node.getBoundingClientRect&&Env.browser==='IE'&&(!doc.documentMode||doc.documentMode<8)){nodeRect=getIEPos(node);rootRect=getIEPos(root);return{x:nodeRect.x-rootRect.x,y:nodeRect.y-rootRect.y};}
parent=node;while(parent&&parent!=root&&parent.nodeType){x+=parent.offsetLeft||0;y+=parent.offsetTop||0;parent=parent.offsetParent;}
parent=node.parentNode;while(parent&&parent!=root&&parent.nodeType){x-=parent.scrollLeft||0;y-=parent.scrollTop||0;parent=parent.parentNode;}
return{x:x,y:y};};var getSize=function(node){return{w:node.offsetWidth||node.clientWidth,h:node.offsetHeight||node.clientHeight};};return{get:get,hasClass:hasClass,addClass:addClass,removeClass:removeClass,getStyle:getStyle,getPos:getPos,getSize:getSize};});define('moxie/core/Exceptions',['moxie/core/utils/Basic'],function(Basic){function _findKey(obj,value){var key;for(key in obj){if(obj[key]===value){return key;}}
return null;}
return{RuntimeError:(function(){var namecodes={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};function RuntimeError(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": RuntimeError "+this.code;}
Basic.extend(RuntimeError,namecodes);RuntimeError.prototype=Error.prototype;return RuntimeError;}()),OperationNotAllowedException:(function(){function OperationNotAllowedException(code){this.code=code;this.name='OperationNotAllowedException';}
Basic.extend(OperationNotAllowedException,{NOT_ALLOWED_ERR:1});OperationNotAllowedException.prototype=Error.prototype;return OperationNotAllowedException;}()),ImageError:(function(){var namecodes={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};function ImageError(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": ImageError "+this.code;}
Basic.extend(ImageError,namecodes);ImageError.prototype=Error.prototype;return ImageError;}()),FileException:(function(){var namecodes={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function FileException(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": FileException "+this.code;}
Basic.extend(FileException,namecodes);FileException.prototype=Error.prototype;return FileException;}()),DOMException:(function(){var namecodes={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function DOMException(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": DOMException "+this.code;}
Basic.extend(DOMException,namecodes);DOMException.prototype=Error.prototype;return DOMException;}()),EventException:(function(){function EventException(code){this.code=code;this.name='EventException';}
Basic.extend(EventException,{UNSPECIFIED_EVENT_TYPE_ERR:0});EventException.prototype=Error.prototype;return EventException;}())};});define('moxie/core/EventTarget',['moxie/core/Exceptions','moxie/core/utils/Basic'],function(x,Basic){function EventTarget(){var eventpool={};Basic.extend(this,{uid:null,init:function(){if(!this.uid){this.uid=Basic.guid('uid_');}},addEventListener:function(type,fn,priority,scope){var self=this,list;type=Basic.trim(type);if(/\s/.test(type)){Basic.each(type.split(/\s+/),function(type){self.addEventListener(type,fn,priority,scope);});return;}
type=type.toLowerCase();priority=parseInt(priority,10)||0;list=eventpool[this.uid]&&eventpool[this.uid][type]||[];list.push({fn:fn,priority:priority,scope:scope||this});if(!eventpool[this.uid]){eventpool[this.uid]={};}
eventpool[this.uid][type]=list;},hasEventListener:function(type){return type?!!(eventpool[this.uid]&&eventpool[this.uid][type]):!!eventpool[this.uid];},removeEventListener:function(type,fn){type=type.toLowerCase();var list=eventpool[this.uid]&&eventpool[this.uid][type],i;if(list){if(fn){for(i=list.length-1;i>=0;i--){if(list[i].fn===fn){list.splice(i,1);break;}}}else{list=[];}
if(!list.length){delete eventpool[this.uid][type];if(Basic.isEmptyObj(eventpool[this.uid])){delete eventpool[this.uid];}}}},removeAllEventListeners:function(){if(eventpool[this.uid]){delete eventpool[this.uid];}},dispatchEvent:function(type){var uid,list,args,tmpEvt,evt={},result=true,undef;if(Basic.typeOf(type)!=='string'){tmpEvt=type;if(Basic.typeOf(tmpEvt.type)==='string'){type=tmpEvt.type;if(tmpEvt.total!==undef&&tmpEvt.loaded!==undef){evt.total=tmpEvt.total;evt.loaded=tmpEvt.loaded;}
evt.async=tmpEvt.async||false;}else{throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);}}
if(type.indexOf('::')!==-1){(function(arr){uid=arr[0];type=arr[1];}(type.split('::')));}else{uid=this.uid;}
type=type.toLowerCase();list=eventpool[uid]&&eventpool[uid][type];if(list){list.sort(function(a,b){return b.priority-a.priority;});args=[].slice.call(arguments);args.shift();evt.type=type;args.unshift(evt);var queue=[];Basic.each(list,function(handler){args[0].target=handler.scope;if(evt.async){queue.push(function(cb){setTimeout(function(){cb(handler.fn.apply(handler.scope,args)===false);},1);});}else{queue.push(function(cb){cb(handler.fn.apply(handler.scope,args)===false);});}});if(queue.length){Basic.inSeries(queue,function(err){result=!err;});}}
return result;},bind:function(){this.addEventListener.apply(this,arguments);},unbind:function(){this.removeEventListener.apply(this,arguments);},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments);},trigger:function(){return this.dispatchEvent.apply(this,arguments);},convertEventPropsToHandlers:function(handlers){var h;if(Basic.typeOf(handlers)!=='array'){handlers=[handlers];}
for(var i=0;i<handlers.length;i++){h='on'+handlers[i];if(Basic.typeOf(this[h])==='function'){this.addEventListener(handlers[i],this[h]);}else if(Basic.typeOf(this[h])==='undefined'){this[h]=null;}}}});}
EventTarget.instance=new EventTarget();return EventTarget;});define('moxie/core/utils/Encode',[],function(){var utf8_encode=function(str){return unescape(encodeURIComponent(str));};var utf8_decode=function(str_data){return decodeURIComponent(escape(str_data));};var atob=function(data,utf8){if(typeof(window.atob)==='function'){return utf8?utf8_decode(window.atob(data)):window.atob(data);}
var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return utf8?utf8_decode(dec):dec;};var btoa=function(data,utf8){if(utf8){utf8_encode(data);}
if(typeof(window.btoa)==='function'){return window.btoa(data);}
var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data;}
do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3);};return{utf8_encode:utf8_encode,utf8_decode:utf8_decode,atob:atob,btoa:btoa};});define('moxie/runtime/Runtime',["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(Basic,Dom,EventTarget){var runtimeConstructors={},runtimes={};function Runtime(options,type,caps,modeCaps,preferredMode){var self=this,_shim,_uid=Basic.guid(type+'_'),defaultMode=preferredMode||'browser';options=options||{};runtimes[_uid]=this;caps=Basic.extend({access_binary:false,access_image_binary:false,display_media:false,do_cors:false,drag_and_drop:false,filter_by_extension:true,resize_image:false,report_upload_progress:false,return_response_headers:false,return_response_type:false,return_status_code:true,send_custom_headers:false,select_file:false,select_folder:false,select_multiple:true,send_binary_string:false,send_browser_cookies:true,send_multipart:true,slice_blob:false,stream_upload:false,summon_file_dialog:false,upload_filesize:true,use_http_method:true},caps);if(options.preferred_caps){defaultMode=Runtime.getMode(modeCaps,options.preferred_caps,defaultMode);}
_shim=(function(){var objpool={};return{exec:function(uid,comp,fn,args){if(_shim[comp]){if(!objpool[uid]){objpool[uid]={context:this,instance:new _shim[comp]()};}
if(objpool[uid].instance[fn]){return objpool[uid].instance[fn].apply(this,args);}}},removeInstance:function(uid){delete objpool[uid];},removeAllInstances:function(){var self=this;Basic.each(objpool,function(obj,uid){if(Basic.typeOf(obj.instance.destroy)==='function'){obj.instance.destroy.call(obj.context);}
self.removeInstance(uid);});}};}());Basic.extend(this,{initialized:false,uid:_uid,type:type,mode:Runtime.getMode(modeCaps,(options.required_caps),defaultMode),shimid:_uid+'_container',clients:0,options:options,can:function(cap,value){var refCaps=arguments[2]||caps;if(Basic.typeOf(cap)==='string'&&Basic.typeOf(value)==='undefined'){cap=Runtime.parseCaps(cap);}
if(Basic.typeOf(cap)==='object'){for(var key in cap){if(!this.can(key,cap[key],refCaps)){return false;}}
return true;}
if(Basic.typeOf(refCaps[cap])==='function'){return refCaps[cap].call(this,value);}else{return(value===refCaps[cap]);}},getShimContainer:function(){var container,shimContainer=Dom.get(this.shimid);if(!shimContainer){container=this.options.container?Dom.get(this.options.container):document.body;shimContainer=document.createElement('div');shimContainer.id=this.shimid;shimContainer.className='moxie-shim moxie-shim-'+this.type;Basic.extend(shimContainer.style,{position:'absolute',top:'0px',left:'0px',width:'1px',height:'1px',overflow:'hidden'});container.appendChild(shimContainer);container=null;}
return shimContainer;},getShim:function(){return _shim;},shimExec:function(component,action){var args=[].slice.call(arguments,2);return self.getShim().exec.call(this,this.uid,component,action,args);},exec:function(component,action){var args=[].slice.call(arguments,2);if(self[component]&&self[component][action]){return self[component][action].apply(this,args);}
return self.shimExec.apply(this,arguments);},destroy:function(){if(!self){return;}
var shimContainer=Dom.get(this.shimid);if(shimContainer){shimContainer.parentNode.removeChild(shimContainer);}
if(_shim){_shim.removeAllInstances();}
this.unbindAll();delete runtimes[this.uid];this.uid=null;_uid=self=_shim=shimContainer=null;}});if(this.mode&&options.required_caps&&!this.can(options.required_caps)){this.mode=false;}}
Runtime.order='html5,flash,silverlight,html4';Runtime.getRuntime=function(uid){return runtimes[uid]?runtimes[uid]:false;};Runtime.addConstructor=function(type,constructor){constructor.prototype=EventTarget.instance;runtimeConstructors[type]=constructor;};Runtime.getConstructor=function(type){return runtimeConstructors[type]||null;};Runtime.getInfo=function(uid){var runtime=Runtime.getRuntime(uid);if(runtime){return{uid:runtime.uid,type:runtime.type,mode:runtime.mode,can:function(){return runtime.can.apply(runtime,arguments);}};}
return null;};Runtime.parseCaps=function(capStr){var capObj={};if(Basic.typeOf(capStr)!=='string'){return capStr||{};}
Basic.each(capStr.split(','),function(key){capObj[key]=true;});return capObj;};Runtime.can=function(type,caps){var runtime,constructor=Runtime.getConstructor(type),mode;if(constructor){runtime=new constructor({required_caps:caps});mode=runtime.mode;runtime.destroy();return!!mode;}
return false;};Runtime.thatCan=function(caps,runtimeOrder){var types=(runtimeOrder||Runtime.order).split(/\s*,\s*/);for(var i in types){if(Runtime.can(types[i],caps)){return types[i];}}
return null;};Runtime.getMode=function(modeCaps,requiredCaps,defaultMode){var mode=null;if(Basic.typeOf(defaultMode)==='undefined'){defaultMode='browser';}
if(requiredCaps&&!Basic.isEmptyObj(modeCaps)){Basic.each(requiredCaps,function(value,cap){if(modeCaps.hasOwnProperty(cap)){var capMode=modeCaps[cap](value);if(typeof(capMode)==='string'){capMode=[capMode];}
if(!mode){mode=capMode;}else if(!(mode=Basic.arrayIntersect(mode,capMode))){return(mode=false);}}});if(mode){return Basic.inArray(defaultMode,mode)!==-1?defaultMode:mode[0];}else if(mode===false){return false;}}
return defaultMode;};Runtime.capTrue=function(){return true;};Runtime.capFalse=function(){return false;};Runtime.capTest=function(expr){return function(){return!!expr;};};return Runtime;});define('moxie/runtime/RuntimeClient',['moxie/core/Exceptions','moxie/core/utils/Basic','moxie/runtime/Runtime'],function(x,Basic,Runtime){return function RuntimeClient(){var runtime;Basic.extend(this,{connectRuntime:function(options){var comp=this,ruid;function initialize(items){var type,constructor;if(!items.length){comp.trigger('RuntimeError',new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));runtime=null;return;}
type=items.shift();constructor=Runtime.getConstructor(type);if(!constructor){initialize(items);return;}
runtime=new constructor(options);runtime.bind('Init',function(){runtime.initialized=true;setTimeout(function(){runtime.clients++;comp.trigger('RuntimeInit',runtime);},1);});runtime.bind('Error',function(){runtime.destroy();initialize(items);});if(!runtime.mode){runtime.trigger('Error');return;}
runtime.init();}
if(Basic.typeOf(options)==='string'){ruid=options;}else if(Basic.typeOf(options.ruid)==='string'){ruid=options.ruid;}
if(ruid){runtime=Runtime.getRuntime(ruid);if(runtime){runtime.clients++;return runtime;}else{throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR);}}
initialize((options.runtime_order||Runtime.order).split(/\s*,\s*/));},getRuntime:function(){if(runtime&&runtime.uid){return runtime;}
runtime=null;return null;},disconnectRuntime:function(){if(runtime&&--runtime.clients<=0){runtime.destroy();runtime=null;}}});};});define('moxie/file/Blob',['moxie/core/utils/Basic','moxie/core/utils/Encode','moxie/runtime/RuntimeClient'],function(Basic,Encode,RuntimeClient){var blobpool={};function Blob(ruid,blob){function _sliceDetached(start,end,type){var blob,data=blobpool[this.uid];if(Basic.typeOf(data)!=='string'||!data.length){return null;}
blob=new Blob(null,{type:type,size:end-start});blob.detach(data.substr(start,blob.size));return blob;}
RuntimeClient.call(this);if(ruid){this.connectRuntime(ruid);}
if(!blob){blob={};}else if(Basic.typeOf(blob)==='string'){blob={data:blob};}
Basic.extend(this,{uid:blob.uid||Basic.guid('uid_'),ruid:ruid,size:blob.size||0,type:blob.type||'',slice:function(start,end,type){if(this.isDetached()){return _sliceDetached.apply(this,arguments);}
return this.getRuntime().exec.call(this,'Blob','slice',this.getSource(),start,end,type);},getSource:function(){if(!blobpool[this.uid]){return null;}
return blobpool[this.uid];},detach:function(data){if(this.ruid){this.getRuntime().exec.call(this,'Blob','destroy');this.disconnectRuntime();this.ruid=null;}
data=data||'';var matches=data.match(/^data:([^;]*);base64,/);if(matches){this.type=matches[1];data=Encode.atob(data.substring(data.indexOf('base64,')+7));}
this.size=data.length;blobpool[this.uid]=data;},isDetached:function(){return!this.ruid&&Basic.typeOf(blobpool[this.uid])==='string';},destroy:function(){this.detach();delete blobpool[this.uid];}});if(blob.data){this.detach(blob.data);}else{blobpool[this.uid]=blob;}}
return Blob;});define('moxie/file/File',['moxie/core/utils/Basic','moxie/core/utils/Mime','moxie/file/Blob'],function(Basic,Mime,Blob){function File(ruid,file){var name,type;if(!file){file={};}
if(file.type&&file.type!==''){type=file.type;}else{type=Mime.getFileMime(file.name);}
if(file.name){name=file.name.replace(/\\/g,'/');name=name.substr(name.lastIndexOf('/')+1);}else{var prefix=type.split('/')[0];name=Basic.guid((prefix!==''?prefix:'file')+'_');if(Mime.extensions[type]){name+='.'+Mime.extensions[type][0];}}
Blob.apply(this,arguments);Basic.extend(this,{type:type||'',name:name||Basic.guid('file_'),lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString()});}
File.prototype=Blob.prototype;return File;});define('moxie/file/FileInput',['moxie/core/utils/Basic','moxie/core/utils/Mime','moxie/core/utils/Dom','moxie/core/Exceptions','moxie/core/EventTarget','moxie/core/I18n','moxie/file/File','moxie/runtime/Runtime','moxie/runtime/RuntimeClient'],function(Basic,Mime,Dom,x,EventTarget,I18n,File,Runtime,RuntimeClient){var dispatches=['ready','change','cancel','mouseenter','mouseleave','mousedown','mouseup'];function FileInput(options){var self=this,container,browseButton,defaults;if(Basic.inArray(Basic.typeOf(options),['string','node'])!==-1){options={browse_button:options};}
browseButton=Dom.get(options.browse_button);if(!browseButton){throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);}
defaults={accept:[{title:I18n.translate('All Files'),extensions:'*'}],name:'file',multiple:false,required_caps:false,container:browseButton.parentNode||document.body};options=Basic.extend({},defaults,options);if(typeof(options.required_caps)==='string'){options.required_caps=Runtime.parseCaps(options.required_caps);}
if(typeof(options.accept)==='string'){options.accept=Mime.mimes2extList(options.accept);}
container=Dom.get(options.container);if(!container){container=document.body;}
if(Dom.getStyle(container,'position')==='static'){container.style.position='relative';}
container=browseButton=null;RuntimeClient.call(self);Basic.extend(self,{uid:Basic.guid('uid_'),ruid:null,shimid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches);self.bind('RuntimeInit',function(e,runtime){self.ruid=runtime.uid;self.shimid=runtime.shimid;self.bind("Ready",function(){self.trigger("Refresh");},999);self.bind("Change",function(){var files=runtime.exec.call(self,'FileInput','getFiles');self.files=[];Basic.each(files,function(file){if(file.size===0){return true;}
self.files.push(new File(self.ruid,file));});},999);self.bind('Refresh',function(){var pos,size,browseButton,shimContainer;browseButton=Dom.get(options.browse_button);shimContainer=Dom.get(runtime.shimid);if(browseButton){pos=Dom.getPos(browseButton,Dom.get(options.container));size=Dom.getSize(browseButton);if(shimContainer){Basic.extend(shimContainer.style,{top:pos.y+'px',left:pos.x+'px',width:size.w+'px',height:size.h+'px'});}}
shimContainer=browseButton=null;});runtime.exec.call(self,'FileInput','init',options);});self.connectRuntime(Basic.extend({},options,{required_caps:{select_file:true}}));},disable:function(state){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileInput','disable',Basic.typeOf(state)==='undefined'?true:state);}},refresh:function(){self.trigger("Refresh");},destroy:function(){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileInput','destroy');this.disconnectRuntime();}
if(Basic.typeOf(this.files)==='array'){Basic.each(this.files,function(file){file.destroy();});}
this.files=null;}});}
FileInput.prototype=EventTarget.instance;return FileInput;});define('moxie/file/FileDrop',['moxie/core/I18n','moxie/core/utils/Dom','moxie/core/Exceptions','moxie/core/utils/Basic','moxie/file/File','moxie/runtime/RuntimeClient','moxie/core/EventTarget','moxie/core/utils/Mime'],function(I18n,Dom,x,Basic,File,RuntimeClient,EventTarget,Mime){var dispatches=['ready','dragenter','dragleave','drop','error'];function FileDrop(options){var self=this,defaults;if(typeof(options)==='string'){options={drop_zone:options};}
defaults={accept:[{title:I18n.translate('All Files'),extensions:'*'}],required_caps:{drag_and_drop:true}};options=typeof(options)==='object'?Basic.extend({},defaults,options):defaults;options.container=Dom.get(options.drop_zone)||document.body;if(Dom.getStyle(options.container,'position')==='static'){options.container.style.position='relative';}
if(typeof(options.accept)==='string'){options.accept=Mime.mimes2extList(options.accept);}
RuntimeClient.call(self);Basic.extend(self,{uid:Basic.guid('uid_'),ruid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches);self.bind('RuntimeInit',function(e,runtime){self.ruid=runtime.uid;self.bind("Drop",function(){var files=runtime.exec.call(self,'FileDrop','getFiles');self.files=[];Basic.each(files,function(file){self.files.push(new File(self.ruid,file));});},999);runtime.exec.call(self,'FileDrop','init',options);self.dispatchEvent('ready');});self.connectRuntime(options);},destroy:function(){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileDrop','destroy');this.disconnectRuntime();}
this.files=null;}});}
FileDrop.prototype=EventTarget.instance;return FileDrop;});define('moxie/runtime/RuntimeTarget',['moxie/core/utils/Basic','moxie/runtime/RuntimeClient',"moxie/core/EventTarget"],function(Basic,RuntimeClient,EventTarget){function RuntimeTarget(){this.uid=Basic.guid('uid_');RuntimeClient.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll();};}
RuntimeTarget.prototype=EventTarget.instance;return RuntimeTarget;});define('moxie/file/FileReader',['moxie/core/utils/Basic','moxie/core/utils/Encode','moxie/core/Exceptions','moxie/core/EventTarget','moxie/file/Blob','moxie/file/File','moxie/runtime/RuntimeTarget'],function(Basic,Encode,x,EventTarget,Blob,File,RuntimeTarget){var dispatches=['loadstart','progress','load','abort','error','loadend'];function FileReader(){var self=this,_fr;Basic.extend(this,{uid:Basic.guid('uid_'),readyState:FileReader.EMPTY,result:null,error:null,readAsBinaryString:function(blob){_read.call(this,'readAsBinaryString',blob);},readAsDataURL:function(blob){_read.call(this,'readAsDataURL',blob);},readAsText:function(blob){_read.call(this,'readAsText',blob);},abort:function(){this.result=null;if(Basic.inArray(this.readyState,[FileReader.EMPTY,FileReader.DONE])!==-1){return;}else if(this.readyState===FileReader.LOADING){this.readyState=FileReader.DONE;}
if(_fr){_fr.getRuntime().exec.call(this,'FileReader','abort');}
this.trigger('abort');this.trigger('loadend');},destroy:function(){this.abort();if(_fr){_fr.getRuntime().exec.call(this,'FileReader','destroy');_fr.disconnectRuntime();}
self=_fr=null;}});function _read(op,blob){_fr=new RuntimeTarget();function error(err){self.readyState=FileReader.DONE;self.error=err;self.trigger('error');loadEnd();}
function loadEnd(){_fr.destroy();_fr=null;self.trigger('loadend');}
function exec(runtime){_fr.bind('Error',function(e,err){error(err);});_fr.bind('Progress',function(e){self.result=runtime.exec.call(_fr,'FileReader','getResult');self.trigger(e);});_fr.bind('Load',function(e){self.readyState=FileReader.DONE;self.result=runtime.exec.call(_fr,'FileReader','getResult');self.trigger(e);loadEnd();});runtime.exec.call(_fr,'FileReader','read',op,blob);}
this.convertEventPropsToHandlers(dispatches);if(this.readyState===FileReader.LOADING){return error(new x.DOMException(x.DOMException.INVALID_STATE_ERR));}
this.readyState=FileReader.LOADING;this.trigger('loadstart');if(blob instanceof Blob){if(blob.isDetached()){var src=blob.getSource();switch(op){case'readAsText':case'readAsBinaryString':this.result=src;break;case'readAsDataURL':this.result='data:'+blob.type+';base64,'+Encode.btoa(src);break;}
this.readyState=FileReader.DONE;this.trigger('load');loadEnd();}else{exec(_fr.connectRuntime(blob.ruid));}}else{error(new x.DOMException(x.DOMException.NOT_FOUND_ERR));}}}
FileReader.EMPTY=0;FileReader.LOADING=1;FileReader.DONE=2;FileReader.prototype=EventTarget.instance;return FileReader;});define('moxie/core/utils/Url',[],function(){var parseUrl=function(url,currentUrl){var key=['source','scheme','authority','userInfo','user','pass','host','port','relative','path','directory','file','query','fragment'],i=key.length,ports={http:80,https:443},uri={},regex=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,m=regex.exec(url||'');while(i--){if(m[i]){uri[key[i]]=m[i];}}
if(!uri.scheme){if(!currentUrl||typeof(currentUrl)==='string'){currentUrl=parseUrl(currentUrl||document.location.href);}
uri.scheme=currentUrl.scheme;uri.host=currentUrl.host;uri.port=currentUrl.port;var path='';if(/^[^\/]/.test(uri.path)){path=currentUrl.path;if(!/(\/|\/[^\.]+)$/.test(path)){path=path.replace(/\/[^\/]+$/,'/');}else{path+='/';}}
uri.path=path+(uri.path||'');}
if(!uri.port){uri.port=ports[uri.scheme]||80;}
uri.port=parseInt(uri.port,10);if(!uri.path){uri.path="/";}
delete uri.source;return uri;};var resolveUrl=function(url){var ports={http:80,https:443},urlp=parseUrl(url);return urlp.scheme+'://'+urlp.host+(urlp.port!==ports[urlp.scheme]?':'+urlp.port:'')+urlp.path+(urlp.query?urlp.query:'');};var hasSameOrigin=function(url){function origin(url){return[url.scheme,url.host,url.port].join('/');}
if(typeof url==='string'){url=parseUrl(url);}
return origin(parseUrl())===origin(url);};return{parseUrl:parseUrl,resolveUrl:resolveUrl,hasSameOrigin:hasSameOrigin};});define('moxie/file/FileReaderSync',['moxie/core/utils/Basic','moxie/runtime/RuntimeClient','moxie/core/utils/Encode'],function(Basic,RuntimeClient,Encode){return function(){RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),readAsBinaryString:function(blob){return _read.call(this,'readAsBinaryString',blob);},readAsDataURL:function(blob){return _read.call(this,'readAsDataURL',blob);},readAsText:function(blob){return _read.call(this,'readAsText',blob);}});function _read(op,blob){if(blob.isDetached()){var src=blob.getSource();switch(op){case'readAsBinaryString':return src;case'readAsDataURL':return'data:'+blob.type+';base64,'+Encode.btoa(src);case'readAsText':var txt='';for(var i=0,length=src.length;i<length;i++){txt+=String.fromCharCode(src[i]);}
return txt;}}else{var result=this.connectRuntime(blob.ruid).exec.call(this,'FileReaderSync','read',op,blob);this.disconnectRuntime();return result;}}};});define("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(x,Basic,Blob){function FormData(){var _blob,_fields=[];Basic.extend(this,{append:function(name,value){var self=this,valueType=Basic.typeOf(value);if(value instanceof Blob){_blob={name:name,value:value};}else if('array'===valueType){name+='[]';Basic.each(value,function(value){self.append(name,value);});}else if('object'===valueType){Basic.each(value,function(value,key){self.append(name+'['+key+']',value);});}else if('null'===valueType||'undefined'===valueType||'number'===valueType&&isNaN(value)){self.append(name,"false");}else{_fields.push({name:name,value:value.toString()});}},hasBlob:function(){return!!this.getBlob();},getBlob:function(){return _blob&&_blob.value||null;},getBlobName:function(){return _blob&&_blob.name||null;},each:function(cb){Basic.each(_fields,function(field){cb(field.value,field.name);});if(_blob){cb(_blob.value,_blob.name);}},destroy:function(){_blob=null;_fields=[];}});}
return FormData;});define("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(Basic,x,EventTarget,Encode,Url,Runtime,RuntimeTarget,Blob,FileReaderSync,FormData,Env,Mime){var httpCode={100:'Continue',101:'Switching Protocols',102:'Processing',200:'OK',201:'Created',202:'Accepted',203:'Non-Authoritative Information',204:'No Content',205:'Reset Content',206:'Partial Content',207:'Multi-Status',226:'IM Used',300:'Multiple Choices',301:'Moved Permanently',302:'Found',303:'See Other',304:'Not Modified',305:'Use Proxy',306:'Reserved',307:'Temporary Redirect',400:'Bad Request',401:'Unauthorized',402:'Payment Required',403:'Forbidden',404:'Not Found',405:'Method Not Allowed',406:'Not Acceptable',407:'Proxy Authentication Required',408:'Request Timeout',409:'Conflict',410:'Gone',411:'Length Required',412:'Precondition Failed',413:'Request Entity Too Large',414:'Request-URI Too Long',415:'Unsupported Media Type',416:'Requested Range Not Satisfiable',417:'Expectation Failed',422:'Unprocessable Entity',423:'Locked',424:'Failed Dependency',426:'Upgrade Required',500:'Internal Server Error',501:'Not Implemented',502:'Bad Gateway',503:'Service Unavailable',504:'Gateway Timeout',505:'HTTP Version Not Supported',506:'Variant Also Negotiates',507:'Insufficient Storage',510:'Not Extended'};function XMLHttpRequestUpload(){this.uid=Basic.guid('uid_');}
XMLHttpRequestUpload.prototype=EventTarget.instance;var dispatches=['loadstart','progress','abort','error','load','timeout','loadend'];var NATIVE=1,RUNTIME=2;function XMLHttpRequest(){var self=this,props={timeout:0,readyState:XMLHttpRequest.UNSENT,withCredentials:false,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},_async=true,_url,_method,_headers={},_user,_password,_encoding=null,_mimeType=null,_sync_flag=false,_send_flag=false,_upload_events_flag=false,_upload_complete_flag=false,_error_flag=false,_same_origin_flag=false,_start_time,_timeoutset_time,_finalMime=null,_finalCharset=null,_options={},_xhr,_responseHeaders='',_responseHeadersBag;Basic.extend(this,props,{uid:Basic.guid('uid_'),upload:new XMLHttpRequestUpload(),open:function(method,url,async,user,password){var urlp;if(!method||!url){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
if(/[\u0100-\uffff]/.test(method)||Encode.utf8_encode(method)!==method){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
if(!!~Basic.inArray(method.toUpperCase(),['CONNECT','DELETE','GET','HEAD','OPTIONS','POST','PUT','TRACE','TRACK'])){_method=method.toUpperCase();}
if(!!~Basic.inArray(_method,['CONNECT','TRACE','TRACK'])){throw new x.DOMException(x.DOMException.SECURITY_ERR);}
url=Encode.utf8_encode(url);urlp=Url.parseUrl(url);_same_origin_flag=Url.hasSameOrigin(urlp);_url=Url.resolveUrl(url);if((user||password)&&!_same_origin_flag){throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);}
_user=user||urlp.user;_password=password||urlp.pass;_async=async||true;if(_async===false&&(_p('timeout')||_p('withCredentials')||_p('responseType')!=="")){throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);}
_sync_flag=!_async;_send_flag=false;_headers={};_reset.call(this);_p('readyState',XMLHttpRequest.OPENED);this.convertEventPropsToHandlers(['readystatechange']);this.dispatchEvent('readystatechange');},setRequestHeader:function(header,value){var uaHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(_p('readyState')!==XMLHttpRequest.OPENED||_send_flag){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(/[\u0100-\uffff]/.test(header)||Encode.utf8_encode(header)!==header){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
header=Basic.trim(header).toLowerCase();if(!!~Basic.inArray(header,uaHeaders)||/^(proxy\-|sec\-)/.test(header)){return false;}
if(!_headers[header]){_headers[header]=value;}else{_headers[header]+=', '+value;}
return true;},getAllResponseHeaders:function(){return _responseHeaders||'';},getResponseHeader:function(header){header=header.toLowerCase();if(_error_flag||!!~Basic.inArray(header,['set-cookie','set-cookie2'])){return null;}
if(_responseHeaders&&_responseHeaders!==''){if(!_responseHeadersBag){_responseHeadersBag={};Basic.each(_responseHeaders.split(/\r\n/),function(line){var pair=line.split(/:\s+/);if(pair.length===2){pair[0]=Basic.trim(pair[0]);_responseHeadersBag[pair[0].toLowerCase()]={header:pair[0],value:Basic.trim(pair[1])};}});}
if(_responseHeadersBag.hasOwnProperty(header)){return _responseHeadersBag[header].header+': '+_responseHeadersBag[header].value;}}
return null;},overrideMimeType:function(mime){var matches,charset;if(!!~Basic.inArray(_p('readyState'),[XMLHttpRequest.LOADING,XMLHttpRequest.DONE])){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
mime=Basic.trim(mime.toLowerCase());if(/;/.test(mime)&&(matches=mime.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){mime=matches[1];if(matches[2]){charset=matches[2];}}
if(!Mime.mimes[mime]){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
_finalMime=mime;_finalCharset=charset;},send:function(data,options){if(Basic.typeOf(options)==='string'){_options={ruid:options};}else if(!options){_options={};}else{_options=options;}
this.convertEventPropsToHandlers(dispatches);this.upload.convertEventPropsToHandlers(dispatches);if(this.readyState!==XMLHttpRequest.OPENED||_send_flag){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(data instanceof Blob){_options.ruid=data.ruid;_mimeType=data.type||'application/octet-stream';}
else if(data instanceof FormData){if(data.hasBlob()){var blob=data.getBlob();_options.ruid=blob.ruid;_mimeType=blob.type||'application/octet-stream';}}
else if(typeof data==='string'){_encoding='UTF-8';_mimeType='text/plain;charset=UTF-8';data=Encode.utf8_encode(data);}
if(!this.withCredentials){this.withCredentials=(_options.required_caps&&_options.required_caps.send_browser_cookies)&&!_same_origin_flag;}
_upload_events_flag=(!_sync_flag&&this.upload.hasEventListener());_error_flag=false;_upload_complete_flag=!data;if(!_sync_flag){_send_flag=true;}
_doXHR.call(this,data);},abort:function(){_error_flag=true;_sync_flag=false;if(!~Basic.inArray(_p('readyState'),[XMLHttpRequest.UNSENT,XMLHttpRequest.OPENED,XMLHttpRequest.DONE])){_p('readyState',XMLHttpRequest.DONE);_send_flag=false;if(_xhr){_xhr.getRuntime().exec.call(_xhr,'XMLHttpRequest','abort',_upload_complete_flag);}else{throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
_upload_complete_flag=true;}else{_p('readyState',XMLHttpRequest.UNSENT);}},destroy:function(){if(_xhr){if(Basic.typeOf(_xhr.destroy)==='function'){_xhr.destroy();}
_xhr=null;}
this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null;}}});function _p(prop,value){if(!props.hasOwnProperty(prop)){return;}
if(arguments.length===1){return Env.can('define_property')?props[prop]:self[prop];}else{if(Env.can('define_property')){props[prop]=value;}else{self[prop]=value;}}}
function _doXHR(data){var self=this;_start_time=new Date().getTime();_xhr=new RuntimeTarget();function loadEnd(){if(_xhr){_xhr.destroy();_xhr=null;}
self.dispatchEvent('loadend');self=null;}
function exec(runtime){_xhr.bind('LoadStart',function(e){_p('readyState',XMLHttpRequest.LOADING);self.dispatchEvent('readystatechange');self.dispatchEvent(e);if(_upload_events_flag){self.upload.dispatchEvent(e);}});_xhr.bind('Progress',function(e){if(_p('readyState')!==XMLHttpRequest.LOADING){_p('readyState',XMLHttpRequest.LOADING);self.dispatchEvent('readystatechange');}
self.dispatchEvent(e);});_xhr.bind('UploadProgress',function(e){if(_upload_events_flag){self.upload.dispatchEvent({type:'progress',lengthComputable:false,total:e.total,loaded:e.loaded});}});_xhr.bind('Load',function(e){_p('readyState',XMLHttpRequest.DONE);_p('status',Number(runtime.exec.call(_xhr,'XMLHttpRequest','getStatus')||0));_p('statusText',httpCode[_p('status')]||"");_p('response',runtime.exec.call(_xhr,'XMLHttpRequest','getResponse',_p('responseType')));if(!!~Basic.inArray(_p('responseType'),['text',''])){_p('responseText',_p('response'));}else if(_p('responseType')==='document'){_p('responseXML',_p('response'));}
_responseHeaders=runtime.exec.call(_xhr,'XMLHttpRequest','getAllResponseHeaders');self.dispatchEvent('readystatechange');if(_p('status')>0){if(_upload_events_flag){self.upload.dispatchEvent(e);}
self.dispatchEvent(e);}else{_error_flag=true;self.dispatchEvent('error');}
loadEnd();});_xhr.bind('Abort',function(e){self.dispatchEvent(e);loadEnd();});_xhr.bind('Error',function(e){_error_flag=true;_p('readyState',XMLHttpRequest.DONE);self.dispatchEvent('readystatechange');_upload_complete_flag=true;self.dispatchEvent(e);loadEnd();});runtime.exec.call(_xhr,'XMLHttpRequest','send',{url:_url,method:_method,async:_async,user:_user,password:_password,headers:_headers,mimeType:_mimeType,encoding:_encoding,responseType:self.responseType,withCredentials:self.withCredentials,options:_options},data);}
if(typeof(_options.required_caps)==='string'){_options.required_caps=Runtime.parseCaps(_options.required_caps);}
_options.required_caps=Basic.extend({},_options.required_caps,{return_response_type:self.responseType});if(data instanceof FormData){_options.required_caps.send_multipart=true;}
if(!_same_origin_flag){_options.required_caps.do_cors=true;}
if(_options.ruid){exec(_xhr.connectRuntime(_options));}else{_xhr.bind('RuntimeInit',function(e,runtime){exec(runtime);});_xhr.bind('RuntimeError',function(e,err){self.dispatchEvent('RuntimeError',err);});_xhr.connectRuntime(_options);}}
function _reset(){_p('responseText',"");_p('responseXML',null);_p('response',null);_p('status',0);_p('statusText',"");_start_time=_timeoutset_time=null;}}
XMLHttpRequest.UNSENT=0;XMLHttpRequest.OPENED=1;XMLHttpRequest.HEADERS_RECEIVED=2;XMLHttpRequest.LOADING=3;XMLHttpRequest.DONE=4;XMLHttpRequest.prototype=EventTarget.instance;return XMLHttpRequest;});define("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(Basic,Encode,RuntimeClient,EventTarget){function Transporter(){var mod,_runtime,_data,_size,_pos,_chunk_size;RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),state:Transporter.IDLE,result:null,transport:function(data,type,options){var self=this;options=Basic.extend({chunk_size:204798},options);if((mod=options.chunk_size%3)){options.chunk_size+=3-mod;}
_chunk_size=options.chunk_size;_reset.call(this);_data=data;_size=data.length;if(Basic.typeOf(options)==='string'||options.ruid){_run.call(self,type,this.connectRuntime(options));}else{var cb=function(e,runtime){self.unbind("RuntimeInit",cb);_run.call(self,type,runtime);};this.bind("RuntimeInit",cb);this.connectRuntime(options);}},abort:function(){var self=this;self.state=Transporter.IDLE;if(_runtime){_runtime.exec.call(self,'Transporter','clear');self.trigger("TransportingAborted");}
_reset.call(self);},destroy:function(){this.unbindAll();_runtime=null;this.disconnectRuntime();_reset.call(this);}});function _reset(){_size=_pos=0;_data=this.result=null;}
function _run(type,runtime){var self=this;_runtime=runtime;self.bind("TransportingProgress",function(e){_pos=e.loaded;if(_pos<_size&&Basic.inArray(self.state,[Transporter.IDLE,Transporter.DONE])===-1){_transport.call(self);}},999);self.bind("TransportingComplete",function(){_pos=_size;self.state=Transporter.DONE;_data=null;self.result=_runtime.exec.call(self,'Transporter','getAsBlob',type||'');},999);self.state=Transporter.BUSY;self.trigger("TransportingStarted");_transport.call(self);}
function _transport(){var self=this,chunk,bytesLeft=_size-_pos;if(_chunk_size>bytesLeft){_chunk_size=bytesLeft;}
chunk=Encode.btoa(_data.substr(_pos,_chunk_size));_runtime.exec.call(self,'Transporter','receive',chunk,_size);}}
Transporter.IDLE=0;Transporter.BUSY=1;Transporter.DONE=2;Transporter.prototype=EventTarget.instance;return Transporter;});define("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(Basic,Dom,x,FileReaderSync,XMLHttpRequest,Runtime,RuntimeClient,Transporter,Env,EventTarget,Blob,File,Encode){var dispatches=['progress','load','error','resize','embedded'];function Image(){RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments);},load:function(){this.bind('Load Resize',function(){_updateInfo.call(this);},999);this.convertEventPropsToHandlers(dispatches);_load.apply(this,arguments);},downsize:function(opts){var defaults={width:this.width,height:this.height,crop:false,preserveHeaders:true};if(typeof(opts)==='object'){opts=Basic.extend(defaults,opts);}else{opts=Basic.extend(defaults,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});}
try{if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT){throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);}
this.getRuntime().exec.call(this,'Image','downsize',opts.width,opts.height,opts.crop,opts.preserveHeaders);}catch(ex){this.trigger('error',ex.code);}},crop:function(width,height,preserveHeaders){this.downsize(width,height,true,preserveHeaders);},getAsCanvas:function(){if(!Env.can('create_canvas')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}
var runtime=this.connectRuntime(this.ruid);return runtime.exec.call(this,'Image','getAsCanvas');},getAsBlob:function(type,quality){if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(!type){type='image/jpeg';}
if(type==='image/jpeg'&&!quality){quality=90;}
return this.getRuntime().exec.call(this,'Image','getAsBlob',type,quality);},getAsDataURL:function(type,quality){if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
return this.getRuntime().exec.call(this,'Image','getAsDataURL',type,quality);},getAsBinaryString:function(type,quality){var dataUrl=this.getAsDataURL(type,quality);return Encode.atob(dataUrl.substring(dataUrl.indexOf('base64,')+7));},embed:function(el){var self=this,imgCopy,type,quality,crop,options=arguments[1]||{},width=this.width,height=this.height,runtime;function onResize(){if(Env.can('create_canvas')){var canvas=imgCopy.getAsCanvas();if(canvas){el.appendChild(canvas);canvas=null;imgCopy.destroy();self.trigger('embedded');return;}}
var dataUrl=imgCopy.getAsDataURL(type,quality);if(!dataUrl){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}
if(Env.can('use_data_uri_of',dataUrl.length)){el.innerHTML='<img src="'+dataUrl+'" width="'+imgCopy.width+'" height="'+imgCopy.height+'" />';imgCopy.destroy();self.trigger('embedded');}else{var tr=new Transporter();tr.bind("TransportingComplete",function(){runtime=self.connectRuntime(this.result.ruid);self.bind("Embedded",function(){Basic.extend(runtime.getShimContainer().style,{top:'0px',left:'0px',width:imgCopy.width+'px',height:imgCopy.height+'px'});runtime=null;},999);runtime.exec.call(self,"ImageView","display",this.result.uid,width,height);imgCopy.destroy();});tr.transport(Encode.atob(dataUrl.substring(dataUrl.indexOf('base64,')+7)),type,Basic.extend({},options,{required_caps:{display_media:true},runtime_order:'flash,silverlight',container:el}));}}
try{if(!(el=Dom.get(el))){throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);}
if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT){throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);}
type=options.type||this.type||'image/jpeg';quality=options.quality||90;crop=Basic.typeOf(options.crop)!=='undefined'?options.crop:false;if(options.width){width=options.width;height=options.height||width;}else{var dimensions=Dom.getSize(el);if(dimensions.w&&dimensions.h){width=dimensions.w;height=dimensions.h;}}
imgCopy=new Image();imgCopy.bind("Resize",function(){onResize.call(self);});imgCopy.bind("Load",function(){imgCopy.downsize(width,height,crop,false);});imgCopy.clone(this,false);return imgCopy;}catch(ex){this.trigger('error',ex.code);}},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,'Image','destroy');this.disconnectRuntime();}
this.unbindAll();}});function _updateInfo(info){if(!info){info=this.getRuntime().exec.call(this,'Image','getInfo');}
this.size=info.size;this.width=info.width;this.height=info.height;this.type=info.type;this.meta=info.meta;if(this.name===''){this.name=info.name;}}
function _load(src){var srcType=Basic.typeOf(src);try{if(src instanceof Image){if(!src.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
_loadFromImage.apply(this,arguments);}
else if(src instanceof Blob){if(!~Basic.inArray(src.type,['image/jpeg','image/png'])){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}
_loadFromBlob.apply(this,arguments);}
else if(Basic.inArray(srcType,['blob','file'])!==-1){_load.call(this,new File(null,src),arguments[1]);}
else if(srcType==='string'){if(/^data:[^;]*;base64,/.test(src)){_load.call(this,new Blob(null,{data:src}),arguments[1]);}
else{_loadFromUrl.apply(this,arguments);}}
else if(srcType==='node'&&src.nodeName.toLowerCase()==='img'){_load.call(this,src.src,arguments[1]);}
else{throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);}}catch(ex){this.trigger('error',ex.code);}}
function _loadFromImage(img,exact){var runtime=this.connectRuntime(img.ruid);this.ruid=runtime.uid;runtime.exec.call(this,'Image','loadFromImage',img,(Basic.typeOf(exact)==='undefined'?true:exact));}
function _loadFromBlob(blob,options){var self=this;self.name=blob.name||'';function exec(runtime){self.ruid=runtime.uid;runtime.exec.call(self,'Image','loadFromBlob',blob);}
if(blob.isDetached()){this.bind('RuntimeInit',function(e,runtime){exec(runtime);});if(options&&typeof(options.required_caps)==='string'){options.required_caps=Runtime.parseCaps(options.required_caps);}
this.connectRuntime(Basic.extend({required_caps:{access_image_binary:true,resize_image:true}},options));}else{exec(this.connectRuntime(blob.ruid));}}
function _loadFromUrl(url,options){var self=this,xhr;xhr=new XMLHttpRequest();xhr.open('get',url);xhr.responseType='blob';xhr.onprogress=function(e){self.trigger(e);};xhr.onload=function(){_loadFromBlob.call(self,xhr.response,true);};xhr.onerror=function(e){self.trigger(e);};xhr.onloadend=function(){xhr.destroy();};xhr.bind('RuntimeError',function(e,err){self.trigger('RuntimeError',err);});xhr.send(null,options);}}
Image.MAX_RESIZE_WIDTH=6500;Image.MAX_RESIZE_HEIGHT=6500;Image.prototype=EventTarget.instance;return Image;});define("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){var type="html5",extensions={};function Html5Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;var caps=Basic.extend({access_binary:Test(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return I.can('access_binary')&&!!extensions.Image;},display_media:Test(Env.can('create_canvas')||Env.can('use_data_uri_over32kb')),do_cors:Test(window.XMLHttpRequest&&'withCredentials'in new XMLHttpRequest()),drag_and_drop:Test(function(){var div=document.createElement('div');return(('draggable'in div)||('ondragstart'in div&&'ondrop'in div))&&(Env.browser!=='IE'||Env.version>9);}()),filter_by_extension:Test(function(){return(Env.browser==='Chrome'&&Env.version>=28)||(Env.browser==='IE'&&Env.version>=10);}()),return_response_headers:True,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true;}
return Env.can('return_response_type',responseType);},return_status_code:True,report_upload_progress:Test(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function(){return I.can('access_binary')&&Env.can('create_canvas');},select_file:function(){return Env.can('use_fileinput')&&window.File;},select_folder:function(){return I.can('select_file')&&Env.browser==='Chrome'&&Env.version>=21;},select_multiple:function(){return I.can('select_file')&&!(Env.browser==='Safari'&&Env.os==='Windows')&&!(Env.os==='iOS'&&Env.verComp(Env.osVersion,"7.0.4",'<'));},send_binary_string:Test(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||(window.Uint8Array&&window.ArrayBuffer))),send_custom_headers:Test(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||I.can('send_binary_string');},slice_blob:Test(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return I.can('slice_blob')&&I.can('send_multipart');},summon_file_dialog:Test(function(){return(Env.browser==='Firefox'&&Env.version>=4)||(Env.browser==='Opera'&&Env.version>=12)||(Env.browser==='IE'&&Env.version>=10)||!!~Basic.inArray(Env.browser,['Chrome','Safari']);}()),upload_filesize:True},arguments[2]);Runtime.call(this,options,(arguments[1]||type),caps);Basic.extend(this,{init:function(){this.trigger("Init");},destroy:(function(destroy){return function(){destroy.call(I);destroy=I=null;};}(this.destroy))});Basic.extend(this.getShim(),extensions);}
Runtime.addConstructor(type,Html5Runtime);return extensions;});define("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(extensions,Blob){function HTML5Blob(){function w3cBlobSlice(blob,start,end){var blobSlice;if(window.File.prototype.slice){try{blob.slice();return blob.slice(start,end);}catch(e){return blob.slice(start,end-start);}}else if((blobSlice=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)){return blobSlice.call(blob,start,end);}else{return null;}}
this.slice=function(){return new Blob(this.getRuntime().uid,w3cBlobSlice.apply(this,arguments));};}
return(extensions.Blob=HTML5Blob);});define('moxie/core/utils/Events',['moxie/core/utils/Basic'],function(Basic){var eventhash={},uid='moxie_'+Basic.guid();function preventDefault(){this.returnValue=false;}
function stopPropagation(){this.cancelBubble=true;}
var addEvent=function(obj,name,callback,key){var func,events;name=name.toLowerCase();if(obj.addEventListener){func=callback;obj.addEventListener(name,func,false);}else if(obj.attachEvent){func=function(){var evt=window.event;if(!evt.target){evt.target=evt.srcElement;}
evt.preventDefault=preventDefault;evt.stopPropagation=stopPropagation;callback(evt);};obj.attachEvent('on'+name,func);}
if(!obj[uid]){obj[uid]=Basic.guid();}
if(!eventhash.hasOwnProperty(obj[uid])){eventhash[obj[uid]]={};}
events=eventhash[obj[uid]];if(!events.hasOwnProperty(name)){events[name]=[];}
events[name].push({func:func,orig:callback,key:key});};var removeEvent=function(obj,name,callback){var type,undef;name=name.toLowerCase();if(obj[uid]&&eventhash[obj[uid]]&&eventhash[obj[uid]][name]){type=eventhash[obj[uid]][name];}else{return;}
for(var i=type.length-1;i>=0;i--){if(type[i].orig===callback||type[i].key===callback){if(obj.removeEventListener){obj.removeEventListener(name,type[i].func,false);}else if(obj.detachEvent){obj.detachEvent('on'+name,type[i].func);}
type[i].orig=null;type[i].func=null;type.splice(i,1);if(callback!==undef){break;}}}
if(!type.length){delete eventhash[obj[uid]][name];}
if(Basic.isEmptyObj(eventhash[obj[uid]])){delete eventhash[obj[uid]];try{delete obj[uid];}catch(e){obj[uid]=undef;}}};var removeAllEvents=function(obj,key){if(!obj||!obj[uid]){return;}
Basic.each(eventhash[obj[uid]],function(events,name){removeEvent(obj,name,key);});};return{addEvent:addEvent,removeEvent:removeEvent,removeAllEvents:removeAllEvents};});define("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _files=[],_options;Basic.extend(this,{init:function(options){var comp=this,I=comp.getRuntime(),input,shimContainer,mimes,browseButton,zIndex,top;_options=options;_files=[];mimes=_options.accept.mimes||Mime.extList2mimes(_options.accept,I.can('filter_by_extension'));shimContainer=I.getShimContainer();shimContainer.innerHTML='<input id="'+I.uid+'" type="file" style="font-size:999px;opacity:0;"'+
(_options.multiple&&I.can('select_multiple')?'multiple':'')+
(_options.directory&&I.can('select_folder')?'webkitdirectory directory':'')+
(mimes?' accept="'+mimes.join(',')+'"':'')+' />';input=Dom.get(I.uid);Basic.extend(input.style,{position:'absolute',top:0,left:0,width:'100%',height:'100%'});browseButton=Dom.get(_options.browse_button);if(I.can('summon_file_dialog')){if(Dom.getStyle(browseButton,'position')==='static'){browseButton.style.position='relative';}
zIndex=parseInt(Dom.getStyle(browseButton,'z-index'),10)||1;browseButton.style.zIndex=zIndex;shimContainer.style.zIndex=zIndex-1;Events.addEvent(browseButton,'click',function(e){var input=Dom.get(I.uid);if(input&&!input.disabled){input.click();}
e.preventDefault();},comp.uid);}
top=I.can('summon_file_dialog')?browseButton:shimContainer;Events.addEvent(top,'mouseover',function(){comp.trigger('mouseenter');},comp.uid);Events.addEvent(top,'mouseout',function(){comp.trigger('mouseleave');},comp.uid);Events.addEvent(top,'mousedown',function(){comp.trigger('mousedown');},comp.uid);Events.addEvent(Dom.get(_options.container),'mouseup',function(){comp.trigger('mouseup');},comp.uid);input.onchange=function onChange(){_files=[];if(_options.directory){Basic.each(this.files,function(file){if(file.name!=="."){_files.push(file);}});}else{_files=[].slice.call(this.files);}
if(Env.browser!=='IE'&&Env.browser!=='IEMobile'){this.value='';}else{var clone=this.cloneNode(true);this.parentNode.replaceChild(clone,this);clone.onchange=onChange;}
comp.trigger('change');};comp.trigger({type:'ready',async:true});shimContainer=null;},getFiles:function(){return _files;},disable:function(state){var I=this.getRuntime(),input;if((input=Dom.get(I.uid))){input.disabled=!!state;}},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid);Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid);if(shimContainer){shimContainer.innerHTML='';}
shim.removeInstance(this.uid);_files=_options=shimContainer=shim=null;}});}
return(extensions.FileInput=FileInput);});define("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(extensions,Basic,Dom,Events,Mime){function FileDrop(){var _files=[],_allowedExts=[],_options;Basic.extend(this,{init:function(options){var comp=this,dropZone;_options=options;_allowedExts=_extractExts(_options.accept);dropZone=_options.container;Events.addEvent(dropZone,'dragover',function(e){if(!_hasFiles(e)){return;}
e.preventDefault();e.dataTransfer.dropEffect='copy';},comp.uid);Events.addEvent(dropZone,'drop',function(e){if(!_hasFiles(e)){return;}
e.preventDefault();_files=[];if(e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry){_readItems(e.dataTransfer.items,function(){comp.trigger("drop");});}else{Basic.each(e.dataTransfer.files,function(file){if(_isAcceptable(file)){_files.push(file);}});comp.trigger("drop");}},comp.uid);Events.addEvent(dropZone,'dragenter',function(e){comp.trigger("dragenter");},comp.uid);Events.addEvent(dropZone,'dragleave',function(e){comp.trigger("dragleave");},comp.uid);},getFiles:function(){return _files;},destroy:function(){Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);_files=_allowedExts=_options=null;}});function _hasFiles(e){if(!e.dataTransfer||!e.dataTransfer.types){return false;}
var types=Basic.toArray(e.dataTransfer.types||[]);return Basic.inArray("Files",types)!==-1||Basic.inArray("public.file-url",types)!==-1||Basic.inArray("application/x-moz-file",types)!==-1;}
function _extractExts(accept){var exts=[];for(var i=0;i<accept.length;i++){[].push.apply(exts,accept[i].extensions.split(/\s*,\s*/));}
return Basic.inArray('*',exts)===-1?exts:[];}
function _isAcceptable(file){if(!_allowedExts.length){return true;}
var ext=Mime.getFileExtension(file.name);return!ext||Basic.inArray(ext,_allowedExts)!==-1;}
function _readItems(items,cb){var entries=[];Basic.each(items,function(item){var entry=item.webkitGetAsEntry();if(entry){if(entry.isFile){var file=item.getAsFile();if(_isAcceptable(file)){_files.push(file);}}else{entries.push(entry);}}});if(entries.length){_readEntries(entries,cb);}else{cb();}}
function _readEntries(entries,cb){var queue=[];Basic.each(entries,function(entry){queue.push(function(cbcb){_readEntry(entry,cbcb);});});Basic.inSeries(queue,function(){cb();});}
function _readEntry(entry,cb){if(entry.isFile){entry.file(function(file){if(_isAcceptable(file)){_files.push(file);}
cb();},function(){cb();});}else if(entry.isDirectory){_readDirEntry(entry,cb);}else{cb();}}
function _readDirEntry(dirEntry,cb){var entries=[],dirReader=dirEntry.createReader();function getEntries(cbcb){dirReader.readEntries(function(moreEntries){if(moreEntries.length){[].push.apply(entries,moreEntries);getEntries(cbcb);}else{cbcb();}},cbcb);}
getEntries(function(){_readEntries(entries,cb);});}}
return(extensions.FileDrop=FileDrop);});define("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(extensions,Encode,Basic){function FileReader(){var _fr,_convertToBinary=false;Basic.extend(this,{read:function(op,blob){var target=this;_fr=new window.FileReader();_fr.addEventListener('progress',function(e){target.trigger(e);});_fr.addEventListener('load',function(e){target.trigger(e);});_fr.addEventListener('error',function(e){target.trigger(e,_fr.error);});_fr.addEventListener('loadend',function(){_fr=null;});if(Basic.typeOf(_fr[op])==='function'){_convertToBinary=false;_fr[op](blob.getSource());}else if(op==='readAsBinaryString'){_convertToBinary=true;_fr.readAsDataURL(blob.getSource());}},getResult:function(){return _fr&&_fr.result?(_convertToBinary?_toBinary(_fr.result):_fr.result):null;},abort:function(){if(_fr){_fr.abort();}},destroy:function(){_fr=null;}});function _toBinary(str){return Encode.atob(str.substring(str.indexOf('base64,')+7));}}
return(extensions.FileReader=FileReader);});define("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(extensions,Basic,Mime,Url,File,Blob,FormData,x,Env){function XMLHttpRequest(){var self=this,_xhr,_filename;Basic.extend(this,{send:function(meta,data){var target=this,isGecko2_5_6=(Env.browser==='Mozilla'&&Env.version>=4&&Env.version<7),isAndroidBrowser=Env.browser==='Android Browser',mustSendAsBinary=false;_filename=meta.url.replace(/^.+?\/([\w\-\.]+)$/,'$1').toLowerCase();_xhr=_getNativeXHR();_xhr.open(meta.method,meta.url,meta.async,meta.user,meta.password);if(data instanceof Blob){if(data.isDetached()){mustSendAsBinary=true;}
data=data.getSource();}else if(data instanceof FormData){if(data.hasBlob()){if(data.getBlob().isDetached()){data=_prepareMultipart.call(target,data);mustSendAsBinary=true;}else if((isGecko2_5_6||isAndroidBrowser)&&Basic.typeOf(data.getBlob().getSource())==='blob'&&window.FileReader){_preloadAndSend.call(target,meta,data);return;}}
if(data instanceof FormData){var fd=new window.FormData();data.each(function(value,name){if(value instanceof Blob){fd.append(name,value.getSource());}else{fd.append(name,value);}});data=fd;}}
if(_xhr.upload){if(meta.withCredentials){_xhr.withCredentials=true;}
_xhr.addEventListener('load',function(e){target.trigger(e);});_xhr.addEventListener('error',function(e){target.trigger(e);});_xhr.addEventListener('progress',function(e){target.trigger(e);});_xhr.upload.addEventListener('progress',function(e){target.trigger({type:'UploadProgress',loaded:e.loaded,total:e.total});});}else{_xhr.onreadystatechange=function onReadyStateChange(){switch(_xhr.readyState){case 1:break;case 2:break;case 3:var total,loaded;try{if(Url.hasSameOrigin(meta.url)){total=_xhr.getResponseHeader('Content-Length')||0;}
if(_xhr.responseText){loaded=_xhr.responseText.length;}}catch(ex){total=loaded=0;}
target.trigger({type:'progress',lengthComputable:!!total,total:parseInt(total,10),loaded:loaded});break;case 4:_xhr.onreadystatechange=function(){};if(_xhr.status===0){target.trigger('error');}else{target.trigger('load');}
break;}};}
if(!Basic.isEmptyObj(meta.headers)){Basic.each(meta.headers,function(value,header){_xhr.setRequestHeader(header,value);});}
if(""!==meta.responseType&&'responseType'in _xhr){if('json'===meta.responseType&&!Env.can('return_response_type','json')){_xhr.responseType='text';}else{_xhr.responseType=meta.responseType;}}
if(!mustSendAsBinary){_xhr.send(data);}else{if(_xhr.sendAsBinary){_xhr.sendAsBinary(data);}else{(function(){var ui8a=new Uint8Array(data.length);for(var i=0;i<data.length;i++){ui8a[i]=(data.charCodeAt(i)&0xff);}
_xhr.send(ui8a.buffer);}());}}
target.trigger('loadstart');},getStatus:function(){try{if(_xhr){return _xhr.status;}}catch(ex){}
return 0;},getResponse:function(responseType){var I=this.getRuntime();try{switch(responseType){case'blob':var file=new File(I.uid,_xhr.response);var disposition=_xhr.getResponseHeader('Content-Disposition');if(disposition){var match=disposition.match(/filename=([\'\"'])([^\1]+)\1/);if(match){_filename=match[2];}}
file.name=_filename;if(!file.type){file.type=Mime.getFileMime(_filename);}
return file;case'json':if(!Env.can('return_response_type','json')){return _xhr.status===200&&!!window.JSON?JSON.parse(_xhr.responseText):null;}
return _xhr.response;case'document':return _getDocument(_xhr);default:return _xhr.responseText!==''?_xhr.responseText:null;}}catch(ex){return null;}},getAllResponseHeaders:function(){try{return _xhr.getAllResponseHeaders();}catch(ex){}
return'';},abort:function(){if(_xhr){_xhr.abort();}},destroy:function(){self=_filename=null;}});function _preloadAndSend(meta,data){var target=this,blob,fr;blob=data.getBlob().getSource();fr=new window.FileReader();fr.onload=function(){data.append(data.getBlobName(),new Blob(null,{type:blob.type,data:fr.result}));self.send.call(target,meta,data);};fr.readAsBinaryString(blob);}
function _getNativeXHR(){if(window.XMLHttpRequest&&!(Env.browser==='IE'&&Env.version<8)){return new window.XMLHttpRequest();}else{return(function(){var progIDs=['Msxml2.XMLHTTP.6.0','Microsoft.XMLHTTP'];for(var i=0;i<progIDs.length;i++){try{return new ActiveXObject(progIDs[i]);}catch(ex){}}})();}}
function _getDocument(xhr){var rXML=xhr.responseXML;var rText=xhr.responseText;if(Env.browser==='IE'&&rText&&rXML&&!rXML.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(xhr.getResponseHeader("Content-Type"))){rXML=new window.ActiveXObject("Microsoft.XMLDOM");rXML.async=false;rXML.validateOnParse=false;rXML.loadXML(rText);}
if(rXML){if((Env.browser==='IE'&&rXML.parseError!==0)||!rXML.documentElement||rXML.documentElement.tagName==="parsererror"){return null;}}
return rXML;}
function _prepareMultipart(fd){var boundary='----moxieboundary'+new Date().getTime(),dashdash='--',crlf='\r\n',multipart='',I=this.getRuntime();if(!I.can('send_binary_string')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}
_xhr.setRequestHeader('Content-Type','multipart/form-data; boundary='+boundary);fd.each(function(value,name){if(value instanceof Blob){multipart+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"; filename="'+unescape(encodeURIComponent(value.name||'blob'))+'"'+crlf+'Content-Type: '+(value.type||'application/octet-stream')+crlf+crlf+
value.getSource()+crlf;}else{multipart+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"'+crlf+crlf+
unescape(encodeURIComponent(value))+crlf;}});multipart+=dashdash+boundary+dashdash+crlf;return multipart;}}
return(extensions.XMLHttpRequest=XMLHttpRequest);});define("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){var II=false,bin;function read(idx,size){var mv=II?0:-8*(size-1),sum=0,i;for(i=0;i<size;i++){sum|=(bin.charCodeAt(idx+i)<<Math.abs(mv+i*8));}
return sum;}
function putstr(segment,idx,length){length=arguments.length===3?length:bin.length-idx-1;bin=bin.substr(0,idx)+segment+bin.substr(length+idx);}
function write(idx,num,size){var str='',mv=II?0:-8*(size-1),i;for(i=0;i<size;i++){str+=String.fromCharCode((num>>Math.abs(mv+i*8))&255);}
putstr(str,idx,size);}
return{II:function(order){if(order===undefined){return II;}else{II=order;}},init:function(binData){II=false;bin=binData;},SEGMENT:function(idx,length,segment){switch(arguments.length){case 1:return bin.substr(idx,bin.length-idx-1);case 2:return bin.substr(idx,length);case 3:putstr(segment,idx,length);break;default:return bin;}},BYTE:function(idx){return read(idx,1);},SHORT:function(idx){return read(idx,2);},LONG:function(idx,num){if(num===undefined){return read(idx,4);}else{write(idx,num,4);}},SLONG:function(idx){var num=read(idx,4);return(num>2147483647?num-4294967296:num);},STRING:function(idx,size){var str='';for(size+=idx;idx<size;idx++){str+=String.fromCharCode(read(idx,1));}
return str;}};};});define("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(BinaryReader){return function JPEGHeaders(data){var headers=[],read,idx,marker,length=0;read=new BinaryReader();read.init(data);if(read.SHORT(0)!==0xFFD8){return;}
idx=2;while(idx<=data.length){marker=read.SHORT(idx);if(marker>=0xFFD0&&marker<=0xFFD7){idx+=2;continue;}
if(marker===0xFFDA||marker===0xFFD9){break;}
length=read.SHORT(idx+2)+2;if(marker>=0xFFE1&&marker<=0xFFEF){headers.push({hex:marker,name:'APP'+(marker&0x000F),start:idx,length:length,segment:read.SEGMENT(idx,length)});}
idx+=length;}
read.init(null);return{headers:headers,restore:function(data){var max,i;read.init(data);idx=read.SHORT(2)==0xFFE0?4+read.SHORT(4):2;for(i=0,max=headers.length;i<max;i++){read.SEGMENT(idx,0,headers[i].segment);idx+=headers[i].length;}
data=read.SEGMENT();read.init(null);return data;},strip:function(data){var headers,jpegHeaders,i;jpegHeaders=new JPEGHeaders(data);headers=jpegHeaders.headers;jpegHeaders.purge();read.init(data);i=headers.length;while(i--){read.SEGMENT(headers[i].start,headers[i].length,'');}
data=read.SEGMENT();read.init(null);return data;},get:function(name){var array=[];for(var i=0,max=headers.length;i<max;i++){if(headers[i].name===name.toUpperCase()){array.push(headers[i].segment);}}
return array;},set:function(name,segment){var array=[],i,ii,max;if(typeof(segment)==='string'){array.push(segment);}else{array=segment;}
for(i=ii=0,max=headers.length;i<max;i++){if(headers[i].name===name.toUpperCase()){headers[i].segment=array[ii];headers[i].length=array[ii].length;ii++;}
if(ii>=array.length){break;}}},purge:function(){headers=[];read.init(null);read=null;}};};});define("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(Basic,BinaryReader){return function ExifParser(){var data,tags,Tiff,offsets={},tagDescs;data=new BinaryReader();tags={tiff:{0x0112:'Orientation',0x010E:'ImageDescription',0x010F:'Make',0x0110:'Model',0x0131:'Software',0x8769:'ExifIFDPointer',0x8825:'GPSInfoIFDPointer'},exif:{0x9000:'ExifVersion',0xA001:'ColorSpace',0xA002:'PixelXDimension',0xA003:'PixelYDimension',0x9003:'DateTimeOriginal',0x829A:'ExposureTime',0x829D:'FNumber',0x8827:'ISOSpeedRatings',0x9201:'ShutterSpeedValue',0x9202:'ApertureValue',0x9207:'MeteringMode',0x9208:'LightSource',0x9209:'Flash',0x920A:'FocalLength',0xA402:'ExposureMode',0xA403:'WhiteBalance',0xA406:'SceneCaptureType',0xA404:'DigitalZoomRatio',0xA408:'Contrast',0xA409:'Saturation',0xA40A:'Sharpness'},gps:{0x0000:'GPSVersionID',0x0001:'GPSLatitudeRef',0x0002:'GPSLatitude',0x0003:'GPSLongitudeRef',0x0004:'GPSLongitude'}};tagDescs={'ColorSpace':{1:'sRGB',0:'Uncalibrated'},'MeteringMode':{0:'Unknown',1:'Average',2:'CenterWeightedAverage',3:'Spot',4:'MultiSpot',5:'Pattern',6:'Partial',255:'Other'},'LightSource':{1:'Daylight',2:'Fliorescent',3:'Tungsten',4:'Flash',9:'Fine weather',10:'Cloudy weather',11:'Shade',12:'Daylight fluorescent (D 5700 - 7100K)',13:'Day white fluorescent (N 4600 -5400K)',14:'Cool white fluorescent (W 3900 - 4500K)',15:'White fluorescent (WW 3200 - 3700K)',17:'Standard light A',18:'Standard light B',19:'Standard light C',20:'D55',21:'D65',22:'D75',23:'D50',24:'ISO studio tungsten',255:'Other'},'Flash':{0x0000:'Flash did not fire.',0x0001:'Flash fired.',0x0005:'Strobe return light not detected.',0x0007:'Strobe return light detected.',0x0009:'Flash fired, compulsory flash mode',0x000D:'Flash fired, compulsory flash mode, return light not detected',0x000F:'Flash fired, compulsory flash mode, return light detected',0x0010:'Flash did not fire, compulsory flash mode',0x0018:'Flash did not fire, auto mode',0x0019:'Flash fired, auto mode',0x001D:'Flash fired, auto mode, return light not detected',0x001F:'Flash fired, auto mode, return light detected',0x0020:'No flash function',0x0041:'Flash fired, red-eye reduction mode',0x0045:'Flash fired, red-eye reduction mode, return light not detected',0x0047:'Flash fired, red-eye reduction mode, return light detected',0x0049:'Flash fired, compulsory flash mode, red-eye reduction mode',0x004D:'Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected',0x004F:'Flash fired, compulsory flash mode, red-eye reduction mode, return light detected',0x0059:'Flash fired, auto mode, red-eye reduction mode',0x005D:'Flash fired, auto mode, return light not detected, red-eye reduction mode',0x005F:'Flash fired, auto mode, return light detected, red-eye reduction mode'},'ExposureMode':{0:'Auto exposure',1:'Manual exposure',2:'Auto bracket'},'WhiteBalance':{0:'Auto white balance',1:'Manual white balance'},'SceneCaptureType':{0:'Standard',1:'Landscape',2:'Portrait',3:'Night scene'},'Contrast':{0:'Normal',1:'Soft',2:'Hard'},'Saturation':{0:'Normal',1:'Low saturation',2:'High saturation'},'Sharpness':{0:'Normal',1:'Soft',2:'Hard'},'GPSLatitudeRef':{N:'North latitude',S:'South latitude'},'GPSLongitudeRef':{E:'East longitude',W:'West longitude'}};function extractTags(IFD_offset,tags2extract){var length=data.SHORT(IFD_offset),i,ii,tag,type,count,tagOffset,offset,value,values=[],hash={};for(i=0;i<length;i++){offset=tagOffset=IFD_offset+12*i+2;tag=tags2extract[data.SHORT(offset)];if(tag===undefined){continue;}
type=data.SHORT(offset+=2);count=data.LONG(offset+=2);offset+=4;values=[];switch(type){case 1:case 7:if(count>4){offset=data.LONG(offset)+offsets.tiffHeader;}
for(ii=0;ii<count;ii++){values[ii]=data.BYTE(offset+ii);}
break;case 2:if(count>4){offset=data.LONG(offset)+offsets.tiffHeader;}
hash[tag]=data.STRING(offset,count-1);continue;case 3:if(count>2){offset=data.LONG(offset)+offsets.tiffHeader;}
for(ii=0;ii<count;ii++){values[ii]=data.SHORT(offset+ii*2);}
break;case 4:if(count>1){offset=data.LONG(offset)+offsets.tiffHeader;}
for(ii=0;ii<count;ii++){values[ii]=data.LONG(offset+ii*4);}
break;case 5:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.LONG(offset+ii*4)/data.LONG(offset+ii*4+4);}
break;case 9:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.SLONG(offset+ii*4);}
break;case 10:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.SLONG(offset+ii*4)/data.SLONG(offset+ii*4+4);}
break;default:continue;}
value=(count==1?values[0]:values);if(tagDescs.hasOwnProperty(tag)&&typeof value!='object'){hash[tag]=tagDescs[tag][value];}else{hash[tag]=value;}}
return hash;}
function getIFDOffsets(){var idx=offsets.tiffHeader;data.II(data.SHORT(idx)==0x4949);if(data.SHORT(idx+=2)!==0x002A){return false;}
offsets.IFD0=offsets.tiffHeader+data.LONG(idx+=2);Tiff=extractTags(offsets.IFD0,tags.tiff);if('ExifIFDPointer'in Tiff){offsets.exifIFD=offsets.tiffHeader+Tiff.ExifIFDPointer;delete Tiff.ExifIFDPointer;}
if('GPSInfoIFDPointer'in Tiff){offsets.gpsIFD=offsets.tiffHeader+Tiff.GPSInfoIFDPointer;delete Tiff.GPSInfoIFDPointer;}
return true;}
function setTag(ifd,tag,value){var offset,length,tagOffset,valueOffset=0;if(typeof(tag)==='string'){var tmpTags=tags[ifd.toLowerCase()];for(var hex in tmpTags){if(tmpTags[hex]===tag){tag=hex;break;}}}
offset=offsets[ifd.toLowerCase()+'IFD'];length=data.SHORT(offset);for(var i=0;i<length;i++){tagOffset=offset+12*i+2;if(data.SHORT(tagOffset)==tag){valueOffset=tagOffset+8;break;}}
if(!valueOffset){return false;}
data.LONG(valueOffset,value);return true;}
return{init:function(segment){offsets={tiffHeader:10};if(segment===undefined||!segment.length){return false;}
data.init(segment);if(data.SHORT(0)===0xFFE1&&data.STRING(4,5).toUpperCase()==="EXIF\0"){return getIFDOffsets();}
return false;},TIFF:function(){return Tiff;},EXIF:function(){var Exif;Exif=extractTags(offsets.exifIFD,tags.exif);if(Exif.ExifVersion&&Basic.typeOf(Exif.ExifVersion)==='array'){for(var i=0,exifVersion='';i<Exif.ExifVersion.length;i++){exifVersion+=String.fromCharCode(Exif.ExifVersion[i]);}
Exif.ExifVersion=exifVersion;}
return Exif;},GPS:function(){var GPS;GPS=extractTags(offsets.gpsIFD,tags.gps);if(GPS.GPSVersionID&&Basic.typeOf(GPS.GPSVersionID)==='array'){GPS.GPSVersionID=GPS.GPSVersionID.join('.');}
return GPS;},setExif:function(tag,value){if(tag!=='PixelXDimension'&&tag!=='PixelYDimension'){return false;}
return setTag('exif',tag,value);},getBinary:function(){return data.SEGMENT();},purge:function(){data.init(null);data=Tiff=null;offsets={};}};};});define("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(Basic,x,JPEGHeaders,BinaryReader,ExifParser){function JPEG(binstr){var _binstr,_br,_hm,_ep,_info,hasExif;function _getDimensions(){var idx=0,marker,length;while(idx<=_binstr.length){marker=_br.SHORT(idx+=2);if(marker>=0xFFC0&&marker<=0xFFC3){idx+=5;return{height:_br.SHORT(idx),width:_br.SHORT(idx+=2)};}
length=_br.SHORT(idx+=2);idx+=length-2;}
return null;}
_binstr=binstr;_br=new BinaryReader();_br.init(_binstr);if(_br.SHORT(0)!==0xFFD8){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}
_hm=new JPEGHeaders(binstr);_ep=new ExifParser();hasExif=!!_ep.init(_hm.get('app1')[0]);_info=_getDimensions.call(this);Basic.extend(this,{type:'image/jpeg',size:_binstr.length,width:_info&&_info.width||0,height:_info&&_info.height||0,setExif:function(tag,value){if(!hasExif){return false;}
if(Basic.typeOf(tag)==='object'){Basic.each(tag,function(value,tag){_ep.setExif(tag,value);});}else{_ep.setExif(tag,value);}
_hm.set('app1',_ep.getBinary());},writeHeaders:function(){if(!arguments.length){return(_binstr=_hm.restore(_binstr));}
return _hm.restore(arguments[0]);},stripHeaders:function(binstr){return _hm.strip(binstr);},purge:function(){_purge.call(this);}});if(hasExif){this.meta={tiff:_ep.TIFF(),exif:_ep.EXIF(),gps:_ep.GPS()};}
function _purge(){if(!_ep||!_hm||!_br){return;}
_ep.purge();_hm.purge();_br.init(null);_binstr=_info=_hm=_ep=_br=null;}}
return JPEG;});define("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(x,Basic,BinaryReader){function PNG(binstr){var _binstr,_br,_hm,_ep,_info;_binstr=binstr;_br=new BinaryReader();_br.init(_binstr);(function(){var idx=0,i=0,signature=[0x8950,0x4E47,0x0D0A,0x1A0A];for(i=0;i<signature.length;i++,idx+=2){if(signature[i]!=_br.SHORT(idx)){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}}}());function _getDimensions(){var chunk,idx;chunk=_getChunkAt.call(this,8);if(chunk.type=='IHDR'){idx=chunk.start;return{width:_br.LONG(idx),height:_br.LONG(idx+=4)};}
return null;}
function _purge(){if(!_br){return;}
_br.init(null);_binstr=_info=_hm=_ep=_br=null;}
_info=_getDimensions.call(this);Basic.extend(this,{type:'image/png',size:_binstr.length,width:_info.width,height:_info.height,purge:function(){_purge.call(this);}});_purge.call(this);function _getChunkAt(idx){var length,type,start,CRC;length=_br.LONG(idx);type=_br.STRING(idx+=4,4);start=idx+=4;CRC=_br.LONG(idx+length);return{length:length,type:type,start:start,CRC:CRC};}}
return PNG;});define("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(Basic,x,JPEG,PNG){return function(binstr){var _cs=[JPEG,PNG],_img;_img=(function(){for(var i=0;i<_cs.length;i++){try{return new _cs[i](binstr);}catch(ex){}}
throw new x.ImageError(x.ImageError.WRONG_FORMAT);}());Basic.extend(this,{type:'',size:0,width:0,height:0,setExif:function(){},writeHeaders:function(data){return data;},stripHeaders:function(data){return data;},purge:function(){}});Basic.extend(this,_img);this.purge=function(){_img.purge();_img=null;};};});define("moxie/runtime/html5/image/MegaPixel",[],function(){function renderImageToCanvas(img,canvas,options){var iw=img.naturalWidth,ih=img.naturalHeight;var width=options.width,height=options.height;var x=options.x||0,y=options.y||0;var ctx=canvas.getContext('2d');if(detectSubsampling(img)){iw/=2;ih/=2;}
var d=1024;var tmpCanvas=document.createElement('canvas');tmpCanvas.width=tmpCanvas.height=d;var tmpCtx=tmpCanvas.getContext('2d');var vertSquashRatio=detectVerticalSquash(img,iw,ih);var sy=0;while(sy<ih){var sh=sy+d>ih?ih-sy:d;var sx=0;while(sx<iw){var sw=sx+d>iw?iw-sx:d;tmpCtx.clearRect(0,0,d,d);tmpCtx.drawImage(img,-sx,-sy);var dx=(sx*width/iw+x)<<0;var dw=Math.ceil(sw*width/iw);var dy=(sy*height/ih/vertSquashRatio+y)<<0;var dh=Math.ceil(sh*height/ih/vertSquashRatio);ctx.drawImage(tmpCanvas,0,0,sw,sh,dx,dy,dw,dh);sx+=d;}
sy+=d;}
tmpCanvas=tmpCtx=null;}
function detectSubsampling(img){var iw=img.naturalWidth,ih=img.naturalHeight;if(iw*ih>1024*1024){var canvas=document.createElement('canvas');canvas.width=canvas.height=1;var ctx=canvas.getContext('2d');ctx.drawImage(img,-iw+1,0);return ctx.getImageData(0,0,1,1).data[3]===0;}else{return false;}}
function detectVerticalSquash(img,iw,ih){var canvas=document.createElement('canvas');canvas.width=1;canvas.height=ih;var ctx=canvas.getContext('2d');ctx.drawImage(img,0,0);var data=ctx.getImageData(0,0,1,ih).data;var sy=0;var ey=ih;var py=ih;while(py>sy){var alpha=data[(py-1)*4+3];if(alpha===0){ey=py;}else{sy=py;}
py=(ey+sy)>>1;}
canvas=null;var ratio=(py/ih);return(ratio===0)?1:ratio;}
return{isSubsampled:detectSubsampling,renderTo:renderImageToCanvas};});define("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,x,Encode,File,ImageInfo,MegaPixel,Mime,Env){function HTML5Image(){var me=this,_img,_imgInfo,_canvas,_binStr,_blob,_modified=false,_preserveHeaders=true;Basic.extend(this,{loadFromBlob:function(blob){var comp=this,I=comp.getRuntime(),asBinary=arguments.length>1?arguments[1]:true;if(!I.can('access_binary')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}
_blob=blob;if(blob.isDetached()){_binStr=blob.getSource();_preload.call(this,_binStr);return;}else{_readAsDataUrl.call(this,blob.getSource(),function(dataUrl){if(asBinary){_binStr=_toBinary(dataUrl);}
_preload.call(comp,dataUrl);});}},loadFromImage:function(img,exact){this.meta=img.meta;_blob=new File(null,{name:img.name,size:img.size,type:img.type});_preload.call(this,exact?(_binStr=img.getAsBinaryString()):img.getAsDataURL());},getInfo:function(){var I=this.getRuntime(),info;if(!_imgInfo&&_binStr&&I.can('access_image_binary')){_imgInfo=new ImageInfo(_binStr);}
info={width:_getImg().width||0,height:_getImg().height||0,type:_blob.type||Mime.getFileMime(_blob.name),size:_binStr&&_binStr.length||_blob.size||0,name:_blob.name||'',meta:_imgInfo&&_imgInfo.meta||this.meta||{}};return info;},downsize:function(){_downsize.apply(this,arguments);},getAsCanvas:function(){if(_canvas){_canvas.id=this.uid+'_canvas';}
return _canvas;},getAsBlob:function(type,quality){if(type!==this.type){_downsize.call(this,this.width,this.height,false);}
return new File(null,{name:_blob.name||'',type:type,data:me.getAsBinaryString.call(this,type,quality)});},getAsDataURL:function(type){var quality=arguments[1]||90;if(!_modified){return _img.src;}
if('image/jpeg'!==type){return _canvas.toDataURL('image/png');}else{try{return _canvas.toDataURL('image/jpeg',quality/100);}catch(ex){return _canvas.toDataURL('image/jpeg');}}},getAsBinaryString:function(type,quality){if(!_modified){if(!_binStr){_binStr=_toBinary(me.getAsDataURL(type,quality));}
return _binStr;}
if('image/jpeg'!==type){_binStr=_toBinary(me.getAsDataURL(type,quality));}else{var dataUrl;if(!quality){quality=90;}
try{dataUrl=_canvas.toDataURL('image/jpeg',quality/100);}catch(ex){dataUrl=_canvas.toDataURL('image/jpeg');}
_binStr=_toBinary(dataUrl);if(_imgInfo){_binStr=_imgInfo.stripHeaders(_binStr);if(_preserveHeaders){if(_imgInfo.meta&&_imgInfo.meta.exif){_imgInfo.setExif({PixelXDimension:this.width,PixelYDimension:this.height});}
_binStr=_imgInfo.writeHeaders(_binStr);}
_imgInfo.purge();_imgInfo=null;}}
_modified=false;return _binStr;},destroy:function(){me=null;_purge.call(this);this.getRuntime().getShim().removeInstance(this.uid);}});function _getImg(){if(!_canvas&&!_img){throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);}
return _canvas||_img;}
function _toBinary(str){return Encode.atob(str.substring(str.indexOf('base64,')+7));}
function _toDataUrl(str,type){return'data:'+(type||'')+';base64,'+Encode.btoa(str);}
function _preload(str){var comp=this;_img=new Image();_img.onerror=function(){_purge.call(this);comp.trigger('error',x.ImageError.WRONG_FORMAT);};_img.onload=function(){comp.trigger('load');};_img.src=/^data:[^;]*;base64,/.test(str)?str:_toDataUrl(str,_blob.type);}
function _readAsDataUrl(file,callback){var comp=this,fr;if(window.FileReader){fr=new FileReader();fr.onload=function(){callback(this.result);};fr.onerror=function(){comp.trigger('error',x.ImageError.WRONG_FORMAT);};fr.readAsDataURL(file);}else{return callback(file.getAsDataURL());}}
function _downsize(width,height,crop,preserveHeaders){var self=this,scale,mathFn,x=0,y=0,img,destWidth,destHeight,orientation;_preserveHeaders=preserveHeaders;orientation=(this.meta&&this.meta.tiff&&this.meta.tiff.Orientation)||1;if(Basic.inArray(orientation,[5,6,7,8])!==-1){var tmp=width;width=height;height=tmp;}
img=_getImg();if(!crop){scale=Math.min(width/img.width,height/img.height);}else{width=Math.min(width,img.width);height=Math.min(height,img.height);scale=Math.max(width/img.width,height/img.height);}
if(scale>1&&!crop&&preserveHeaders){this.trigger('Resize');return;}
if(!_canvas){_canvas=document.createElement("canvas");}
destWidth=Math.round(img.width*scale);destHeight=Math.round(img.height*scale);if(crop){_canvas.width=width;_canvas.height=height;if(destWidth>width){x=Math.round((destWidth-width)/2);}
if(destHeight>height){y=Math.round((destHeight-height)/2);}}else{_canvas.width=destWidth;_canvas.height=destHeight;}
if(!_preserveHeaders){_rotateToOrientaion(_canvas.width,_canvas.height,orientation);}
_drawToCanvas.call(this,img,_canvas,-x,-y,destWidth,destHeight);this.width=_canvas.width;this.height=_canvas.height;_modified=true;self.trigger('Resize');}
function _drawToCanvas(img,canvas,x,y,w,h){if(Env.OS==='iOS'){MegaPixel.renderTo(img,canvas,{width:w,height:h,x:x,y:y});}else{var ctx=canvas.getContext('2d');ctx.drawImage(img,x,y,w,h);}}
function _rotateToOrientaion(width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:_canvas.width=height;_canvas.height=width;break;default:_canvas.width=width;_canvas.height=height;}
var ctx=_canvas.getContext('2d');switch(orientation){case 2:ctx.translate(width,0);ctx.scale(-1,1);break;case 3:ctx.translate(width,height);ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height);ctx.scale(1,-1);break;case 5:ctx.rotate(0.5*Math.PI);ctx.scale(1,-1);break;case 6:ctx.rotate(0.5*Math.PI);ctx.translate(0,-height);break;case 7:ctx.rotate(0.5*Math.PI);ctx.translate(width,-height);ctx.scale(-1,1);break;case 8:ctx.rotate(-0.5*Math.PI);ctx.translate(-width,0);break;}}
function _purge(){if(_imgInfo){_imgInfo.purge();_imgInfo=null;}
_binStr=_img=_canvas=_blob=null;_modified=false;}}
return(extensions.Image=HTML5Image);});define("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){var type='flash',extensions={};function getShimVersion(){var version;try{version=navigator.plugins['Shockwave Flash'];version=version.description;}catch(e1){try{version=new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version');}catch(e2){version='0.0';}}
version=version.match(/\d+/g);return parseFloat(version[0]+'.'+version[1]);}
function FlashRuntime(options){var I=this,initTimer;options=Basic.extend({swf_url:Env.swf_url},options);Runtime.call(this,options,type,{access_binary:function(value){return value&&I.mode==='browser';},access_image_binary:function(value){return value&&I.mode==='browser';},display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:false,report_upload_progress:function(){return I.mode==='client';},resize_image:Runtime.capTrue,return_response_headers:false,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true;}
return!Basic.arrayDiff(responseType,['','text','document'])||I.mode==='browser';},return_status_code:function(code){return I.mode==='browser'||!Basic.arrayDiff(code,[200,404]);},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:function(value){return value&&I.mode==='browser';},send_browser_cookies:function(value){return value&&I.mode==='browser';},send_custom_headers:function(value){return value&&I.mode==='browser';},send_multipart:Runtime.capTrue,slice_blob:function(value){return value&&I.mode==='browser';},stream_upload:function(value){return value&&I.mode==='browser';},summon_file_dialog:false,upload_filesize:function(size){return Basic.parseSizeStr(size)<=2097152||I.mode==='client';},use_http_method:function(methods){return!Basic.arrayDiff(methods,['GET','POST']);}},{access_binary:function(value){return value?'browser':'client';},access_image_binary:function(value){return value?'browser':'client';},report_upload_progress:function(value){return value?'browser':'client';},return_response_type:function(responseType){return Basic.arrayDiff(responseType,['','text','json','document'])?'browser':['client','browser'];},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?'browser':['client','browser'];},send_binary_string:function(value){return value?'browser':'client';},send_browser_cookies:function(value){return value?'browser':'client';},send_custom_headers:function(value){return value?'browser':'client';},stream_upload:function(value){return value?'client':'browser';},upload_filesize:function(size){return Basic.parseSizeStr(size)>=2097152?'client':'browser';}},'client');if(getShimVersion()<10){this.mode=false;}
Basic.extend(this,{getShim:function(){return Dom.get(this.uid);},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args);},init:function(){var html,el,container;container=this.getShimContainer();Basic.extend(container.style,{position:'absolute',top:'-8px',left:'-8px',width:'9px',height:'9px',overflow:'hidden'});html='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+options.swf_url+'" ';if(Env.browser==='IE'){html+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ';}
html+='width="100%" height="100%" style="outline:0">'+'<param name="movie" value="'+options.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+'&target='+Env.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+'</object>';if(Env.browser==='IE'){el=document.createElement('div');container.appendChild(el);el.outerHTML=html;el=container=null;}else{container.innerHTML=html;}
initTimer=setTimeout(function(){if(I&&!I.initialized){I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));}},5000);},destroy:(function(destroy){return function(){destroy.call(I);clearTimeout(initTimer);options=initTimer=destroy=I=null;};}(this.destroy))},extensions);}
Runtime.addConstructor(type,FlashRuntime);return extensions;});define("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var FlashBlob={slice:function(blob,start,end,type){var self=this.getRuntime();if(start<0){start=Math.max(blob.size+start,0);}else if(start>0){start=Math.min(start,blob.size);}
if(end<0){end=Math.max(blob.size+end,0);}else if(end>0){end=Math.min(end,blob.size);}
blob=self.shimExec.call(this,'Blob','slice',start,end,type||'');if(blob){blob=new Blob(self.uid,blob);}
return blob;}};return(extensions.Blob=FlashBlob);});define("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(extensions){var FileInput={init:function(options){this.getRuntime().shimExec.call(this,'FileInput','init',{name:options.name,accept:options.accept,multiple:options.multiple});this.trigger('ready');}};return(extensions.FileInput=FileInput);});define("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){var _result='';function _formatData(data,op){switch(op){case'readAsText':return Encode.atob(data,'utf8');case'readAsBinaryString':return Encode.atob(data);case'readAsDataURL':return data;}
return null;}
var FileReader={read:function(op,blob){var target=this,self=target.getRuntime();if(op==='readAsDataURL'){_result='data:'+(blob.type||'')+';base64,';}
target.bind('Progress',function(e,data){if(data){_result+=_formatData(data,op);}});return self.shimExec.call(this,'FileReader','readAsBase64',blob.uid);},getResult:function(){return _result;},destroy:function(){_result=null;}};return(extensions.FileReader=FileReader);});define("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){function _formatData(data,op){switch(op){case'readAsText':return Encode.atob(data,'utf8');case'readAsBinaryString':return Encode.atob(data);case'readAsDataURL':return data;}
return null;}
var FileReaderSync={read:function(op,blob){var result,self=this.getRuntime();result=self.shimExec.call(this,'FileReaderSync','readAsBase64',blob.uid);if(!result){return null;}
if(op==='readAsDataURL'){result='data:'+(blob.type||'')+';base64,'+result;}
return _formatData(result,op,blob.type);}};return(extensions.FileReaderSync=FileReaderSync);});define("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter"],function(extensions,Basic,Blob,File,FileReaderSync,FormData,Transporter){var XMLHttpRequest={send:function(meta,data){var target=this,self=target.getRuntime();function send(){meta.transport=self.mode;self.shimExec.call(target,'XMLHttpRequest','send',meta,data);}
function appendBlob(name,blob){self.shimExec.call(target,'XMLHttpRequest','appendBlob',name,blob.uid);data=null;send();}
function attachBlob(blob,cb){var tr=new Transporter();tr.bind("TransportingComplete",function(){cb(this.result);});tr.transport(blob.getSource(),blob.type,{ruid:self.uid});}
if(!Basic.isEmptyObj(meta.headers)){Basic.each(meta.headers,function(value,header){self.shimExec.call(target,'XMLHttpRequest','setRequestHeader',header,value.toString());});}
if(data instanceof FormData){var blobField;data.each(function(value,name){if(value instanceof Blob){blobField=name;}else{self.shimExec.call(target,'XMLHttpRequest','append',name,value);}});if(!data.hasBlob()){data=null;send();}else{var blob=data.getBlob();if(blob.isDetached()){attachBlob(blob,function(attachedBlob){blob.destroy();appendBlob(blobField,attachedBlob);});}else{appendBlob(blobField,blob);}}}else if(data instanceof Blob){if(data.isDetached()){attachBlob(data,function(attachedBlob){data.destroy();data=attachedBlob.uid;send();});}else{data=data.uid;send();}}else{send();}},getResponse:function(responseType){var frs,blob,self=this.getRuntime();blob=self.shimExec.call(this,'XMLHttpRequest','getResponseAsBlob');if(blob){blob=new File(self.uid,blob);if('blob'===responseType){return blob;}
try{frs=new FileReaderSync();if(!!~Basic.inArray(responseType,["","text"])){return frs.readAsText(blob);}else if('json'===responseType&&!!window.JSON){return JSON.parse(frs.readAsText(blob));}}finally{blob.destroy();}}
return null;},abort:function(upload_complete_flag){var self=this.getRuntime();self.shimExec.call(this,'XMLHttpRequest','abort');this.dispatchEvent('readystatechange');this.dispatchEvent('abort');}};return(extensions.XMLHttpRequest=XMLHttpRequest);});define("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var Transporter={getAsBlob:function(type){var self=this.getRuntime(),blob=self.shimExec.call(this,'Transporter','getAsBlob',type);if(blob){return new Blob(self.uid,blob);}
return null;}};return(extensions.Transporter=Transporter);});define("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(extensions,Basic,Transporter,Blob,FileReaderSync){var Image={loadFromBlob:function(blob){var comp=this,self=comp.getRuntime();function exec(srcBlob){self.shimExec.call(comp,'Image','loadFromBlob',srcBlob.uid);comp=self=null;}
if(blob.isDetached()){var tr=new Transporter();tr.bind("TransportingComplete",function(){exec(tr.result.getSource());});tr.transport(blob.getSource(),blob.type,{ruid:self.uid});}else{exec(blob.getSource());}},loadFromImage:function(img){var self=this.getRuntime();return self.shimExec.call(this,'Image','loadFromImage',img.uid);},getAsBlob:function(type,quality){var self=this.getRuntime(),blob=self.shimExec.call(this,'Image','getAsBlob',type,quality);if(blob){return new Blob(self.uid,blob);}
return null;},getAsDataURL:function(){var self=this.getRuntime(),blob=self.Image.getAsBlob.apply(this,arguments),frs;if(!blob){return null;}
frs=new FileReaderSync();return frs.readAsDataURL(blob);}};return(extensions.Image=Image);});define("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){var type="silverlight",extensions={};function isInstalled(version){var isVersionSupported=false,control=null,actualVer,actualVerArray,reqVerArray,requiredVersionPart,actualVersionPart,index=0;try{try{control=new ActiveXObject('AgControl.AgControl');if(control.IsVersionSupported(version)){isVersionSupported=true;}
control=null;}catch(e){var plugin=navigator.plugins["Silverlight Plug-In"];if(plugin){actualVer=plugin.description;if(actualVer==="1.0.30226.2"){actualVer="2.0.30226.2";}
actualVerArray=actualVer.split(".");while(actualVerArray.length>3){actualVerArray.pop();}
while(actualVerArray.length<4){actualVerArray.push(0);}
reqVerArray=version.split(".");while(reqVerArray.length>4){reqVerArray.pop();}
do{requiredVersionPart=parseInt(reqVerArray[index],10);actualVersionPart=parseInt(actualVerArray[index],10);index++;}while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);if(requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)){isVersionSupported=true;}}}}catch(e2){isVersionSupported=false;}
return isVersionSupported;}
function SilverlightRuntime(options){var I=this,initTimer;options=Basic.extend({xap_url:Env.xap_url},options);Runtime.call(this,options,type,{access_binary:Runtime.capTrue,access_image_binary:Runtime.capTrue,display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:false,report_upload_progress:Runtime.capTrue,resize_image:Runtime.capTrue,return_response_headers:function(value){return value&&I.mode==='client';},return_response_type:function(responseType){if(responseType!=='json'){return true;}else{return!!window.JSON;}},return_status_code:function(code){return I.mode==='client'||!Basic.arrayDiff(code,[200,404]);},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:Runtime.capTrue,send_browser_cookies:function(value){return value&&I.mode==='browser';},send_custom_headers:function(value){return value&&I.mode==='client';},send_multipart:Runtime.capTrue,slice_blob:Runtime.capTrue,stream_upload:true,summon_file_dialog:false,upload_filesize:Runtime.capTrue,use_http_method:function(methods){return I.mode==='client'||!Basic.arrayDiff(methods,['GET','POST']);}},{return_response_headers:function(value){return value?'client':'browser';},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?'client':['client','browser'];},send_browser_cookies:function(value){return value?'browser':'client';},send_custom_headers:function(value){return value?'client':'browser';},use_http_method:function(methods){return Basic.arrayDiff(methods,['GET','POST'])?'client':['client','browser'];}});if(!isInstalled('2.0.31005.0')||Env.browser==='Opera'){this.mode=false;}
Basic.extend(this,{getShim:function(){return Dom.get(this.uid).content.Moxie;},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args);},init:function(){var container;container=this.getShimContainer();container.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+options.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+',target='+Env.global_event_dispatcher+'"/>'+'</object>';initTimer=setTimeout(function(){if(I&&!I.initialized){I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));}},Env.OS!=='Windows'?10000:5000);},destroy:(function(destroy){return function(){destroy.call(I);clearTimeout(initTimer);options=initTimer=destroy=I=null;};}(this.destroy))},extensions);}
Runtime.addConstructor(type,SilverlightRuntime);return extensions;});define("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(extensions,Basic,Blob){return(extensions.Blob=Basic.extend({},Blob));});define("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(extensions){var FileInput={init:function(options){function toFilters(accept){var filter='';for(var i=0;i<accept.length;i++){filter+=(filter!==''?'|':'')+accept[i].title+" | *."+accept[i].extensions.replace(/,/g,';*.');}
return filter;}
this.getRuntime().shimExec.call(this,'FileInput','init',toFilters(options.accept),options.name,options.multiple);this.trigger('ready');}};return(extensions.FileInput=FileInput);});define("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(extensions,Dom,Events){var FileDrop={init:function(){var comp=this,self=comp.getRuntime(),dropZone;dropZone=self.getShimContainer();Events.addEvent(dropZone,'dragover',function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect='copy';},comp.uid);Events.addEvent(dropZone,'dragenter',function(e){e.preventDefault();var flag=Dom.get(self.uid).dragEnter(e);if(flag){e.stopPropagation();}},comp.uid);Events.addEvent(dropZone,'drop',function(e){e.preventDefault();var flag=Dom.get(self.uid).dragDrop(e);if(flag){e.stopPropagation();}},comp.uid);return self.shimExec.call(this,'FileDrop','init');}};return(extensions.FileDrop=FileDrop);});define("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(extensions,Basic,FileReader){return(extensions.FileReader=Basic.extend({},FileReader));});define("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(extensions,Basic,FileReaderSync){return(extensions.FileReaderSync=Basic.extend({},FileReaderSync));});define("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(extensions,Basic,XMLHttpRequest){return(extensions.XMLHttpRequest=Basic.extend({},XMLHttpRequest));});define("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(extensions,Basic,Transporter){return(extensions.Transporter=Basic.extend({},Transporter));});define("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(extensions,Basic,Image){return(extensions.Image=Basic.extend({},Image,{getInfo:function(){var self=this.getRuntime(),grps=['tiff','exif','gps'],info={meta:{}},rawInfo=self.shimExec.call(this,'Image','getInfo');if(rawInfo.meta){Basic.each(grps,function(grp){var meta=rawInfo.meta[grp],tag,i,length,value;if(meta&&meta.keys){info.meta[grp]={};for(i=0,length=meta.keys.length;i<length;i++){tag=meta.keys[i];value=meta[tag];if(value){if(/^(\d|[1-9]\d+)$/.test(value)){value=parseInt(value,10);}else if(/^\d*\.\d+$/.test(value)){value=parseFloat(value);}
info.meta[grp][tag]=value;}}}});}
info.width=parseInt(rawInfo.width,10);info.height=parseInt(rawInfo.height,10);info.size=parseInt(rawInfo.size,10);info.type=rawInfo.type;info.name=rawInfo.name;return info;}}));});define("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){var type='html4',extensions={};function Html4Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;Runtime.call(this,options,type,{access_binary:Test(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:false,display_media:Test(extensions.Image&&(Env.can('create_canvas')||Env.can('use_data_uri_over32kb'))),do_cors:false,drag_and_drop:false,filter_by_extension:Test(function(){return(Env.browser==='Chrome'&&Env.version>=28)||(Env.browser==='IE'&&Env.version>=10);}()),resize_image:function(){return extensions.Image&&I.can('access_binary')&&Env.can('create_canvas');},report_upload_progress:false,return_response_headers:false,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true;}
return!!~Basic.inArray(responseType,['text','document','']);},return_status_code:function(code){return!Basic.arrayDiff(code,[200,404]);},select_file:function(){return Env.can('use_fileinput');},select_multiple:false,send_binary_string:false,send_custom_headers:false,send_multipart:true,slice_blob:false,stream_upload:function(){return I.can('select_file');},summon_file_dialog:Test(function(){return(Env.browser==='Firefox'&&Env.version>=4)||(Env.browser==='Opera'&&Env.version>=12)||!!~Basic.inArray(Env.browser,['Chrome','Safari']);}()),upload_filesize:True,use_http_method:function(methods){return!Basic.arrayDiff(methods,['GET','POST']);}});Basic.extend(this,{init:function(){this.trigger("Init");},destroy:(function(destroy){return function(){destroy.call(I);destroy=I=null;};}(this.destroy))});Basic.extend(this.getShim(),extensions);}
Runtime.addConstructor(type,Html4Runtime);return extensions;});define("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _uid,_files=[],_mimes=[],_options;function addInput(){var comp=this,I=comp.getRuntime(),shimContainer,browseButton,currForm,form,input,uid;uid=Basic.guid('uid_');shimContainer=I.getShimContainer();if(_uid){currForm=Dom.get(_uid+'_form');if(currForm){Basic.extend(currForm.style,{top:'100%'});}}
form=document.createElement('form');form.setAttribute('id',uid+'_form');form.setAttribute('method','post');form.setAttribute('enctype','multipart/form-data');form.setAttribute('encoding','multipart/form-data');Basic.extend(form.style,{overflow:'hidden',position:'absolute',top:0,left:0,width:'100%',height:'100%'});input=document.createElement('input');input.setAttribute('id',uid);input.setAttribute('type','file');input.setAttribute('name',_options.name||'Filedata');input.setAttribute('accept',_mimes.join(','));Basic.extend(input.style,{fontSize:'999px',opacity:0});form.appendChild(input);shimContainer.appendChild(form);Basic.extend(input.style,{position:'absolute',top:0,left:0,width:'100%',height:'100%'});if(Env.browser==='IE'&&Env.version<10){Basic.extend(input.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});}
input.onchange=function(){var file;if(!this.value){return;}
if(this.files){file=this.files[0];}else{file={name:this.value};}
_files=[file];this.onchange=function(){};addInput.call(comp);comp.bind('change',function onChange(){var input=Dom.get(uid),form=Dom.get(uid+'_form'),file;comp.unbind('change',onChange);if(comp.files.length&&input&&form){file=comp.files[0];input.setAttribute('id',file.uid);form.setAttribute('id',file.uid+'_form');form.setAttribute('target',file.uid+'_iframe');}
input=form=null;},998);input=form=null;comp.trigger('change');};if(I.can('summon_file_dialog')){browseButton=Dom.get(_options.browse_button);Events.removeEvent(browseButton,'click',comp.uid);Events.addEvent(browseButton,'click',function(e){if(input&&!input.disabled){input.click();}
e.preventDefault();},comp.uid);}
_uid=uid;shimContainer=currForm=browseButton=null;}
Basic.extend(this,{init:function(options){var comp=this,I=comp.getRuntime(),shimContainer;_options=options;_mimes=options.accept.mimes||Mime.extList2mimes(options.accept,I.can('filter_by_extension'));shimContainer=I.getShimContainer();(function(){var browseButton,zIndex,top;browseButton=Dom.get(options.browse_button);if(I.can('summon_file_dialog')){if(Dom.getStyle(browseButton,'position')==='static'){browseButton.style.position='relative';}
zIndex=parseInt(Dom.getStyle(browseButton,'z-index'),10)||1;browseButton.style.zIndex=zIndex;shimContainer.style.zIndex=zIndex-1;}
top=I.can('summon_file_dialog')?browseButton:shimContainer;Events.addEvent(top,'mouseover',function(){comp.trigger('mouseenter');},comp.uid);Events.addEvent(top,'mouseout',function(){comp.trigger('mouseleave');},comp.uid);Events.addEvent(top,'mousedown',function(){comp.trigger('mousedown');},comp.uid);Events.addEvent(Dom.get(options.container),'mouseup',function(){comp.trigger('mouseup');},comp.uid);browseButton=null;}());addInput.call(this);shimContainer=null;comp.trigger({type:'ready',async:true});},getFiles:function(){return _files;},disable:function(state){var input;if((input=Dom.get(_uid))){input.disabled=!!state;}},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid);Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid);if(shimContainer){shimContainer.innerHTML='';}
shim.removeInstance(this.uid);_uid=_files=_mimes=_options=shimContainer=shim=null;}});}
return(extensions.FileInput=FileInput);});define("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(extensions,FileReader){return(extensions.FileReader=FileReader);});define("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(extensions,Basic,Dom,Url,x,Events,Blob,FormData){function XMLHttpRequest(){var _status,_response,_iframe;function cleanup(cb){var target=this,uid,form,inputs,i,hasFile=false;if(!_iframe){return;}
uid=_iframe.id.replace(/_iframe$/,'');form=Dom.get(uid+'_form');if(form){inputs=form.getElementsByTagName('input');i=inputs.length;while(i--){switch(inputs[i].getAttribute('type')){case'hidden':inputs[i].parentNode.removeChild(inputs[i]);break;case'file':hasFile=true;break;}}
inputs=[];if(!hasFile){form.parentNode.removeChild(form);}
form=null;}
setTimeout(function(){Events.removeEvent(_iframe,'load',target.uid);if(_iframe.parentNode){_iframe.parentNode.removeChild(_iframe);}
var shimContainer=target.getRuntime().getShimContainer();if(!shimContainer.children.length){shimContainer.parentNode.removeChild(shimContainer);}
shimContainer=_iframe=null;cb();},1);}
Basic.extend(this,{send:function(meta,data){var target=this,I=target.getRuntime(),uid,form,input,blob;_status=_response=null;function createIframe(){var container=I.getShimContainer()||document.body,temp=document.createElement('div');temp.innerHTML='<iframe id="'+uid+'_iframe" name="'+uid+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';_iframe=temp.firstChild;container.appendChild(_iframe);Events.addEvent(_iframe,'load',function(){var el;try{el=_iframe.contentWindow.document||_iframe.contentDocument||window.frames[_iframe.id].document;if(/^4(0[0-9]|1[0-7]|2[2346])\s/.test(el.title)){_status=el.title.replace(/^(\d+).*$/,'$1');}else{_status=200;_response=Basic.trim(el.body.innerHTML);target.trigger({type:'progress',loaded:_response.length,total:_response.length});if(blob){target.trigger({type:'uploadprogress',loaded:blob.size||1025,total:blob.size||1025});}}}catch(ex){if(Url.hasSameOrigin(meta.url)){_status=404;}else{cleanup.call(target,function(){target.trigger('error');});return;}}
cleanup.call(target,function(){target.trigger('load');});},target.uid);}
if(data instanceof FormData&&data.hasBlob()){blob=data.getBlob();uid=blob.uid;input=Dom.get(uid);form=Dom.get(uid+'_form');if(!form){throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);}}else{uid=Basic.guid('uid_');form=document.createElement('form');form.setAttribute('id',uid+'_form');form.setAttribute('method',meta.method);form.setAttribute('enctype','multipart/form-data');form.setAttribute('encoding','multipart/form-data');form.setAttribute('target',uid+'_iframe');I.getShimContainer().appendChild(form);}
if(data instanceof FormData){data.each(function(value,name){if(value instanceof Blob){if(input){input.setAttribute('name',name);}}else{var hidden=document.createElement('input');Basic.extend(hidden,{type:'hidden',name:name,value:value});if(input){form.insertBefore(hidden,input);}else{form.appendChild(hidden);}}});}
form.setAttribute("action",meta.url);createIframe();form.submit();target.trigger('loadstart');},getStatus:function(){return _status;},getResponse:function(responseType){if('json'===responseType){if(Basic.typeOf(_response)==='string'&&!!window.JSON){try{return JSON.parse(_response.replace(/^\s*<pre[^>]*>/,'').replace(/<\/pre>\s*$/,''));}catch(ex){return null;}}}else if('document'===responseType){}
return _response;},abort:function(){var target=this;if(_iframe&&_iframe.contentWindow){if(_iframe.contentWindow.stop){_iframe.contentWindow.stop();}else if(_iframe.contentWindow.document.execCommand){_iframe.contentWindow.document.execCommand('Stop');}else{_iframe.src="about:blank";}}
cleanup.call(this,function(){target.dispatchEvent('abort');});}});}
return(extensions.XMLHttpRequest=XMLHttpRequest);});define("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(extensions,Image){return(extensions.Image=Image);});expose(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events"]);})(this);(function(exports){"use strict";var o={},inArray=exports.moxie.core.utils.Basic.inArray;(function addAlias(ns){var name,itemType;for(name in ns){itemType=typeof(ns[name]);if(itemType==='object'&&!~inArray(name,['Exceptions','Env','Mime'])){addAlias(ns[name]);}else if(itemType==='function'){o[name]=ns[name];}}})(exports.moxie);o.Env=exports.moxie.core.utils.Env;o.Mime=exports.moxie.core.utils.Mime;o.Exceptions=exports.moxie.core.Exceptions;exports.mOxie=o;if(!exports.o){exports.o=o;}
return o;})(this);;;(function(window,o,undef){var delay=window.setTimeout,fileFilters={};function normalizeCaps(settings){var features=settings.required_features,caps={};function resolve(feature,value,strict){var map={chunks:'slice_blob',jpgresize:'send_binary_string',pngresize:'send_binary_string',progress:'report_upload_progress',multi_selection:'select_multiple',dragdrop:'drag_and_drop',drop_element:'drag_and_drop',headers:'send_custom_headers',urlstream_upload:'send_binary_string',canSendBinary:'send_binary',triggerDialog:'summon_file_dialog'};if(map[feature]){caps[map[feature]]=value;}else if(!strict){caps[feature]=value;}}
if(typeof(features)==='string'){plupload.each(features.split(/\s*,\s*/),function(feature){resolve(feature,true);});}else if(typeof(features)==='object'){plupload.each(features,function(value,feature){resolve(feature,value);});}else if(features===true){if(settings.chunk_size>0){caps.slice_blob=true;}
if(settings.resize.enabled||!settings.multipart){caps.send_binary_string=true;}
plupload.each(settings,function(value,feature){resolve(feature,!!value,true);});}
return caps;}
var plupload={VERSION:'2.1.2',STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:o.mimes,ua:o.ua,typeOf:o.typeOf,extend:o.extend,guid:o.guid,get:function get(ids){var els=[],el;if(o.typeOf(ids)!=='array'){ids=[ids];}
var i=ids.length;while(i--){el=o.get(ids[i]);if(el){els.push(el);}}
return els.length?els:null;},each:o.each,getPos:o.getPos,getSize:o.getSize,xmlEncode:function(str){var xmlEncodeChars={'<':'lt','>':'gt','&':'amp','"':'quot','\'':'#39'},xmlEncodeRegExp=/[<>&\"\']/g;return str?(''+str).replace(xmlEncodeRegExp,function(chr){return xmlEncodeChars[chr]?'&'+xmlEncodeChars[chr]+';':chr;}):str;},toArray:o.toArray,inArray:o.inArray,addI18n:o.addI18n,translate:o.translate,isEmptyObj:o.isEmptyObj,hasClass:o.hasClass,addClass:o.addClass,removeClass:o.removeClass,getStyle:o.getStyle,addEvent:o.addEvent,removeEvent:o.removeEvent,removeAllEvents:o.removeAllEvents,cleanName:function(name){var i,lookup;lookup=[/[\300-\306]/g,'A',/[\340-\346]/g,'a',/\307/g,'C',/\347/g,'c',/[\310-\313]/g,'E',/[\350-\353]/g,'e',/[\314-\317]/g,'I',/[\354-\357]/g,'i',/\321/g,'N',/\361/g,'n',/[\322-\330]/g,'O',/[\362-\370]/g,'o',/[\331-\334]/g,'U',/[\371-\374]/g,'u'];for(i=0;i<lookup.length;i+=2){name=name.replace(lookup[i],lookup[i+1]);}
name=name.replace(/\s+/g,'_');name=name.replace(/[^a-z0-9_\-\.]+/gi,'');return name;},buildUrl:function(url,items){var query='';plupload.each(items,function(value,name){query+=(query?'&':'')+encodeURIComponent(name)+'='+encodeURIComponent(value);});if(query){url+=(url.indexOf('?')>0?'&':'?')+query;}
return url;},formatSize:function(size){if(size===undef||/\D/.test(size)){return plupload.translate('N/A');}
function round(num,precision){return Math.round(num*Math.pow(10,precision))/Math.pow(10,precision);}
var boundary=Math.pow(1024,4);if(size>boundary){return round(size/boundary,1)+" "+plupload.translate('tb');}
if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('gb');}
if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('mb');}
if(size>1024){return Math.round(size/1024)+" "+plupload.translate('kb');}
return size+" "+plupload.translate('b');},parseSize:o.parseSizeStr,predictRuntime:function(config,runtimes){var up,runtime;up=new plupload.Uploader(config);runtime=o.Runtime.thatCan(up.getOption().required_features,runtimes||config.runtimes);up.destroy();return runtime;},addFileFilter:function(name,cb){fileFilters[name]=cb;}};plupload.addFileFilter('mime_types',function(filters,file,cb){if(filters.length&&!filters.regexp.test(file.name)){this.trigger('Error',{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate('File extension error.'),file:file});cb(false);}else{cb(true);}});plupload.addFileFilter('max_file_size',function(maxSize,file,cb){var undef;maxSize=plupload.parseSize(maxSize);if(file.size!==undef&&maxSize&&file.size>maxSize){this.trigger('Error',{code:plupload.FILE_SIZE_ERROR,message:plupload.translate('File size error.'),file:file});cb(false);}else{cb(true);}});plupload.addFileFilter('prevent_duplicates',function(value,file,cb){if(value){var ii=this.files.length;while(ii--){if(file.name===this.files[ii].name&&file.size===this.files[ii].size){this.trigger('Error',{code:plupload.FILE_DUPLICATE_ERROR,message:plupload.translate('Duplicate file error.'),file:file});cb(false);return;}}}
cb(true);});plupload.Uploader=function(options){var uid=plupload.guid(),settings,files=[],preferred_caps={},fileInputs=[],fileDrops=[],startTime,total,disabled=false,xhr;function uploadNext(){var file,count=0,i;if(this.state==plupload.STARTED){for(i=0;i<files.length;i++){if(!file&&files[i].status==plupload.QUEUED){file=files[i];if(this.trigger("BeforeUpload",file)){file.status=plupload.UPLOADING;this.trigger("UploadFile",file);}}else{count++;}}
if(count==files.length){if(this.state!==plupload.STOPPED){this.state=plupload.STOPPED;this.trigger("StateChanged");}
this.trigger("UploadComplete",files);}}}
function calcFile(file){file.percent=file.size>0?Math.ceil(file.loaded/file.size*100):100;calc();}
function calc(){var i,file;total.reset();for(i=0;i<files.length;i++){file=files[i];if(file.size!==undef){total.size+=file.origSize;total.loaded+=file.loaded*file.origSize/file.size;}else{total.size=undef;}
if(file.status==plupload.DONE){total.uploaded++;}else if(file.status==plupload.FAILED){total.failed++;}else{total.queued++;}}
if(total.size===undef){total.percent=files.length>0?Math.ceil(total.uploaded/files.length*100):0;}else{total.bytesPerSec=Math.ceil(total.loaded/((+new Date()-startTime||1)/1000.0));total.percent=total.size>0?Math.ceil(total.loaded/total.size*100):0;}}
function getRUID(){var ctrl=fileInputs[0]||fileDrops[0];if(ctrl){return ctrl.getRuntime().uid;}
return false;}
function runtimeCan(file,cap){if(file.ruid){var info=o.Runtime.getInfo(file.ruid);if(info){return info.can(cap);}}
return false;}
function bindEventListeners(){this.bind('FilesAdded FilesRemoved',function(up){up.trigger('QueueChanged');up.refresh();});this.bind('CancelUpload',onCancelUpload);this.bind('BeforeUpload',onBeforeUpload);this.bind('UploadFile',onUploadFile);this.bind('UploadProgress',onUploadProgress);this.bind('StateChanged',onStateChanged);this.bind('QueueChanged',calc);this.bind('Error',onError);this.bind('FileUploaded',onFileUploaded);this.bind('Destroy',onDestroy);}
function initControls(settings,cb){var self=this,inited=0,queue=[];var options={runtime_order:settings.runtimes,required_caps:settings.required_features,preferred_caps:preferred_caps,swf_url:settings.flash_swf_url,xap_url:settings.silverlight_xap_url};plupload.each(settings.runtimes.split(/\s*,\s*/),function(runtime){if(settings[runtime]){options[runtime]=settings[runtime];}});if(settings.browse_button){plupload.each(settings.browse_button,function(el){queue.push(function(cb){var fileInput=new o.FileInput(plupload.extend({},options,{accept:settings.filters.mime_types,name:settings.file_data_name,multiple:settings.multi_selection,container:settings.container,browse_button:el}));fileInput.onready=function(){var info=o.Runtime.getInfo(this.ruid);o.extend(self.features,{chunks:info.can('slice_blob'),multipart:info.can('send_multipart'),multi_selection:info.can('select_multiple')});inited++;fileInputs.push(this);cb();};fileInput.onchange=function(){self.addFile(this.files);};fileInput.bind('mouseenter mouseleave mousedown mouseup',function(e){if(!disabled){if(settings.browse_button_hover){if('mouseenter'===e.type){o.addClass(el,settings.browse_button_hover);}else if('mouseleave'===e.type){o.removeClass(el,settings.browse_button_hover);}}
if(settings.browse_button_active){if('mousedown'===e.type){o.addClass(el,settings.browse_button_active);}else if('mouseup'===e.type){o.removeClass(el,settings.browse_button_active);}}}});fileInput.bind('mousedown',function(){self.trigger('Browse');});fileInput.bind('error runtimeerror',function(){fileInput=null;cb();});fileInput.init();});});}
if(settings.drop_element){plupload.each(settings.drop_element,function(el){queue.push(function(cb){var fileDrop=new o.FileDrop(plupload.extend({},options,{drop_zone:el}));fileDrop.onready=function(){var info=o.Runtime.getInfo(this.ruid);self.features.dragdrop=info.can('drag_and_drop');inited++;fileDrops.push(this);cb();};fileDrop.ondrop=function(){self.addFile(this.files);};fileDrop.bind('error runtimeerror',function(){fileDrop=null;cb();});fileDrop.init();});});}
o.inSeries(queue,function(){if(typeof(cb)==='function'){cb(inited);}});}
function resizeImage(blob,params,cb){var img=new o.Image();try{img.onload=function(){if(params.width>this.width&&params.height>this.height&&params.quality===undef&&params.preserve_headers&&!params.crop){this.destroy();return cb(blob);}
img.downsize(params.width,params.height,params.crop,params.preserve_headers);};img.onresize=function(){cb(this.getAsBlob(blob.type,params.quality));this.destroy();};img.onerror=function(){cb(blob);};img.load(blob);}catch(ex){cb(blob);}}
function setOption(option,value,init){var self=this,reinitRequired=false;function _setOption(option,value,init){var oldValue=settings[option];switch(option){case'max_file_size':if(option==='max_file_size'){settings.max_file_size=settings.filters.max_file_size=value;}
break;case'chunk_size':if(value=plupload.parseSize(value)){settings[option]=value;settings.send_file_name=true;}
break;case'multipart':settings[option]=value;if(!value){settings.send_file_name=true;}
break;case'unique_names':settings[option]=value;if(value){settings.send_file_name=true;}
break;case'filters':if(plupload.typeOf(value)==='array'){value={mime_types:value};}
if(init){plupload.extend(settings.filters,value);}else{settings.filters=value;}
if(value.mime_types){settings.filters.mime_types.regexp=(function(filters){var extensionsRegExp=[];plupload.each(filters,function(filter){plupload.each(filter.extensions.split(/,/),function(ext){if(/^\s*\*\s*$/.test(ext)){extensionsRegExp.push('\\.*');}else{extensionsRegExp.push('\\.'+ext.replace(new RegExp('['+('/^$.*+?|()[]{}\\'.replace(/./g,'\\$&'))+']','g'),'\\$&'));}});});return new RegExp('('+extensionsRegExp.join('|')+')$','i');}(settings.filters.mime_types));}
break;case'resize':if(init){plupload.extend(settings.resize,value,{enabled:true});}else{settings.resize=value;}
break;case'prevent_duplicates':settings.prevent_duplicates=settings.filters.prevent_duplicates=!!value;break;case'browse_button':case'drop_element':value=plupload.get(value);case'container':case'runtimes':case'multi_selection':case'flash_swf_url':case'silverlight_xap_url':settings[option]=value;if(!init){reinitRequired=true;}
break;default:settings[option]=value;}
if(!init){self.trigger('OptionChanged',option,value,oldValue);}}
if(typeof(option)==='object'){plupload.each(option,function(value,option){_setOption(option,value,init);});}else{_setOption(option,value,init);}
if(init){settings.required_features=normalizeCaps(plupload.extend({},settings));preferred_caps=normalizeCaps(plupload.extend({},settings,{required_features:true}));}else if(reinitRequired){self.trigger('Destroy');initControls.call(self,settings,function(inited){if(inited){self.runtime=o.Runtime.getInfo(getRUID()).type;self.trigger('Init',{runtime:self.runtime});self.trigger('PostInit');}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});}});}}
function onBeforeUpload(up,file){if(up.settings.unique_names){var matches=file.name.match(/\.([^.]+)$/),ext="part";if(matches){ext=matches[1];}
file.target_name=file.id+'.'+ext;}}
function onUploadFile(up,file){var url=up.settings.url,chunkSize=up.settings.chunk_size,retries=up.settings.max_retries,features=up.features,offset=0,blob;if(file.loaded){offset=file.loaded=chunkSize?chunkSize*Math.floor(file.loaded/chunkSize):0;}
function handleError(){if(retries-->0){delay(uploadNextChunk,1000);}else{file.loaded=offset;up.trigger('Error',{code:plupload.HTTP_ERROR,message:plupload.translate('HTTP Error.'),file:file,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});}}
function uploadNextChunk(){var chunkBlob,formData,args={},curChunkSize;if(file.status!==plupload.UPLOADING||up.state===plupload.STOPPED){return;}
if(up.settings.send_file_name){args.name=file.target_name||file.name;}
if(chunkSize&&features.chunks&&blob.size>chunkSize){curChunkSize=Math.min(chunkSize,blob.size-offset);chunkBlob=blob.slice(offset,offset+curChunkSize);}else{curChunkSize=blob.size;chunkBlob=blob;}
if(chunkSize&&features.chunks){if(up.settings.send_chunk_number){args.chunk=Math.ceil(offset/chunkSize);args.chunks=Math.ceil(blob.size/chunkSize);}else{args.offset=offset;args.total=blob.size;}}
xhr=new o.XMLHttpRequest();if(xhr.upload){xhr.upload.onprogress=function(e){file.loaded=Math.min(file.size,offset+e.loaded);up.trigger('UploadProgress',file);};}
xhr.onload=function(){if(xhr.status>=400){handleError();return;}
retries=up.settings.max_retries;if(curChunkSize<blob.size){chunkBlob.destroy();offset+=curChunkSize;file.loaded=Math.min(offset,blob.size);up.trigger('ChunkUploaded',file,{offset:file.loaded,total:blob.size,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});if(o.Env.browser==='Android Browser'){up.trigger('UploadProgress',file);}}else{file.loaded=file.size;}
chunkBlob=formData=null;if(!offset||offset>=blob.size){if(file.size!=file.origSize){blob.destroy();blob=null;}
up.trigger('UploadProgress',file);file.status=plupload.DONE;up.trigger('FileUploaded',file,{response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});}else{delay(uploadNextChunk,1);}};xhr.onerror=function(){handleError();};xhr.onloadend=function(){this.destroy();xhr=null;};if(up.settings.multipart&&features.multipart){xhr.open("post",url,true);plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value);});formData=new o.FormData();plupload.each(plupload.extend(args,up.settings.multipart_params),function(value,name){formData.append(name,value);});formData.append(up.settings.file_data_name,chunkBlob);xhr.send(formData,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url});}else{url=plupload.buildUrl(up.settings.url,plupload.extend(args,up.settings.multipart_params));xhr.open("post",url,true);xhr.setRequestHeader('Content-Type','application/octet-stream');plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value);});xhr.send(chunkBlob,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url});}}
blob=file.getSource();if(up.settings.resize.enabled&&runtimeCan(blob,'send_binary_string')&&!!~o.inArray(blob.type,['image/jpeg','image/png'])){resizeImage.call(this,blob,up.settings.resize,function(resizedBlob){blob=resizedBlob;file.size=resizedBlob.size;uploadNextChunk();});}else{uploadNextChunk();}}
function onUploadProgress(up,file){calcFile(file);}
function onStateChanged(up){if(up.state==plupload.STARTED){startTime=(+new Date());}else if(up.state==plupload.STOPPED){for(var i=up.files.length-1;i>=0;i--){if(up.files[i].status==plupload.UPLOADING){up.files[i].status=plupload.QUEUED;calc();}}}}
function onCancelUpload(){if(xhr){xhr.abort();}}
function onFileUploaded(up){calc();delay(function(){uploadNext.call(up);},1);}
function onError(up,err){if(err.code===plupload.INIT_ERROR){up.destroy();}
else if(err.file){err.file.status=plupload.FAILED;calcFile(err.file);if(up.state==plupload.STARTED){up.trigger('CancelUpload');delay(function(){uploadNext.call(up);},1);}}}
function onDestroy(up){up.stop();plupload.each(files,function(file){file.destroy();});files=[];if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.destroy();});fileInputs=[];}
if(fileDrops.length){plupload.each(fileDrops,function(fileDrop){fileDrop.destroy();});fileDrops=[];}
preferred_caps={};disabled=false;startTime=xhr=null;total.reset();}
settings={runtimes:o.Runtime.order,max_retries:0,chunk_size:0,multipart:true,multi_selection:true,file_data_name:'file',flash_swf_url:'js/Moxie.swf',silverlight_xap_url:'js/Moxie.xap',filters:{mime_types:[],prevent_duplicates:false,max_file_size:0},resize:{enabled:false,preserve_headers:true,crop:false},send_file_name:true,send_chunk_number:true};setOption.call(this,options,null,true);total=new plupload.QueueProgress();plupload.extend(this,{id:uid,uid:uid,state:plupload.STOPPED,features:{},runtime:null,files:files,settings:settings,total:total,init:function(){var self=this;if(typeof(settings.preinit)=="function"){settings.preinit(self);}else{plupload.each(settings.preinit,function(func,name){self.bind(name,func);});}
bindEventListeners.call(this);if(!settings.browse_button||!settings.url){this.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});return;}
initControls.call(this,settings,function(inited){if(typeof(settings.init)=="function"){settings.init(self);}else{plupload.each(settings.init,function(func,name){self.bind(name,func);});}
if(inited){self.runtime=o.Runtime.getInfo(getRUID()).type;self.trigger('Init',{runtime:self.runtime});self.trigger('PostInit');}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});}});},setOption:function(option,value){setOption.call(this,option,value,!this.runtime);},getOption:function(option){if(!option){return settings;}
return settings[option];},refresh:function(){if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.trigger('Refresh');});}
this.trigger('Refresh');},start:function(){if(this.state!=plupload.STARTED){this.state=plupload.STARTED;this.trigger('StateChanged');uploadNext.call(this);}},stop:function(){if(this.state!=plupload.STOPPED){this.state=plupload.STOPPED;this.trigger('StateChanged');this.trigger('CancelUpload');}},disableBrowse:function(){disabled=arguments[0]!==undef?arguments[0]:true;if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.disable(disabled);});}
this.trigger('DisableBrowse',disabled);},getFile:function(id){var i;for(i=files.length-1;i>=0;i--){if(files[i].id===id){return files[i];}}},addFile:function(file,fileName){var self=this,queue=[],ruid;function filterFile(file,cb){var queue=[];o.each(self.settings.filters,function(rule,name){if(fileFilters[name]){queue.push(function(cb){fileFilters[name].call(self,rule,file,function(res){cb(!res);});});}});o.inSeries(queue,cb);}
function resolveFile(file){var type=o.typeOf(file);if(file instanceof o.File){if(!file.ruid&&!file.isDetached()){if(!ruid){return false;}
file.ruid=ruid;file.connectRuntime(ruid);}
resolveFile(new plupload.File(file));}
else if(file instanceof o.Blob){resolveFile(file.getSource());file.destroy();}
else if(file instanceof plupload.File){if(fileName){file.name=fileName;}
queue.push(function(cb){filterFile(file,function(err){if(!err){files.push(file);self.trigger("FileFiltered",file);}
delay(cb,1);});});}
else if(o.inArray(type,['file','blob'])!==-1){resolveFile(new o.File(null,file));}
else if(type==='node'&&o.typeOf(file.files)==='filelist'){o.each(file.files,resolveFile);}
else if(type==='array'){fileName=null;o.each(file,resolveFile);}}
ruid=getRUID();resolveFile(file);if(queue.length){o.inSeries(queue,function(){if(files.length){self.trigger("FilesAdded",files);}});}},removeFile:function(file){var id=typeof(file)==='string'?file:file.id;for(var i=files.length-1;i>=0;i--){if(files[i].id===id){return this.splice(i,1)[0];}}},splice:function(start,length){var removed=files.splice(start===undef?0:start,length===undef?files.length:length);var restartRequired=false;if(this.state==plupload.STARTED){plupload.each(removed,function(file){if(file.status===plupload.UPLOADING){restartRequired=true;return false;}});if(restartRequired){this.stop();}}
this.trigger("FilesRemoved",removed);plupload.each(removed,function(file){file.destroy();});if(restartRequired){this.start();}
return removed;},bind:function(name,func,scope){var self=this;plupload.Uploader.prototype.bind.call(this,name,function(){var args=[].slice.call(arguments);args.splice(0,1,self);return func.apply(this,args);},0,scope);},destroy:function(){this.trigger('Destroy');settings=total=null;this.unbindAll();}});};plupload.Uploader.prototype=o.EventTarget.instance;plupload.File=(function(){var filepool={};function PluploadFile(file){plupload.extend(this,{id:plupload.guid(),name:file.name||file.fileName,type:file.type||'',size:file.size||file.fileSize,origSize:file.size||file.fileSize,loaded:0,percent:0,status:plupload.QUEUED,lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString(),getNative:function(){var file=this.getSource().getSource();return o.inArray(o.typeOf(file),['blob','file'])!==-1?file:null;},getSource:function(){if(!filepool[this.id]){return null;}
return filepool[this.id];},destroy:function(){var src=this.getSource();if(src){src.destroy();delete filepool[this.id];}}});filepool[this.id]=file;}
return PluploadFile;}());plupload.QueueProgress=function(){var self=this;self.size=0;self.loaded=0;self.uploaded=0;self.failed=0;self.queued=0;self.percent=0;self.bytesPerSec=0;self.reset=function(){self.size=self.loaded=self.uploaded=self.failed=self.queued=self.percent=self.bytesPerSec=0;};};window.plupload=plupload;}(window,mOxie));